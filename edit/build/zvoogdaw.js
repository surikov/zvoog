"use strict";
var ZvoogIcons;
(function (ZvoogIcons) {
    ZvoogIcons["iconPathGear128"] = "M 64.326172 0.005859375 C 60.752918 0.025095312 57.177433 0.07765992 53.611328 0.025390625 C 50.25557 0.79404112 51.974051 5.0038749 51.550781 7.5078125 C 53.072542 12.628268 48.177615 12.629524 44.400391 14.005859 C 40.360651 14.621596 36.104968 20.865958 33.240234 15.755859 C 31.299067 14.167194 29.920795 11.60477 27.482422 10.849609 C 24.399896 12.165068 22.467465 15.421053 19.892578 17.585938 C 16.970395 20.660659 13.711966 23.460349 11 26.707031 C 10.647756 29.562749 14.022449 30.961381 15.541016 33.029297 C 20.540364 35.7155 15.486124 39.583427 14.402344 43.40625 C 12.486192 46.935901 13.248418 53.176878 7.7988281 51.550781 C 5.2855646 51.937211 1.9354597 50.542311 0.1875 52.808594 C -0.18579009 59.914012 0.12992921 67.088493 0.025390625 74.220703 C 0.79404112 77.576461 5.0038749 75.85798 7.5078125 76.28125 C 12.628422 74.759489 12.629422 79.656112 14.005859 83.433594 C 14.621442 87.473333 20.866576 91.729531 15.755859 94.59375 C 14.1674 96.534401 11.604306 97.911492 10.849609 100.34961 C 12.165068 103.43203 15.421053 105.36454 17.585938 107.93945 C 20.664703 110.85133 23.446403 114.13469 26.710938 116.81445 C 29.573352 117.17486 30.964987 113.80866 33.029297 112.29102 C 35.7155 107.29165 39.583427 112.34584 43.40625 113.42969 C 46.935901 115.34561 53.176878 114.5835 51.550781 120.0332 C 51.937469 122.54654 50.542311 125.89657 52.808594 127.64453 C 59.914012 128.01782 67.088493 127.702 74.220703 127.80664 C 77.576461 127.0379 75.85798 122.82803 76.28125 120.32422 C 74.759489 115.20351 79.656112 115.20263 83.433594 113.82617 C 87.473591 113.2102 91.728907 106.96613 94.595703 112.07422 C 96.535839 113.66039 97.913038 116.22158 100.34961 116.97461 C 103.43203 115.6592 105.36454 112.40307 107.93945 110.23828 C 110.86164 107.16359 114.12007 104.36398 116.83203 101.11719 C 117.1842 98.261471 113.80969 96.862837 112.29102 94.794922 C 107.29268 92.109491 112.34461 88.241714 113.42969 84.419922 C 115.34535 80.891043 114.58557 74.655668 120.0332 76.28125 C 122.54654 75.894562 125.89657 77.289721 127.64453 75.023438 C 128.01782 67.918019 127.702 60.743538 127.80664 53.611328 C 127.83444 52.507426 126.84804 51.522958 125.74414 51.550781 L 116.05859 51.550781 C 115.62244 45.744799 110.36656 39.763795 110.28516 35.025391 C 112.4319 32.74262 114.88434 30.709841 116.82422 28.257812 C 117.17613 25.402249 113.80135 24.0039 112.2832 21.935547 C 108.5289 18.332834 105.05164 14.392134 101.125 11 C 98.269277 10.647859 96.870908 14.022681 94.802734 15.541016 C 92.1155 20.539797 88.247167 15.485823 84.423828 14.400391 C 80.894434 12.484188 74.655153 13.248264 76.28125 7.7988281 C 75.89482 5.2855646 77.289721 1.9354597 75.023438 0.1875 C 71.470729 0.000854955 67.899426 -0.013376562 64.326172 0.005859375 z M 57.462891 4.0117188 C 57.992392 3.9791982 58.609698 4.0330302 59.287109 4.1484375 L 72.160156 4.1484375 C 72.412366 7.6515543 71.62054 11.387446 72.625 14.726562 C 79.115478 16.921175 86.041913 18.919984 91.833984 22.941406 C 94.625296 22.799329 96.024325 19.635428 98.121094 18.050781 C 99.714989 15.314264 101.30844 16.122974 102.90234 18.380859 C 105.93684 21.415287 108.97135 24.449946 112.00586 27.484375 C 109.70248 30.143529 106.49546 32.228705 104.8418 35.304688 C 107.88893 41.44171 111.3878 47.747067 112.65039 54.685547 C 114.72655 56.55458 117.94999 55.310434 120.55273 55.671875 C 123.61583 54.857023 124.14524 56.577462 123.68359 59.287109 L 123.68359 72.160156 C 120.18047 72.412366 116.44474 71.62054 113.10547 72.625 C 110.91132 79.115993 108.91285 86.043608 104.89062 91.835938 C 105.03257 94.62725 108.19638 96.026793 109.78125 98.123047 C 112.51847 99.716169 111.70792 101.3087 109.45117 102.90234 C 106.41666 105.93684 103.38216 108.97135 100.34766 112.00586 C 97.6885 109.70248 95.603327 106.49546 92.527344 104.8418 C 86.390321 107.88893 80.084964 111.3878 73.146484 112.65039 C 71.277451 114.72655 72.521597 117.94999 72.160156 120.55273 C 72.975008 123.61583 71.254569 124.14524 68.544922 123.68359 L 55.671875 123.68359 C 55.419665 120.18047 56.211492 116.44474 55.207031 113.10547 C 48.716038 110.91132 41.788422 108.91285 35.996094 104.89062 C 33.204781 105.03257 31.805238 108.19638 29.708984 109.78125 C 28.115862 112.51847 26.521551 111.70741 24.927734 109.45117 C 21.892764 106.41718 18.859163 103.3836 15.824219 100.34961 C 18.127574 97.690454 21.332614 95.60528 22.986328 92.529297 C 19.939611 86.392016 16.44079 80.087432 15.179688 73.148438 C 13.105666 71.276312 9.881568 72.522112 7.2792969 72.160156 C 4.2162208 72.975008 3.6868083 71.254569 4.1484375 68.544922 L 4.1484375 55.671875 C 7.6515543 55.419665 11.387446 56.211492 14.726562 55.207031 C 16.920867 48.716038 18.919262 41.788422 22.941406 35.996094 C 22.799406 33.204781 19.63566 31.805238 18.050781 29.708984 C 15.314368 28.115089 16.119707 26.519933 18.378906 24.925781 L 27.482422 15.824219 C 30.142091 18.127677 32.228447 21.332227 35.304688 22.986328 C 41.441454 19.940332 47.745372 16.441278 54.683594 15.179688 C 56.555719 13.105666 55.309919 9.881568 55.671875 7.2792969 C 55.060736 4.9819898 55.874386 4.1092803 57.462891 4.0117188 z M 62.666016 41.244141 C 49.808856 41.646121 39.116981 54.596679 41.505859 67.369141 C 43.125773 80.648422 58.011122 89.944916 70.658203 85.566406 C 83.522715 81.990898 90.523281 65.942832 84.34375 54.091797 C 80.701519 46.366288 72.468485 41.157473 63.916016 41.246094 C 63.497126 41.23252 63.080763 41.231174 62.666016 41.244141 z M 64.130859 45.316406 C 66.508783 45.311516 68.895055 45.787806 71.136719 46.824219 C 81.645812 50.863701 85.907986 65.160987 79.291016 74.28125 C 75.924695 79.333436 69.993272 82.510185 63.916016 82.464844 C 52.593875 82.853593 43.087048 71.191762 45.744141 60.177734 C 47.233506 51.488896 55.638276 45.33387 64.130859 45.316406 z ";
    ZvoogIcons["iconPathLayers128"] = "m 126.69762,82.869463 -16.19908,-9.653301 16.19908,-9.653301 c 0.62946,-0.375181 1.01504,-1.054043 1.01504,-1.786724 0,-0.732682 -0.38558,-1.411543 -1.01504,-1.786724 l -16.19908,-9.653302 16.19908,-9.653301 c 0.9867,-0.588121 1.30988,-1.864724 0.72176,-2.851686 -0.1768,-0.296921 -0.4251,-0.544961 -0.72176,-0.721762 L 64.921481,0.2932806 c -0.656241,-0.3910408 -1.473943,-0.3910408 -2.129924,0 L 1.0154198,37.109362 c -0.98670216,0.588121 -1.30988287,1.864724 -0.72176157,2.851686 0.17680039,0.296921 0.42510094,0.544962 0.72176157,0.721762 L 17.214496,50.336111 1.0151598,59.989413 c -0.98670216,0.588121 -1.30988287,1.864724 -0.72176157,2.851686 0.17680039,0.296921 0.42510094,0.544961 0.72176157,0.721762 L 17.214236,73.216162 1.0151598,82.869463 c -0.98670216,0.588122 -1.30988287,1.864725 -0.72176157,2.851687 0.17680039,0.29692 0.42510094,0.544961 0.72176157,0.721761 L 62.791297,123.25899 c 0.656761,0.38844 1.473163,0.38844 2.129924,0 L 126.69736,86.442911 c 0.9867,-0.588121 1.30988,-1.864724 0.72176,-2.851686 -0.1768,-0.296661 -0.42484,-0.544701 -0.7215,-0.721762 z M 6.1423712,38.896086 63.856259,4.50113 121.57015,38.896086 63.856259,73.291042 Z m 0,22.880051 15.1341138,-9.01682 41.514812,24.752055 c 0.656241,0.39104 1.473683,0.39104 2.129924,0 L 106.43603,52.759317 121.57015,61.776137 63.856259,96.17109 Z M 63.856259,119.05114 6.1423712,84.656187 21.276485,75.639367 62.791297,100.39142 c 0.656241,0.39104 1.473683,0.39104 2.129924,0 l 41.514809,-24.752053 15.13412,9.01682 z";
    ZvoogIcons["iconPathUndo128"] = "m 125.89118,119.79354 -3.26425,-5.48178 C 97.54996,72.176017 63.227953,74.761121 54.827581,76.124265 V 109.33142 L 0,54.406467 54.827581,0 v 32.691103 c 0.279931,0 0.557428,-0.0024 0.83736,-0.0024 30.468692,0 44.530979,12.81355 45.134659,13.37828 33.5455,27.90793 26.38413,67.071527 26.30867,67.463427 z M 62.083886,70.812873 c 14.115839,0 40.112934,4.680938 60.837584,34.918387 C 123.23305,93.871907 120.74044,68.987235 97.581605,49.715793 97.34062,49.501584 83.134717,36.658825 52.468856,37.605723 l -2.507211,0.07302 V 11.69139 L 6.8936117,54.421072 49.959211,97.564565 V 72.214964 l 1.849981,-0.457627 c 0.131446,-0.03408 4.048049,-0.944464 10.274694,-0.944464 z";
    ZvoogIcons["iconPathRedo128"] = "M 127.9569,54.853773 73.400505,0 V 32.791851 C 42.35635,32.489599 27.660589,45.910541 27.138962,46.402919 -6.5596438,74.441621 0.61395442,113.65875 0.6895173,114.05119 l 1.2187561,6.27172 3.2687038,-5.48928 C 30.297977,72.623237 64.935025,75.116812 73.400505,76.447694 V 109.70755 Z M 4.8844757,106.2414 C 4.5773492,94.36097 7.0904242,69.425221 30.358915,50.061625 30.497853,49.932436 44.121109,37.664438 72.700939,37.664438 c 1.001817,0 2.025572,0.01463 3.063953,0.04875 l 2.510637,0.07313 V 11.814621 L 121.08068,54.853773 78.275529,97.890488 V 72.513549 l -1.864697,-0.45094 C 75.979393,71.952921 34.804937,62.6075 4.8844757,106.2414 Z";
    ZvoogIcons["iconPathWave128"] = "M 37.765625 0 C 36.162001 -5.9211895e-16 34.861328 1.3009462 34.861328 2.9042969 L 34.861328 124.91992 C 34.861328 126.52354 36.162001 127.82422 37.765625 127.82422 C 39.369248 127.82422 40.671603 126.52355 40.671875 124.91992 L 40.671875 2.9042969 C 40.671875 1.3006737 39.369248 0 37.765625 0 z M 55.197266 5.8105469 C 53.593642 5.8105469 52.292969 7.1112206 52.292969 8.7148438 L 52.292969 119.10938 C 52.292969 120.713 53.593642 122.01562 55.197266 122.01562 C 56.800888 122.01562 58.101562 120.713 58.101562 119.10938 L 58.101562 8.7148438 C 58.101562 7.1112206 56.800888 5.8105469 55.197266 5.8105469 z M 90.058594 5.8105469 C 88.45497 5.8105469 87.154297 7.1112206 87.154297 8.7148438 L 87.154297 119.10938 C 87.154297 120.713 88.45497 122.01562 90.058594 122.01562 C 91.662217 122.01562 92.962622 120.713 92.962891 119.10938 L 92.962891 8.7148438 C 92.962891 7.1112206 91.662217 5.8105469 90.058594 5.8105469 z M 20.335938 23.240234 C 18.732313 23.240234 17.431641 24.542861 17.431641 26.146484 L 17.431641 101.67969 C 17.431641 103.28331 18.732314 104.58398 20.335938 104.58398 C 21.93956 104.58398 23.240234 103.28331 23.240234 101.67969 L 23.240234 26.146484 C 23.240234 24.542861 21.93956 23.240234 20.335938 23.240234 z M 72.628906 29.050781 C 71.025283 29.050781 69.722656 30.353408 69.722656 31.957031 L 69.722656 95.869141 C 69.722656 97.472761 71.025283 98.773438 72.628906 98.773438 C 74.232529 98.773437 75.53293 97.472761 75.533203 95.869141 L 75.533203 31.957031 C 75.533203 30.353408 74.232529 29.050781 72.628906 29.050781 z M 107.49023 29.050781 C 105.88661 29.050781 104.58398 30.353408 104.58398 31.957031 L 104.58398 95.869141 C 104.58398 97.472761 105.88661 98.773438 107.49023 98.773438 C 109.09385 98.773437 110.39426 97.472761 110.39453 95.869141 L 110.39453 31.957031 C 110.39453 30.353408 109.09385 29.050781 107.49023 29.050781 z M 2.9042969 46.482422 C 1.3006737 46.482422 0 47.783096 0 49.386719 L 0 78.4375 C -2.9605947e-16 80.041124 1.3006737 81.34375 2.9042969 81.34375 C 4.50792 81.34375 5.8102746 80.041124 5.8105469 78.4375 L 5.8105469 49.386719 C 5.8105469 47.783096 4.50792 46.482422 2.9042969 46.482422 z M 124.91992 46.482422 C 123.3163 46.482422 122.01562 47.783096 122.01562 49.386719 L 122.01562 78.4375 C 122.01563 80.041124 123.3163 81.34375 124.91992 81.34375 C 126.52355 81.34375 127.8259 80.041124 127.82617 78.4375 L 127.82617 49.386719 C 127.82617 47.783096 126.52355 46.482422 124.91992 46.482422 z ";
    ZvoogIcons["iconPathNotes128"] = "m 26.480193,0 v 55.285085 c -2.680278,-1.797588 -5.901404,-2.848138 -9.363741,-2.848138 -9.2938248,0 -16.85473325,7.560908 -16.85473325,16.854734 0,9.293824 7.56090845,16.854732 16.85473325,16.854732 9.350756,0 17.012993,-7.669028 16.846443,-17.166858 h 0.0083 V 14.427964 c 2.361661,2.063019 5.01286,4.080148 7.880662,6.9477 4.751536,4.752036 3.834744,10.989169 3.834744,18.513871 h 7.490993 c 0,-7.741191 1.102042,-16.679561 -6.028884,-23.810237 C 44.909392,13.839991 42.790338,12.066639 40.920837,10.50202 35.977031,6.3644955 33.971185,4.5060817 33.971185,0 Z M 127.97729,25.902448 63.804452,38.623967 v 58.360979 c -2.680027,-1.797587 -5.901154,-2.847656 -9.36374,-2.847656 -9.293825,0 -16.854734,7.56091 -16.854734,16.85474 0,9.29382 7.560909,16.85473 16.854734,16.85473 9.293824,0 16.854733,-7.56091 16.854733,-16.85473 V 59.578262 C 83.710516,57.11922 108.15437,52.278873 120.48629,49.836559 v 32.166399 c -2.68002,-1.797588 -5.90114,-2.848137 -9.36373,-2.848137 -9.29383,0 -16.854742,7.560908 -16.854742,16.854736 0,9.293823 7.560912,16.854733 16.854742,16.854733 9.29382,0 16.85473,-7.56091 16.85473,-16.854733 z";
    ZvoogIcons["iconPathAdjust128"] = "M 15.927059,0 C 14.671096,0 13.651765,1.0170565 13.651765,2.2752941 V 91.193966 C 5.9453435,92.304309 0,98.932063 0,106.93882 c 0,8.78036 7.1444235,15.92706 15.927059,15.92706 8.782635,0 15.927059,-7.1467 15.927059,-15.92706 0,-8.006757 -5.945344,-14.634511 -13.651765,-15.744854 V 2.2752941 C 18.202353,1.0170565 17.183021,0 15.927059,0 Z M 63.708235,0 C 62.452273,0 61.432941,1.0170565 61.432941,2.2752941 V 44.670422 c -8.195609,0.901018 -14.59388,7.861498 -14.593877,16.291463 0,8.429964 6.398268,15.390444 14.593877,16.291461 v 43.337244 c 0,1.25824 1.019332,2.27529 2.275294,2.27529 1.255963,0 2.275294,-1.01705 2.275294,-2.27529 V 77.11114 c 7.736,-1.312845 13.651765,-8.044658 13.651765,-16.149255 0,-8.104598 -5.915765,-14.836413 -13.651765,-16.149257 V 2.2752941 C 65.983529,1.0170565 64.964198,0 63.708235,0 Z m 47.781175,0 c -8.78263,0 -15.927057,7.1466988 -15.927057,15.927059 0,8.00676 5.945347,14.634514 13.651767,15.744858 v 88.918673 c 0,1.25824 1.01933,2.27529 2.27529,2.27529 1.25596,0 2.2753,-1.01705 2.2753,-2.27529 V 31.671917 c 7.70642,-1.110344 13.65176,-7.738098 13.65176,-15.744858 C 127.41647,7.1466988 120.27205,0 111.48941,0 Z m 0,4.5505882 c 6.27299,0 11.37647,5.1034847 11.37647,11.3764708 0,6.272986 -5.10348,11.37647 -11.37647,11.37647 -6.27298,0 -11.37647,-5.103484 -11.37647,-11.37647 0,-6.2729861 5.10349,-11.3764708 11.37647,-11.3764708 z M 63.237179,49.114358 c 6.534645,0 11.847527,5.315157 11.847527,11.847527 0,6.532369 -5.315158,11.847527 -11.847527,11.847527 -6.53237,0 -11.847527,-5.315158 -11.847527,-11.847527 0,-6.53237 5.312882,-11.847527 11.847527,-11.847527 z m -47.31012,46.447995 c 6.272986,0 11.37647,5.103487 11.37647,11.376467 0,6.27299 -5.103484,11.37647 -11.37647,11.37647 -6.2729861,0 -11.3764708,-5.10348 -11.3764708,-11.37647 0,-6.27298 5.1034847,-11.376467 11.3764708,-11.376467 z";
    ZvoogIcons["iconPathGraph128"] = "M 114.9294,8.137553e-5 C 107.89597,-0.02485986 102.18414,5.6866828 102.1592,12.720111 c 0,3.317184 1.2721,6.509565 3.59163,8.878982 L 82.430779,68.264046 c -0.498825,-0.07482 -1.022394,-0.14955 -1.546161,-0.14955 -1.646118,0 -3.292438,0.323945 -4.813853,0.947475 L 57.963526,48.685177 c 1.047532,-1.870592 1.621083,-3.965559 1.646024,-6.135446 0,-7.05837 -5.711348,-12.770204 -12.769717,-12.770204 -7.05837,0 -12.770204,5.711834 -12.770204,12.770204 0.02494,3.042831 1.122258,5.985702 3.142499,8.280295 L 15.03976,89.613644 C 14.291522,89.464002 13.517955,89.389074 12.769717,89.389074 5.7113479,89.389074 0,95.100912 0,102.15928 c 0,7.05837 5.7113479,12.76972 12.769717,12.76972 7.058369,0 12.770204,-5.71135 12.770204,-12.76972 -0.02494,-3.042833 -1.122258,-5.986185 -3.142497,-8.280778 L 44.544947,55.09488 c 2.369418,0.473884 4.838794,0.22486 7.058565,-0.722907 L 69.71075,74.748767 c -1.047531,1.870593 -1.596239,3.9905 -1.62118,6.135447 -0.02494,7.058371 5.686602,12.794952 12.720033,12.819894 7.058362,0.02492 12.794944,-5.686603 12.819885,-12.720032 0,-3.317185 -1.272095,-6.534798 -3.59163,-8.929156 L 113.35791,25.389967 c 0.49883,0.07483 1.0224,0.14955 1.54616,0.14955 7.05837,0 12.7702,-5.711349 12.7702,-12.769718 0,-7.0583698 -5.6865,-12.76971762447 -12.74487,-12.76971762447 z";
    ZvoogIcons["iconPathSound128"] = "m 93.676212,14 c -0.8282,-3.98e-4 -1.617968,0.483906 -1.963957,1.295465 -0.457067,1.082078 0.0473,2.331039 1.129379,2.790231 18.503756,7.850915 30.460026,25.909559 30.460026,46.005604 0,20.784834 -12.53133,39.074 -31.921575,46.5869 -1.094834,0.42518 -1.637602,1.65803 -1.212424,2.75287 0.325262,0.84185 1.132237,1.35774 1.984719,1.35774 0.255107,0 0.511011,-0.0434 0.763992,-0.14118 C 113.95631,106.4906 127.55344,86.644875 127.55344,64.0913 127.55344,42.283913 114.5794,22.686656 94.502487,14.166085 94.232498,14.052882 93.952281,14.000133 93.676212,14 Z m -36.588571,2.254607 c -1.128317,0.01648 -2.252515,0.336455 -3.27188,0.950838 -0.09779,0.0574 -0.193158,0.12287 -0.278192,0.19515 L 24.734241,41.769448 H 2.1258907 C 0.95027316,41.769448 0,42.719721 0,43.895338 v 40.391924 c 0,0.565487 0.22315209,1.10553 0.62281955,1.503071 0.39966745,0.397542 0.93758425,0.62282 1.50307115,0.62282 l 22.5543723,-0.0083 28.790872,26.444917 c 0.106295,0.0978 0.22345,0.181 0.344626,0.25328 1.045938,0.63139 2.204615,0.95084 3.363225,0.95084 1.099086,-0.002 2.195648,-0.2856 3.205446,-0.85534 2.123765,-1.19902 3.39229,-3.38838 3.39229,-5.85867 V 22.968602 c 0,-2.468159 -1.268525,-4.657528 -3.39229,-5.858656 C 59.34806,16.5232 58.215957,16.238131 57.087641,16.254607 Z m 0.369539,4.276694 c 0.376283,0.05049 0.673973,0.184653 0.83873,0.278193 0.769572,0.435808 1.229031,1.242849 1.229031,2.159108 v 84.371288 c 0,0.91626 -0.459459,1.7233 -1.229031,2.15911 -0.329513,0.18495 -1.164988,0.5408 -2.125891,0.054 L 27.63658,83.340576 v -9.682767 c 0,-1.175618 -0.950274,-2.125891 -2.125891,-2.125891 -1.175618,0 -2.125891,0.950273 -2.125891,2.125891 v 8.495259 l -19.1330165,0.0083 V 46.021216 H 23.384798 v 8.503563 c 0,1.175618 0.950273,2.125891 2.125891,2.125891 1.175617,0 2.125891,-0.950273 2.125891,-2.125891 V 44.879392 L 56.13265,20.772125 c 0.490018,-0.257233 0.948248,-0.291314 1.32453,-0.240824 z m 24.186159,4.239325 c -0.826108,0.06079 -1.5805,0.602756 -1.864306,1.436637 -0.376283,1.109715 0.220993,2.320477 1.332833,2.698886 15.095951,5.125522 25.236654,19.266382 25.236654,35.189303 0,15.908041 -10.120641,30.0489 -25.186829,35.189304 -1.109715,0.378409 -1.705064,1.589074 -1.324528,2.703034 0.301877,0.88225 1.12526,1.43664 2.00963,1.43664 0.227471,0 0.457632,-0.0334 0.685103,-0.1121 16.790285,-5.729273 28.068404,-21.491092 28.068404,-39.221021 0,-17.74481 -11.300209,-33.504603 -28.122383,-39.216872 -0.277429,-0.09407 -0.559209,-0.124064 -0.834578,-0.103802 z M 69.901114,36.471328 c -0.821923,0.09875 -1.544029,0.67145 -1.789569,1.519681 -0.325259,1.126722 0.322272,2.307188 1.453246,2.63245 10.39348,3.003883 17.654859,12.653435 17.654859,23.467841 0,10.814407 -7.261379,20.46811 -17.654859,23.471994 -1.128848,0.325259 -1.778507,1.505728 -1.453246,2.63245 0.26999,0.93114 1.118087,1.536288 2.042849,1.536288 0.195582,0 0.394021,-0.02776 0.589603,-0.08304 C 82.948736,88.11789 91.46728,76.785 91.46728,64.091307 c 0,-12.69582 -8.52067,-24.02456 -20.723283,-27.553538 -0.28168,-0.08025 -0.568909,-0.09934 -0.842883,-0.06643 z";
    ZvoogIcons["iconPathPlay128"] = "M 96.755617,64.055979 34.372965,21.033459 C 33.71257,20.579571 32.856422,20.532247 32.150852,20.900089 31.443132,21.272234 31,22.003617 31,22.803836 v 86.045034 c 0,0.80022 0.443132,1.53376 1.150852,1.9059 0.314065,0.16349 0.658245,0.24523 1.000274,0.24523 0.428074,0 0.853997,-0.12907 1.221839,-0.38075 L 96.755617,67.596733 c 0.582955,-0.402261 0.929286,-1.062657 0.929286,-1.770377 0,-0.707721 -0.348482,-1.368116 -0.929286,-1.770377 z";
    ZvoogIcons["iconPathPause128"] = "M 29.182808,21.879923 C 27.424901,21.879923 26,23.304825 26,25.062731 V 107.81719 C 26,109.5751 27.424901,111 29.182808,111 h 25.462827 c 1.757906,0 3.183172,-1.4249 3.183172,-3.18281 V 25.062731 c 0,-1.757906 -1.425266,-3.182808 -3.183172,-3.182808 z m 44.560038,0 c -1.757906,0 -3.182807,1.424902 -3.182807,3.182808 v 82.754459 c 0,1.75791 1.424901,3.18281 3.182807,3.18281 h 25.462828 c 1.757906,0 3.182806,-1.4249 3.182806,-3.18281 V 25.062731 c 0,-1.757906 -1.42472,-3.182808 -3.182442,-3.182808 z";
})(ZvoogIcons || (ZvoogIcons = {}));
var ZvoogPopup = /** @class */ (function () {
    function ZvoogPopup(app) {
        this.averageSymbolWidthRatio = 0.3;
        this.app = app;
    }
    ZvoogPopup.prototype.reset = function (action, anchor, mx, my, mz, mw, msize, mcount) {
        var mxvW = this.app.maxZoom * this.app.tileLevel.viewWidth;
        var mxvH = this.app.maxZoom * this.app.tileLevel.viewHeight;
        anchor.content.length = 0;
        anchor.ww = this.app.tileLevel.innerWidth / this.app.tileLevel.tapSize;
        anchor.hh = this.app.tileLevel.innerHeight / this.app.tileLevel.tapSize;
        var fogX = -mxvW / this.app.tileLevel.tapSize;
        var fogY = -mxvH / this.app.tileLevel.tapSize;
        var fogW = (2 * mxvW + this.app.tileLevel.innerWidth) / this.app.tileLevel.tapSize;
        var fogH = (2 * mxvH + this.app.tileLevel.innerHeight) / this.app.tileLevel.tapSize;
        anchor.content.push(this.app.tileLevel.actionRectangle(//this.closePopupMenu.bind(this)
        function (x, y) { action(); }, fogX, fogY, fogW, fogH, 0, 0, 'fog'));
        var mh = this.calculateHeight(mcount, msize);
        var mr = this.calculateRound(mz); //mcount,msize,mw);
        var shadowR = this.calculateShadowSize(mr);
        anchor.content.push(this.app.tileLevel.rectangle(mx + shadowR * 0, my + shadowR * 0, mw + 2 * shadowR * 3, mr * 2 + mh + 2 * shadowR * 3, mr, mr, 'popupShadow3'));
        anchor.content.push(this.app.tileLevel.rectangle(mx + shadowR * 1, my + shadowR * 1, mw + 2 * shadowR * 2, mr * 2 + mh + 2 * shadowR * 2, mr, mr, 'popupShadow2'));
        anchor.content.push(this.app.tileLevel.rectangle(mx + shadowR * 2, my + shadowR * 2, mw + 2 * shadowR * 1, mr * 2 + mh + 2 * shadowR * 1, mr, mr, 'popupShadow1'));
        anchor.content.push(this.app.tileLevel.rectangle(mx + shadowR * 3, my + shadowR * 3, mw, 2 * mr + mh, mr, mr, 'popupFill'));
    };
    ZvoogPopup.prototype.calculateHeight = function (mcount, msize) {
        var mh = mcount * msize * 2;
        return mh;
    };
    ZvoogPopup.prototype.calculateRound = function (zoom) {
        return zoom / 2;
    };
    ;
    ZvoogPopup.prototype.calculateShadowSize = function (mr) {
        return mr / 10;
    };
    ZvoogPopup.prototype.popupButton = function (actionX, mr, px, py, pw, ph, text, sizecss, content, action) {
        content.push({ x: px + mr, y: py + ph * 0.75, css: sizecss, text: text });
        content.push({ x: actionX, y: py, w: pw, h: 0.99 * ph, css: 'fillButtonActionPoint',
            action: action.bind(this) });
    };
    ZvoogPopup.prototype.maxLabelLen = function (items, msize) {
        var mxlabellen = 0;
        for (var i = 0; i < items.length; i++) {
            if (mxlabellen < this.averageSymbolWidthRatio * msize * items[i].label.length + items[i].padding * msize) {
                mxlabellen = this.averageSymbolWidthRatio * msize * items[i].label.length + items[i].padding * msize;
            }
        }
        return mxlabellen;
    };
    ZvoogPopup.prototype.insertRow = function (mr, shadowR, mx, my, mz, mw, fontSize, item, content, i, onCreateDoItem) {
        this.popupButton(mx + 3 * shadowR, mr, 3 * shadowR + mx + fontSize * 1.5 + item.padding * fontSize, mr + 3 * shadowR + my + i * 2 * fontSize, mw, 2 * fontSize, item.label, 'fontSize' + fontSize + ' ' + item.css, content
        //, this.createDoItem(item, mr + 0.5 * fontSize + mx, mr + 0.5 * fontSize + my + i * 2 * fontSize, mz, fontSize)
        , onCreateDoItem(item, mr + 0.5 * fontSize + mx, mr + 0.5 * fontSize + my + i * 2 * fontSize, mz, fontSize));
        this.app.addIcon128(content, mx + mr + item.padding * fontSize, my + i * 2 * fontSize + 0.333 * fontSize + mr, fontSize * 2, item.path128, item.css);
    };
    ZvoogPopup.prototype.showPopupMenu = function (popX, popY, mz, fontSize, items) {
        var mx = popX + 0.75 * mz;
        var my = popY + 0.5 * mz;
        var mr = this.calculateRound(mz); //items.length,fontSize,mw);
        var mw = this.maxLabelLen(items, fontSize) + 6 * mr;
        this.reset(this.closePopupMenu1.bind(this), this.app.popupMenuGroup1, mx, my, mz, mw, fontSize, items.length);
        var shadowR = this.calculateShadowSize(mr);
        for (var i = 0; i < items.length; i++) {
            this.insertRow(mr, shadowR, mx, my, mz, mw, fontSize, items[i], this.app.popupMenuGroup1.content, i, this.createDoItem.bind(this));
        }
        this.app.tileLevel.redrawAnchor(this.app.popupMenuGroup1);
        this.app.tileLevel.translateX = -popX * this.app.tileLevel.tapSize;
        this.app.tileLevel.translateY = -popY * this.app.tileLevel.tapSize;
        this.app.tileLevel.translateZ = mz;
        this.app.tileLevel.applyZoomPosition();
        this.app.tileLevel.adjustContentPosition();
        this.app.tileLevel.slideToContentPosition();
    };
    ZvoogPopup.prototype.showPopupSubMenu = function (mx, my, mz, msize, items) {
        var mr = this.calculateRound(mz);
        var mw = this.maxLabelLen(items, msize) + 6 * mr;
        this.reset(this.closePopupMenu2.bind(this), this.app.popupMenuGroup2, mx, my, mz, mw, msize, items.length);
        var shadowR = this.calculateShadowSize(mr);
        for (var i = 0; i < items.length; i++) {
            this.insertRow(mr, shadowR, mx, my, mz, mw, msize, items[i], this.app.popupMenuGroup2.content, i, this.createDoSubItem.bind(this));
        }
        this.app.tileLevel.redrawAnchor(this.app.popupMenuGroup2);
    };
    ZvoogPopup.prototype.showPopupSubSubMenu = function (mx, my, mz, msize, items) {
        var mr = this.calculateRound(mz);
        var mw = this.maxLabelLen(items, msize) + 6 * mr;
        this.reset(this.closePopupMenu3.bind(this), this.app.popupMenuGroup3, mx, my, mz, mw, msize, items.length);
        var shadowR = this.calculateShadowSize(mr);
        for (var i = 0; i < items.length; i++) {
            this.insertRow(mr, shadowR, mx, my, mz, mw, msize, items[i], this.app.popupMenuGroup3.content, i, this.createDoSubSubItem.bind(this));
        }
        this.app.tileLevel.redrawAnchor(this.app.popupMenuGroup3);
    };
    ZvoogPopup.prototype.closePopupMenu1 = function () {
        this.app.popupMenuGroup1.content.length = 0;
        this.app.tileLevel.redrawAnchor(this.app.popupMenuGroup1);
    };
    ZvoogPopup.prototype.closePopupMenu2 = function () {
        this.app.popupMenuGroup2.content.length = 0;
        this.app.tileLevel.redrawAnchor(this.app.popupMenuGroup2);
    };
    ZvoogPopup.prototype.closePopupMenu3 = function () {
        this.app.popupMenuGroup3.content.length = 0;
        this.app.tileLevel.redrawAnchor(this.app.popupMenuGroup3);
    };
    ZvoogPopup.prototype.createDoSubSubItem = function (item, x, y, z, size) {
        var me = this;
        return function () {
            me.closePopupMenu3();
            me.closePopupMenu2();
            me.closePopupMenu1();
            if (item.action)
                item.action();
        };
    };
    ZvoogPopup.prototype.createDoSubItem = function (item, x, y, z, size) {
        var me = this;
        if (item.subMenu.length > 0) {
            return function () {
                me.showPopupSubSubMenu(x, y, z, size, item.subMenu);
            };
        }
        else {
            return function () {
                me.closePopupMenu2();
                me.closePopupMenu2();
                if (item.action)
                    item.action();
            };
        }
    };
    ZvoogPopup.prototype.createDoItem = function (item, x, y, z, size) {
        var me = this;
        if (item.subMenu.length > 0) {
            return function () {
                me.showPopupSubMenu(x, y, z, size, item.subMenu);
            };
        }
        else {
            return function () {
                me.closePopupMenu1();
                if (item.action)
                    item.action();
            };
        }
    };
    return ZvoogPopup;
}());
var ZvoogLang = /** @class */ (function () {
    function ZvoogLang() {
        this._labels = [];
        this._labels.push({ key: 'undoButton', label: 'Undo' });
        this._labels.push({ key: 'redoButton', label: 'Redo' });
        this._labels.push({ key: 'layersButton', label: 'Layers' });
        //this._labels.push({ key: 'layersMenuTitle', label: 'Layers' });
    }
    ZvoogLang.prototype.label = function (key) {
        var r = '?' + key;
        for (var i = 0; i < this._labels.length; i++) {
            if (key == this._labels[i].key) {
                return this._labels[i].label;
            }
        }
        return r;
    };
    return ZvoogLang;
}());
var UndoRedoChangeTitle = /** @class */ (function () {
    function UndoRedoChangeTitle(o) {
        this.props = o;
    }
    UndoRedoChangeTitle.prototype.undo = function (app) {
        app.currentSong.title = this.props.oldTitle;
    };
    ;
    UndoRedoChangeTitle.prototype.redo = function (app) {
        app.currentSong.title = this.props.newTitle;
    };
    ;
    return UndoRedoChangeTitle;
}());
var UndoRedoChangeDescription = /** @class */ (function () {
    function UndoRedoChangeDescription(o) {
        this.props = o;
    }
    UndoRedoChangeDescription.prototype.undo = function (app) {
        app.currentSong.description = this.props.oldDescription;
    };
    ;
    UndoRedoChangeDescription.prototype.redo = function (app) {
        app.currentSong.description = this.props.newDescription;
    };
    ;
    return UndoRedoChangeDescription;
}());
var UndoRedoSelectLayer = /** @class */ (function () {
    function UndoRedoSelectLayer(o) {
        this.props = o;
    }
    UndoRedoSelectLayer.prototype.undo = function (app) {
        app.currentSong.selectedLayer.level1 = this.props.oldSelection.level1;
        app.currentSong.selectedLayer.level2 = this.props.oldSelection.level2;
        app.currentSong.selectedLayer.level3 = this.props.oldSelection.level3;
        app.currentSong.selectedLayer.level4 = this.props.oldSelection.level4;
    };
    ;
    UndoRedoSelectLayer.prototype.redo = function (app) {
        app.currentSong.selectedLayer.level1 = this.props.newSelection.level1;
        app.currentSong.selectedLayer.level2 = this.props.newSelection.level2;
        app.currentSong.selectedLayer.level3 = this.props.newSelection.level3;
        app.currentSong.selectedLayer.level4 = this.props.newSelection.level4;
    };
    ;
    return UndoRedoSelectLayer;
}());
/*
class UndoRedoMoveTrack implements UndoRedoAction {
    props: UndoRedoMoveVoiceProperties;

    constructor(o: UndoRedoMoveVoiceProperties) {
        this.props = o;
    }
    undo(app: ZvoogApp): void {
        //var tracks: ZvoogTrack[] = app.currentSong.tracks.splice(this.props.newTrackPosition, 1);
        //app.currentSong.tracks.splice(this.props.oldTrackPosition, 0, tracks[0]);
        app.currentSong.selectedLayer.level1=this.props.oldTrackPosition;
        app.currentSong.selectedLayer.level2=this.props.oldVoicePosition;
    };
    redo(app: ZvoogApp): void {
        //var tracks: ZvoogTrack[] = app.currentSong.tracks.splice(this.props.oldTrackPosition, 1);
        //app.currentSong.tracks.splice(this.props.newTrackPosition, 0, tracks[0]);
        app.currentSong.selectedLayer.level1=this.props.newTrackPosition;
        app.currentSong.selectedLayer.level2=this.props.newVoicePosition;
    };
}
class UndoRedoMoveVoice implements UndoRedoAction {
    props: UndoRedoMoveVoiceProperties;
    constructor(o: UndoRedoMoveVoiceProperties) {
        this.props = o;
    }
    undo(app: ZvoogApp): void {
        //var tracks: ZvoogTrack[] = app.currentSong.tracks.splice(this.props.newTrackPosition, 1);
        //app.currentSong.tracks.splice(this.props.oldTrackPosition, 0, tracks[0]);
        //var voices: ZvoogVoice[] = tracks[0].voices.splice(this.props.newVoicePosition, 1);
        //tracks[0].voices.splice(this.props.oldTrackPosition, 0, voices[0]);
        app.currentSong.selectedLayer.level1=this.props.oldTrackPosition;
        app.currentSong.selectedLayer.level2=this.props.oldVoicePosition;
    };
    redo(app: ZvoogApp): void {
        //var tracks: ZvoogTrack[] = app.currentSong.tracks.splice(this.props.oldTrackPosition, 1);
        //app.currentSong.tracks.splice(this.props.newTrackPosition, 0, tracks[0]);
        //var voices: ZvoogVoice[] = tracks[0].voices.splice(this.props.oldVoicePosition, 1);
        //tracks[0].voices.splice(this.props.newTrackPosition, 0, voices[0]);
        app.currentSong.selectedLayer.level1=this.props.newTrackPosition;
        app.currentSong.selectedLayer.level2=this.props.newVoicePosition;
    };
}*/
var UndoRedoBunch = /** @class */ (function () {
    function UndoRedoBunch(o) {
        this.props = o;
    }
    UndoRedoBunch.prototype.undo = function (app) {
        for (var i = 0; i < this.props.commands.length; i++) {
            var c = this.props.commands[this.props.commands.length - i - 1];
            var a = app.undoRedo.createUndoRedoAction(c);
            if (a)
                a.undo(app);
        }
    };
    ;
    UndoRedoBunch.prototype.redo = function (app) {
        for (var i = 0; i < this.props.commands.length; i++) {
            var c = this.props.commands[i];
            var a = app.undoRedo.createUndoRedoAction(c);
            if (a)
                a.redo(app);
        }
    };
    ;
    return UndoRedoBunch;
}());
var ZvoogUndoRedo = /** @class */ (function () {
    function ZvoogUndoRedo(app) {
        this.app = app;
    }
    ZvoogUndoRedo.prototype.addRedo = function (command) {
        this.app.currentSong.macros.length = this.app.currentSong.macroPosition;
        this.app.currentSong.macros.push(command);
        this.doRedo();
    };
    ZvoogUndoRedo.prototype.doRedo = function () {
        if (this.app.currentSong.macros.length > 0 && this.app.currentSong.macroPosition < this.app.currentSong.macros.length) {
            var command = this.app.currentSong.macros[this.app.currentSong.macroPosition];
            var a = this.app.undoRedo.createUndoRedoAction(command);
            if (a) {
                a.redo(this.app);
                this.app.currentSong.macroPosition++;
                this.app.resetWholeProject();
                return command.point;
            }
            else {
                console.log('wrong redo', this.app.currentSong.macros[this.app.currentSong.macroPosition]);
                return null;
            }
        }
        else {
            console.log('wrong redo position', this.app.currentSong.macroPosition, this.app.currentSong.macros.length);
            return null;
        }
    };
    ZvoogUndoRedo.prototype.doUndo = function () {
        if (this.app.currentSong.macros.length > 0 && this.app.currentSong.macroPosition > 0 && this.app.currentSong.macroPosition <= this.app.currentSong.macros.length) {
            var command = this.app.currentSong.macros[this.app.currentSong.macroPosition - 1];
            var a = this.app.undoRedo.createUndoRedoAction(command);
            if (a) {
                a.undo(this.app);
                this.app.currentSong.macroPosition--;
                this.app.resetWholeProject();
                return command.point;
            }
            else {
                console.log('wrong undo', this.app.currentSong.macros[this.app.currentSong.macroPosition]);
                return null;
            }
        }
        else {
            console.log('wrong undo position', this.app.currentSong.macroPosition, this.app.currentSong.macros.length);
            return null;
        }
    };
    ZvoogUndoRedo.prototype.createUndoRedoAction = function (command) {
        var r = null;
        if (command) {
            switch (command.key) {
                case UndoRedoKeys.undoRedoChangeProjectTitle: {
                    r = new UndoRedoChangeTitle(command.properties);
                    break;
                }
                case UndoRedoKeys.undoRedoChangeProjectDescription: {
                    r = new UndoRedoChangeDescription(command.properties);
                    break;
                }
                /*case undoRedoMoveVoice: {
                    r = new UndoRedoMoveVoice(command.properties as UndoRedoMoveVoiceProperties);
                    break;
                }
                case undoRedoMoveTrack: {
                    r = new UndoRedoMoveTrack(command.properties as UndoRedoMoveVoiceProperties);
                    break;
                }*/
                case UndoRedoKeys.undoRedoSelectLayer: {
                    r = new UndoRedoSelectLayer(command.properties);
                    break;
                }
                case UndoRedoKeys.undoRedoBunch: {
                    r = new UndoRedoBunch(command.properties);
                    break;
                }
                default: {
                    break;
                }
            }
        }
        else {
            console.log('empty undo action');
        }
        return r;
    };
    return ZvoogUndoRedo;
}());
var ZvoogParameterEmpty = /** @class */ (function () {
    function ZvoogParameterEmpty() {
    }
    ZvoogParameterEmpty.prototype.label = function () {
        return 'Empty parameter';
    };
    ZvoogParameterEmpty.prototype.cancelScheduledValues = function (cancelTime) {
        //
    };
    ZvoogParameterEmpty.prototype.linearRampToValueAtTime = function (value, endTime) {
        //
    };
    ZvoogParameterEmpty.prototype.setValueAtTime = function (value, startTime) {
        //
    };
    return ZvoogParameterEmpty;
}());
var ZvoogFilterSourceEmpty = /** @class */ (function () {
    function ZvoogFilterSourceEmpty() {
        this.vals = [];
        //
    }
    ZvoogFilterSourceEmpty.prototype.prepare = function (audioContext) {
        this.base = audioContext.createGain();
        this.params = [new ZvoogParameterEmpty(), new ZvoogParameterEmpty()];
    };
    ZvoogFilterSourceEmpty.prototype.getInput = function () {
        return this.base;
    };
    ZvoogFilterSourceEmpty.prototype.getOutput = function () {
        return this.base;
    };
    ZvoogFilterSourceEmpty.prototype.getParams = function () {
        return this.params;
    };
    ZvoogFilterSourceEmpty.prototype.getValues = function () {
        return this.vals;
    };
    ZvoogFilterSourceEmpty.prototype.cancelSchedule = function () {
        //
    };
    ZvoogFilterSourceEmpty.prototype.schedule = function (when, tempo, chord) {
        //
    };
    ZvoogFilterSourceEmpty.prototype.busy = function () {
        return 0;
    };
    ZvoogFilterSourceEmpty.prototype.label = function () {
        return 'Empty filter or source';
    };
    return ZvoogFilterSourceEmpty;
}());
var TestSong = /** @class */ (function () {
    function TestSong() {
    }
    /*createRandomCurve(duration: number): ZvoogCurve {
        //console.log('createRandomCurve',duration);
        let cu: ZvoogCurve = {
            duration: duration
            , points: []
        };
        var curPoint: number = 0;
        while (curPoint < duration) {
            //var delta = Math.round(Math.random() * 5000 + 5000);
            var delta: number = 384 * (Math.random() > 0.5 ? 1 / 4 : 2);//{ count: Math.random() > 0.5 ? 0.25 : 0.5, division: duration.division };
            var po: ZvoogPoint = { duration: delta, velocity: Math.floor(Math.random() * 127) };
            cu.points.push(po);
            curPoint = curPoint + delta;
        }
        return cu;
    }
    createRandomPoint(duration: number):ZvoogPoint{

    }*/
    //createRandomLine(songlenseconds: number): ZvoogParameterLine {
    TestSong.prototype.createRandomLine = function (measures) {
        var lin = {
            points: []
        };
        var m = 0;
        lin.points.push({ skipMeasures: 0, skip384: 0, velocity: Math.floor(Math.random() * 127) });
        for (var i = 0; i < measures.length; i++) {
            m = m + 1;
            if (Math.random() > 0.8) {
                lin.points.push({ skipMeasures: m, skip384: 0, velocity: Math.floor(Math.random() * 127) });
                m = 0;
            }
        }
        /*
                var curPoint: number = 0;
                var songlenseconds = durations2time(measures);
                while (curPoint < songlenseconds) {
                    //var delta = Math.round(Math.random() * 24000 + 3000);
                    var delta: number = 1 + Math.round(Math.random() * songlenseconds);
                    var po: ZvoogPoint = { duration: delta, velocity: Math.floor(Math.random() * 127) };
                    lin.points.push(po);
                    curPoint = curPoint + delta;
                }*/
        return lin;
    };
    //createRandomEffect(songlenseconds: number): ZvoogTrackEffect {
    TestSong.prototype.createRandomEffect = function (measures) {
        var plugin = new ZvoogFilterSourceEmpty();
        var parameters = [];
        var parCount = 1 + Math.round(Math.random() * 5);
        for (var i = 0; i < parCount; i++) {
            parameters.push(this.createRandomLine(measures));
        }
        var fx = { plugin: plugin, parameters: parameters };
        return fx;
    };
    TestSong.prototype.createRandomPitch = function (pre) {
        var d = 384 / 8;
        if (Math.random() > 0.5) {
            d = 384 / 4;
        }
        if (Math.random() > 0.5) {
            d = 384 / 2;
        }
        var pi = {
            duration: d,
            pitch: (pre > 0) ? pre + Math.floor(Math.random() * 21 - 10) : Math.floor(Math.random() * 120)
            //,pitch: (pre > 0) ?pre+ 0 : Math.floor(Math.random() * 120)
        };
        //console.log(pre,pi.pitch);
        return pi;
    };
    TestSong.prototype.createRandomName = function () {
        var colors = ['Red', 'Green', 'Magenta', 'White', 'Yellow', 'Black', 'Pink', 'Blue', 'Cyan', 'Silver'];
        var cnt = 1 + Math.ceil(Math.random() * 3);
        var t = '';
        for (var i = 0; i < cnt; i++) {
            var n = Math.floor(Math.random() * colors.length);
            t = t + colors[n] + ' ';
        }
        return t;
    };
    TestSong.prototype.createRandomChord = function (count, division) {
        var ch = {
            //when: Math.round(Math.random() * duration.count ) 
            when: Math.floor((384 * Math.random() * count / division) / 24) * 24,
            values: [],
            title: '',
            fretHint: [],
            text: ''
        };
        if (Math.random() > 0.95) {
            ch.title = 'G' + Math.round(Math.random() * 10);
        }
        if (Math.random() > 0.95) {
            ch.title = 'Em' + Math.round(Math.random() * 10);
        }
        if (Math.random() > 0.95) {
            ch.title = 'A7' + Math.round(Math.random() * 10);
        }
        if (Math.random() > 0.95) {
            ch.text = 'Bla-bla-bla';
        }
        var valCount = Math.round(Math.random() * 2) + 1;
        /*var k: ZvoogKey = { envelope: [this.createRandomPitch()] };
        if (Math.random() > 0.9) {
            k.envelope.push(this.createRandomPitch());
        }*/
        for (var i = 0; i < valCount; i++) {
            //var pitch:ZvoogPitch=this.createRandomPitch();
            var k = {
                envelope: [this.createRandomPitch(0)],
                stepHint: 0,
                shiftHint: 0,
                octaveHint: 0
            };
            if (Math.random() > 0.9) {
                k.envelope.push(this.createRandomPitch(k.envelope[0].pitch));
            }
            //k.envelope.push(this.createRandomPitch(k.envelope[0].pitch));
            //k.envelope.push(this.createRandomPitch(k.envelope[0].pitch));
            ch.values.push(k);
        }
        return ch;
    };
    //createRandomChunk(count: number, division: number): ZvoogPattern {
    TestSong.prototype.createRandomChunk = function (meausere) {
        var p = {
            //meter: duration
            /*meter: {
                count: count
                , division: division
            }
            , tempo: Math.random() > 0.8 ? 120 : 100
            ,*/ chords: [],
            title: '/' + Math.round(Math.random() * 1000),
            clefHint: Math.round(Math.random() * 3),
            keyHint: Math.round(Math.random() * 22 - 11)
        };
        var chCount = 1 + Math.round(Math.random() * 2);
        for (var i = 0; i < chCount; i++) {
            p.chords.push(this.createRandomChord(meausere.meter.count, meausere.meter.division));
        }
        return p;
    };
    TestSong.prototype.createRandomMeasure = function (count, division) {
        var p = {
            meter: {
                count: count,
                division: division
            },
            tempo: Math.random() > 0.8 ? 120 : 100
        };
        return p;
    };
    TestSong.prototype.createRandomVoice = function (measures, voiceOrder) {
        var v = {
            chunks: [],
            source: {
                plugin: new ZvoogFilterSourceEmpty(),
                parameters: []
            },
            effects: [],
            title: this.createRandomName() + 'voice '
        };
        var parCount = 1 + Math.round(Math.random() * 5);
        for (var i = 0; i < parCount; i++) {
            v.source.parameters.push(this.createRandomLine(measures));
        }
        var mainFxCount = 1 + Math.round(Math.random() * 3);
        for (var i = 0; i < mainFxCount; i++) {
            v.effects.push(this.createRandomEffect(measures));
        }
        /*var curPoint: number = 0;
        while (curPoint < songlenseconds) {
            //var delta = Math.round(Math.random() * 5000 + 3000);
            //var delta: number = Math.random() > 0.9 ? 3 * 384 / 4 : 4 * 384 / 4;
            var cnt = Math.random() > 0.9 ? 3 : 4;
            v.chunks.push(this.createRandomChunk(cnt, 4));
            curPoint = curPoint + cnt * 384 / 4;
        }*/
        for (var i = 0; i < measures.length; i++) {
            v.chunks.push(this.createRandomChunk(measures[i]));
        }
        return v;
    };
    //createRandomTrack(songlenseconds: number, trackOrder: number): ZvoogTrack {
    TestSong.prototype.createRandomTrack = function (measures, trackOrder) {
        var t = {
            voices: [],
            effects: [],
            title: this.createRandomName() + 'track ',
            strings: []
        };
        var mainFxCount = 1 + Math.round(Math.random() * 3);
        for (var i = 0; i < mainFxCount; i++) {
            t.effects.push(this.createRandomEffect(measures));
        }
        var mainVoxCount = 1 + Math.round(Math.random() * 3 + 1);
        for (var i = 0; i < mainVoxCount; i++) {
            t.voices.push(this.createRandomVoice(measures, i));
        }
        return t;
    };
    TestSong.prototype.createKeyPattern = function () {
        var keyPattern = [];
        for (var o = 0; o < 10; o++) {
            keyPattern.push(3);
            keyPattern.push(2);
            keyPattern.push(1);
            keyPattern.push(2);
            keyPattern.push(1);
            keyPattern.push(1);
            keyPattern.push(2);
            keyPattern.push(1);
            keyPattern.push(2);
            keyPattern.push(1);
            keyPattern.push(2);
            keyPattern.push(1);
        }
        return keyPattern;
    };
    TestSong.prototype.createRandomSchedule = function () {
        //var duration: ZvoogMeter = { count: Math.round(Math.random() * 100 + 50) * 4, division: 4 };//Math.round(Math.random() * 2 + 1) * 60000;
        var songdurationseconds = Math.round(Math.random() * 200 + 150) * 50; //Math.round(Math.random() * 2 + 1) * 60000;
        var t = this.createRandomName() + 'project';
        var s = {
            title: t,
            description: this.createRandomName() + 'description'
            //, duration: duration
            ,
            timeline: [],
            tracks: [],
            effects: [],
            macros: [
            /*
                            {
                                key: undoRedoBunch, point: { x: 0, y: 0, z: 100 }, properties: {
                                    commands: [
                                        { key: undoRedoChangeProjectTitle, properties: { oldTitle: 'old project title', newTitle: 'Next title' }, point: { x: 0, y: 0, z: 100 } }
                                        , { key: undoRedoChangeProjectTitle, properties: { oldTitle: 'Next title', newTitle: 'Another title' }, point: { x: 0, y: 0, z: 100 } }
                                        , { key: undoRedoChangeProjectTitle, properties: { oldTitle: 'Another title', newTitle: t }, point: { x: 0, y: 0, z: 100 } }
                                    ]
                                }
                            }*/
            ],
            macroPosition: 2,
            masterPosition: 1,
            gridPattern: [
                { duration: 384 / 16, power: 3 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 1 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 2 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 1 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 },
                { duration: 384 / 16, power: 0 }
            ],
            keyPattern: this.createKeyPattern(),
            horizontal: true,
            locked: false,
            selectedLayer: { level1: 0, level2: 0, level3: 0, level4: 0 }
        };
        var curPoint = 0;
        while (curPoint < songdurationseconds) {
            var cnt = Math.random() > 0.9 ? 3 : 4;
            var measure = this.createRandomMeasure(cnt, 4);
            s.timeline.push(measure);
            curPoint = curPoint + cnt * 384 / 4;
        }
        var mainFxCount = 1 + Math.round(Math.random() * 3);
        //console.log('mainFxCount',mainFxCount);
        for (var i = 0; i < mainFxCount; i++) {
            s.effects.push(this.createRandomEffect(s.timeline));
        }
        var trkCount = Math.round(Math.random() * 5) + 1;
        for (var i = 0; i < trkCount; i++) {
            s.tracks.push(this.createRandomTrack(s.timeline, i));
        }
        var tc = 0;
        var vc = 0;
        if (s.tracks.length > 1)
            tc = 1;
        if (s.tracks[tc].voices.length > 1)
            vc = 1;
        s.selectedLayer.level1 = tc;
        s.selectedLayer.level2 = vc;
        return s;
    };
    return TestSong;
}());
console.log('ZvoogEngine v1.52');
//function duration2time(bpm: number, duration: ZvoogMeter): number {
function duration2time(bpm, duration384) {
    var n4 = 60 / bpm;
    //var part = duration.division / (4 * duration.count);
    var part = 384 / (4 * duration384);
    return n4 / part;
}
function durations2time(measures) {
    var t = 0;
    for (var i = 0; i < measures.length; i++) {
        t = t + duration2time(measures[i].tempo, duration384(measures[i].meter));
    }
    return t;
}
function time2Duration(time, bpm) {
    var n4 = 60 / bpm;
    var n384 = n4 / 96;
    return Math.round(time / n384);
}
function duration384(meter) {
    return meter.count * (384 / meter.division);
}
var UndoRedoKeys;
(function (UndoRedoKeys) {
    UndoRedoKeys["undoRedoChangeProjectTitle"] = "changeProjectTitle";
    UndoRedoKeys["undoRedoChangeProjectDescription"] = "changeProjectDescription";
    UndoRedoKeys["undoRedoSelectLayer"] = "selectLayer";
    UndoRedoKeys["undoRedoBunch"] = "bunch";
})(UndoRedoKeys || (UndoRedoKeys = {}));
;
var ZvoogPlayer = /** @class */ (function () {
    function ZvoogPlayer() {
        this.afterTime = 0.05;
        this.envelopes = [];
        this.nearZero = 0.000001;
        this.instrumentKeyArray = [];
        this.instrumentNamesArray = [];
        this.wafratio = 0.5;
        this.drumKeyArray = [];
        this.drumNamesArray = [];
    }
    ZvoogPlayer.prototype.waitGlobalVariable = function (variableName, onFinish) {
        if (window[variableName]) {
            if (window[variableName]) {
                onFinish();
                return;
            }
        }
        var me = this;
        setTimeout(function () {
            me.waitGlobalVariable(variableName, onFinish);
        }, 111);
    };
    ZvoogPlayer.prototype.zones = function (variableName) {
        if (window[variableName]) {
            var preset = window[variableName];
            for (var i = 0; i < preset.zones.length; i++) {
                if (!(preset.zones[i].buffer)) {
                    return null;
                }
            }
            return window[variableName];
        }
        else {
            return null;
        }
    };
    ZvoogPlayer.prototype.afterAdjust = function (variableName, onFinish) {
        if (window[variableName]) {
            var preset = window[variableName];
            var done = true;
            for (var i = 0; i < preset.zones.length; i++) {
                done = done && (!!(preset.zones[i].buffer));
            }
            if (done) {
                onFinish();
                return;
            }
        }
        var me = this;
        setTimeout(function () {
            me.afterAdjust(variableName, onFinish);
        }, 111);
    };
    ZvoogPlayer.prototype.adjustPreset = function (audioContext, preset) {
        for (var i = 0; i < preset.zones.length; i++) {
            this.adjustZone(audioContext, preset.zones[i]);
        }
    };
    ;
    ZvoogPlayer.prototype.adjustAHDSR = function (zone) {
        if (zone.ahdsr) {
            if (zone.ahdsr.length > 0) {
                zone.ahdsrPoints = [];
                for (var i = 0; i < zone.ahdsr.length; i++) {
                    zone.ahdsrPoints.push({
                        duration: zone.ahdsr[i].duration,
                        volume: zone.ahdsr[i].volume
                    });
                }
            }
            else {
                zone.ahdsrPoints = [{
                        duration: 3, volume: 1
                    }, {
                        duration: 0.5, volume: 0.75
                    }, {
                        duration: 1.5, volume: 0.5
                    }, {
                        duration: 3, volume: 0
                    }];
            }
        }
        else {
            zone.ahdsrPoints = [{
                    duration: 3600,
                    volume: 1
                }
            ];
        }
    };
    ZvoogPlayer.prototype.adjustZone = function (audioContext, zone) {
        if (zone.buffer) {
            //
        }
        else {
            zone.delay = 0;
            this.adjustAHDSR(zone);
            if (zone.sample) {
                var decoded = atob(zone.sample);
                zone.buffer = audioContext.createBuffer(1, decoded.length / 2, zone.sampleRate);
                var float32Array = zone.buffer.getChannelData(0);
                var b1 = void 0;
                var b2 = void 0;
                var n = void 0;
                for (var i = 0; i < decoded.length / 2; i++) {
                    b1 = decoded.charCodeAt(i * 2);
                    b2 = decoded.charCodeAt(i * 2 + 1);
                    if (b1 < 0) {
                        b1 = 256 + b1;
                    }
                    if (b2 < 0) {
                        b2 = 256 + b2;
                    }
                    n = b2 * 256 + b1;
                    if (n >= 65536 / 2) {
                        n = n - 65536;
                    }
                    float32Array[i] = n / 65536.0;
                }
                //console.log('sample parsed');
            }
            else {
                if (zone.file) {
                    var datalen = zone.file.length;
                    var arraybuffer = new ArrayBuffer(datalen);
                    var view = new Uint8Array(arraybuffer);
                    var decoded = atob(zone.file);
                    var b = void 0;
                    for (var i = 0; i < decoded.length; i++) {
                        b = decoded.charCodeAt(i);
                        view[i] = b;
                    }
                    audioContext.decodeAudioData(arraybuffer, function (audioBuffer) {
                        zone.buffer = audioBuffer;
                        //console.log('file parsed');
                    });
                }
            }
        }
    };
    ZvoogPlayer.prototype.numValue = function (aValue, defValue) {
        if (typeof aValue === "number") {
            return aValue;
        }
        else {
            return defValue;
        }
    };
    ;
    ZvoogPlayer.prototype.noZeroVolume = function (n) {
        if (n > this.nearZero) {
            return n;
        }
        else {
            return this.nearZero;
        }
    };
    ZvoogPlayer.prototype.findZone = function (preset, pitch) {
        for (var i = preset.zones.length - 1; i >= 0; i--) {
            var zone = preset.zones[i];
            if (zone.keyRangeLow <= pitch && zone.keyRangeHigh + 1 >= pitch) {
                return zone;
            }
        }
        return null;
    };
    ;
    ZvoogPlayer.prototype.findEnvelope = function (audioContext, target, preset) {
        var envelope = null;
        for (var i = 0; i < this.envelopes.length; i++) {
            var e = this.envelopes[i];
            if (e.target == target && audioContext.currentTime > e.when + e.duration + 0.001) {
                try {
                    if (e.audioBufferSourceNode) {
                        e.audioBufferSourceNode.disconnect();
                        e.audioBufferSourceNode.stop(0);
                        e.audioBufferSourceNode = null;
                    }
                }
                catch (x) {
                    //audioBufferSourceNode is dead already
                }
                envelope = e;
                break;
            }
        }
        if (!(envelope)) {
            envelope = {
                base: audioContext.createGain(),
                target: target,
                audioBufferSourceNode: null,
                when: 0,
                duration: 0,
                pitch: 0,
                preset: preset,
                cancel: function () {
                    if (envelope)
                        if (envelope.when + envelope.duration > audioContext.currentTime) {
                            envelope.base.gain.cancelScheduledValues(0);
                            envelope.base.gain.setTargetAtTime(0.00001, audioContext.currentTime, 0.1);
                            envelope.when = audioContext.currentTime + 0.00001;
                            envelope.duration = 0;
                        }
                }
            };
            envelope.base.gain.setValueAtTime(this.wafratio, 0);
            envelope.base.connect(target);
            this.envelopes.push(envelope);
        }
        return envelope;
    };
    ;
    ZvoogPlayer.prototype.setupEnvelope = function (audioContext, envelope, zone //, volume: number
    , when, waveDuration, noteDuration) {
        envelope.base.gain.setValueAtTime(this.noZeroVolume(0), audioContext.currentTime);
        var playDuration = noteDuration;
        var envPoints = zone.ahdsrPoints;
        if (waveDuration < playDuration + this.afterTime) {
            playDuration = waveDuration - this.afterTime;
        }
        envelope.base.gain.cancelScheduledValues(when);
        var currentDuration = 0;
        var currentVolume = envPoints[0].volume;
        envelope.base.gain.setValueAtTime(this.noZeroVolume(currentVolume * this.wafratio), when);
        for (var i = 0; i < envPoints.length; i++) {
            if (currentDuration + envPoints[i].duration > playDuration) {
                var remains = envPoints[i].duration + currentDuration - playDuration;
                var ratio = 1 - remains / envPoints[i].duration;
                var revolume = currentVolume - ratio * (currentVolume - envPoints[i].volume);
                envelope.base.gain.linearRampToValueAtTime(this.noZeroVolume(revolume * this.wafratio), when + playDuration);
                break;
            }
            currentDuration = currentDuration + envPoints[i].duration;
            currentVolume = envPoints[i].volume;
            envelope.base.gain.linearRampToValueAtTime(this.noZeroVolume(currentVolume * this.wafratio), when + currentDuration);
        }
        if (currentDuration < playDuration) {
            envelope.base.gain.linearRampToValueAtTime(this.noZeroVolume(currentVolume * this.wafratio), when + playDuration);
        }
        envelope.base.gain.linearRampToValueAtTime(this.noZeroVolume(0), when + playDuration + this.afterTime);
    };
    ;
    ZvoogPlayer.prototype.calculateDuration = function (tempo, pitches) {
        var r = 0;
        for (var i = 0; i < pitches.length; i++) {
            //if(pitches.length>1)console.log(r,pitches[i].duration);
            if (pitches[i].duration)
                r = r + duration2time(tempo, pitches[i].duration);
        }
        //if(pitches.length>1)console.log(r,pitches);
        return r;
    };
    ZvoogPlayer.prototype.queueWaveTable = function (audioContext, target, preset, when, tempo, pitches) {
        if (audioContext.state == 'suspended') {
            console.log('audioContext.resume');
            audioContext.resume();
        }
        var pitch = pitches[0].pitch;
        var zone = this.findZone(preset, pitch);
        if (!zone) {
            console.log('no zone for', pitch, 'in', preset);
            return null;
        }
        if (!(zone.buffer)) {
            console.log('empty buffer', zone);
            return null;
        }
        var duration = this.calculateDuration(tempo, pitches);
        if (when > 0 && when + duration < audioContext.currentTime) {
            console.log('skip');
            return null;
        }
        var baseDetune = zone.originalPitch - 100.0 * zone.coarseTune - zone.fineTune;
        var currentPlaybackRate = 1.0 * Math.pow(2, (100.0 * pitch - baseDetune) / 1200.0);
        var startWhen = when;
        if (startWhen < audioContext.currentTime) {
            startWhen = audioContext.currentTime;
        }
        var waveDuration = duration + this.afterTime;
        var loop = true;
        if (zone.loopStart < 1 || zone.loopStart >= zone.loopEnd) {
            loop = false;
        }
        if (!loop) {
            if (waveDuration > zone.buffer.duration / currentPlaybackRate) {
                waveDuration = zone.buffer.duration / currentPlaybackRate;
            }
        }
        var envelope = this.findEnvelope(audioContext, target, preset);
        this.setupEnvelope(audioContext, envelope, zone, startWhen, waveDuration, duration);
        envelope.audioBufferSourceNode = audioContext.createBufferSource();
        envelope.audioBufferSourceNode.playbackRate.setValueAtTime(currentPlaybackRate, 0);
        envelope.audioBufferSourceNode.playbackRate.setValueAtTime(currentPlaybackRate, startWhen);
        if (pitches.length > 1) {
            //console.log('start', duration, startWhen.toFixed(3), (startWhen + duration));
            var newWhen = startWhen;
            for (var i = 1; i < pitches.length; i++) {
                var newPlaybackRate = 1.0 * Math.pow(2, (100.0 * pitches[i].pitch - baseDetune) / 1200.0);
                //console.log(i, newWhen.toFixed(3), (newWhen + pitches[i - 1].duration).toFixed(3));
                if (pitches[i - 1].duration) {
                    newWhen = newWhen + duration2time(tempo, pitches[i - 1].duration);
                    //if(newWhen>oldWhen+0.01){
                    envelope.audioBufferSourceNode.playbackRate.linearRampToValueAtTime(newPlaybackRate, newWhen);
                    //oldWhen=newWhen
                }
            }
        }
        envelope.audioBufferSourceNode.buffer = zone.buffer;
        if (loop) {
            envelope.audioBufferSourceNode.loop = true;
            envelope.audioBufferSourceNode.loopStart = zone.loopStart / zone.sampleRate + zone.delay;
            envelope.audioBufferSourceNode.loopEnd = zone.loopEnd / zone.sampleRate + zone.delay;
        }
        else {
            envelope.audioBufferSourceNode.loop = false;
        }
        envelope.audioBufferSourceNode.connect(envelope.base);
        envelope.audioBufferSourceNode.start(startWhen, zone.delay);
        envelope.audioBufferSourceNode.stop(startWhen + waveDuration);
        envelope.when = startWhen;
        envelope.duration = waveDuration;
        envelope.pitch = pitch;
        envelope.preset = preset;
        return envelope;
    };
    ;
    ZvoogPlayer.prototype.cancelQueue = function (audioContext) {
        for (var i = 0; i < this.envelopes.length; i++) {
            var e = this.envelopes[i];
            e.base.gain.cancelScheduledValues(0);
            e.base.gain.setValueAtTime(this.nearZero, audioContext.currentTime + 0.01);
            e.when = -1;
            //console.log(e);
            try {
                if (e.audioBufferSourceNode)
                    e.audioBufferSourceNode.disconnect();
                //console.log('disconnect');
            }
            catch (ex) {
                console.log(ex);
            }
        }
    };
    ;
    ZvoogPlayer.prototype.instrumentKeys = function () {
        if (this.instrumentKeyArray.length) {
            //
        }
        else {
            this.instrumentKeyArray = [
                '0000_JCLive_sf2_file', '0000_Aspirin_sf2_file', '0000_Chaos_sf2_file', '0000_FluidR3_GM_sf2_file', '0000_GeneralUserGS_sf2_file', '0000_SBLive_sf2',
                '0000_SoundBlasterOld_sf2', '0001_FluidR3_GM_sf2_file', '0001_GeneralUserGS_sf2_file', '0002_GeneralUserGS_sf2_file', '0003_GeneralUserGS_sf2_file',
                '0010_Aspirin_sf2_file', '0010_Chaos_sf2_file', '0010_FluidR3_GM_sf2_file', '0010_GeneralUserGS_sf2_file', '0010_JCLive_sf2_file', '0010_SBLive_sf2',
                '0010_SoundBlasterOld_sf2', '0011_Aspirin_sf2_file', '0011_FluidR3_GM_sf2_file', '0011_GeneralUserGS_sf2_file', '0012_GeneralUserGS_sf2_file',
                '0020_Aspirin_sf2_file', '0020_Chaos_sf2_file', '0020_FluidR3_GM_sf2_file', '0020_GeneralUserGS_sf2_file', '0020_JCLive_sf2_file', '0020_SBLive_sf2',
                '0020_SoundBlasterOld_sf2', '0021_Aspirin_sf2_file', '0021_GeneralUserGS_sf2_file', '0022_Aspirin_sf2_file', '0030_Aspirin_sf2_file', '0030_Chaos_sf2_file',
                '0030_FluidR3_GM_sf2_file', '0030_GeneralUserGS_sf2_file', '0030_JCLive_sf2_file', '0030_SBLive_sf2', '0030_SoundBlasterOld_sf2', '0031_Aspirin_sf2_file',
                '0031_FluidR3_GM_sf2_file', '0031_GeneralUserGS_sf2_file', '0031_SoundBlasterOld_sf2', '0040_Aspirin_sf2_file', '0040_Chaos_sf2_file', '0040_FluidR3_GM_sf2_file',
                '0040_GeneralUserGS_sf2_file', '0040_JCLive_sf2_file', '0040_SBLive_sf2', '0040_SoundBlasterOld_sf2', '0041_FluidR3_GM_sf2_file', '0041_GeneralUserGS_sf2_file',
                '0041_SoundBlasterOld_sf2', '0042_GeneralUserGS_sf2_file', '0043_GeneralUserGS_sf2_file', '0044_GeneralUserGS_sf2_file', '0045_GeneralUserGS_sf2_file',
                '0046_GeneralUserGS_sf2_file', '0050_Aspirin_sf2_file', '0050_Chaos_sf2_file', '0050_FluidR3_GM_sf2_file', '0050_GeneralUserGS_sf2_file', '0050_JCLive_sf2_file',
                '0050_SBLive_sf2', '0050_SoundBlasterOld_sf2', '0051_FluidR3_GM_sf2_file', '0051_GeneralUserGS_sf2_file', '0052_GeneralUserGS_sf2_file', '0053_GeneralUserGS_sf2_file',
                '0054_GeneralUserGS_sf2_file', '0060_Aspirin_sf2_file', '0060_Chaos_sf2_file', '0060_FluidR3_GM_sf2_file', '0060_GeneralUserGS_sf2_file', '0060_JCLive_sf2_file',
                '0060_SBLive_sf2', '0060_SoundBlasterOld_sf2', '0061_Aspirin_sf2_file', '0061_GeneralUserGS_sf2_file', '0061_SoundBlasterOld_sf2', '0062_GeneralUserGS_sf2_file',
                '0070_Aspirin_sf2_file', '0070_Chaos_sf2_file', '0070_FluidR3_GM_sf2_file', '0070_GeneralUserGS_sf2_file', '0070_JCLive_sf2_file', '0070_SBLive_sf2',
                '0070_SoundBlasterOld_sf2', '0071_GeneralUserGS_sf2_file', '0080_Aspirin_sf2_file', '0080_Chaos_sf2_file', '0080_FluidR3_GM_sf2_file', '0080_GeneralUserGS_sf2_file',
                '0080_JCLive_sf2_file', '0080_SBLive_sf2', '0080_SoundBlasterOld_sf2', '0081_FluidR3_GM_sf2_file', '0081_GeneralUserGS_sf2_file', '0081_SoundBlasterOld_sf2',
                '0090_Aspirin_sf2_file', '0090_Chaos_sf2_file', '0090_FluidR3_GM_sf2_file', '0090_GeneralUserGS_sf2_file', '0090_JCLive_sf2_file', '0090_SBLive_sf2',
                '0090_SoundBlasterOld_sf2', '0091_SoundBlasterOld_sf2', '0100_Aspirin_sf2_file', '0100_Chaos_sf2_file', '0100_FluidR3_GM_sf2_file', '0100_GeneralUserGS_sf2_file',
                '0100_JCLive_sf2_file', '0100_SBLive_sf2', '0100_SoundBlasterOld_sf2', '0101_GeneralUserGS_sf2_file', '0101_SoundBlasterOld_sf2', '0110_Aspirin_sf2_file',
                '0110_Chaos_sf2_file', '0110_FluidR3_GM_sf2_file', '0110_GeneralUserGS_sf2_file', '0110_JCLive_sf2_file', '0110_SBLive_sf2', '0110_SoundBlasterOld_sf2',
                '0111_FluidR3_GM_sf2_file', '0120_Aspirin_sf2_file', '0120_Chaos_sf2_file', '0120_FluidR3_GM_sf2_file', '0120_GeneralUserGS_sf2_file', '0120_JCLive_sf2_file',
                '0120_SBLive_sf2', '0120_SoundBlasterOld_sf2', '0121_FluidR3_GM_sf2_file', '0121_GeneralUserGS_sf2_file', '0130_Aspirin_sf2_file', '0130_Chaos_sf2_file',
                '0130_FluidR3_GM_sf2_file', '0130_GeneralUserGS_sf2_file', '0130_JCLive_sf2_file', '0130_SBLive_sf2', '0130_SoundBlasterOld_sf2', '0131_FluidR3_GM_sf2_file',
                '0140_Aspirin_sf2_file', '0140_Chaos_sf2_file', '0140_FluidR3_GM_sf2_file', '0140_GeneralUserGS_sf2_file', '0140_JCLive_sf2_file', '0140_SBLive_sf2',
                '0140_SoundBlasterOld_sf2', '0141_FluidR3_GM_sf2_file', '0141_GeneralUserGS_sf2_file', '0142_GeneralUserGS_sf2_file', '0143_GeneralUserGS_sf2_file',
                '0150_Aspirin_sf2_file', '0150_Chaos_sf2_file', '0150_FluidR3_GM_sf2_file', '0150_GeneralUserGS_sf2_file', '0150_JCLive_sf2_file', '0150_SBLive_sf2',
                '0150_SoundBlasterOld_sf2', '0151_FluidR3_GM_sf2_file', '0160_Aspirin_sf2_file', '0160_Chaos_sf2_file', '0160_FluidR3_GM_sf2_file', '0160_GeneralUserGS_sf2_file',
                '0160_JCLive_sf2_file', '0160_SBLive_sf2', '0160_SoundBlasterOld_sf2', '0161_Aspirin_sf2_file', '0161_FluidR3_GM_sf2_file', '0161_SoundBlasterOld_sf2',
                '0170_Aspirin_sf2_file', '0170_Chaos_sf2_file', '0170_FluidR3_GM_sf2_file', '0170_GeneralUserGS_sf2_file', '0170_JCLive_sf2_file', '0170_SBLive_sf2',
                '0170_SoundBlasterOld_sf2', '0171_FluidR3_GM_sf2_file', '0171_GeneralUserGS_sf2_file', '0172_FluidR3_GM_sf2_file', '0180_Aspirin_sf2_file', '0180_Chaos_sf2_file',
                '0180_FluidR3_GM_sf2_file', '0180_GeneralUserGS_sf2_file', '0180_JCLive_sf2_file', '0180_SBLive_sf2', '0180_SoundBlasterOld_sf2', '0181_Aspirin_sf2_file',
                '0181_GeneralUserGS_sf2_file', '0181_SoundBlasterOld_sf2', '0190_Aspirin_sf2_file', '0190_Chaos_sf2_file', '0190_FluidR3_GM_sf2_file',
                '0190_GeneralUserGS_sf2_file', '0190_JCLive_sf2_file', '0190_SBLive_sf2', '0190_SoundBlasterOld_sf2', '0191_Aspirin_sf2_file', '0191_GeneralUserGS_sf2_file', '0191_SoundBlasterOld_sf2',
                '0200_Aspirin_sf2_file', '0200_Chaos_sf2_file', '0200_FluidR3_GM_sf2_file', '0200_GeneralUserGS_sf2_file', '0200_JCLive_sf2_file', '0200_SBLive_sf2',
                '0200_SoundBlasterOld_sf2', '0201_Aspirin_sf2_file', '0201_FluidR3_GM_sf2_file', '0201_GeneralUserGS_sf2_file', '0201_SoundBlasterOld_sf2', '0210_Aspirin_sf2_file',
                '0210_Chaos_sf2_file', '0210_FluidR3_GM_sf2_file', '0210_GeneralUserGS_sf2_file', '0210_JCLive_sf2_file', '0210_SBLive_sf2', '0210_SoundBlasterOld_sf2',
                '0211_Aspirin_sf2_file', '0211_FluidR3_GM_sf2_file', '0211_GeneralUserGS_sf2_file', '0211_SoundBlasterOld_sf2', '0212_GeneralUserGS_sf2_file',
                '0220_Aspirin_sf2_file', '0220_Chaos_sf2_file', '0220_FluidR3_GM_sf2_file', '0220_GeneralUserGS_sf2_file', '0220_JCLive_sf2_file', '0220_SBLive_sf2',
                '0220_SoundBlasterOld_sf2', '0221_FluidR3_GM_sf2_file', '0230_Aspirin_sf2_file', '0230_Chaos_sf2_file', '0230_FluidR3_GM_sf2_file', '0230_GeneralUserGS_sf2_file',
                '0230_JCLive_sf2_file', '0230_SBLive_sf2', '0230_SoundBlasterOld_sf2', '0231_FluidR3_GM_sf2_file', '0231_GeneralUserGS_sf2_file', '0231_JCLive_sf2_file',
                '0231_SoundBlasterOld_sf2', '0232_FluidR3_GM_sf2_file', '0233_FluidR3_GM_sf2_file', '0240_Aspirin_sf2_file', '0240_Chaos_sf2_file', '0240_FluidR3_GM_sf2_file',
                '0240_GeneralUserGS_sf2_file', '0240_JCLive_sf2_file', '0240_LK_Godin_Nylon_SF2_file', '0240_SBLive_sf2', '0240_SoundBlasterOld_sf2',
                '0241_GeneralUserGS_sf2_file', '0241_JCLive_sf2_file', '0242_JCLive_sf2_file', '0243_JCLive_sf2_file', '0253_Acoustic_Guitar_sf2_file', '0250_Aspirin_sf2_file',
                '0250_Chaos_sf2_file', '0250_FluidR3_GM_sf2_file', '0250_GeneralUserGS_sf2_file', '0250_JCLive_sf2_file', '0250_LK_AcousticSteel_SF2_file', '0250_SBLive_sf2', '0250_SoundBlasterOld_sf2', '0251_Acoustic_Guitar_sf2_file', '0251_GeneralUserGS_sf2_file', '0252_Acoustic_Guitar_sf2_file', '0252_GeneralUserGS_sf2_file',
                '0253_Acoustic_Guitar_sf2_file', '0253_GeneralUserGS_sf2_file', '0254_Acoustic_Guitar_sf2_file', '0254_GeneralUserGS_sf2_file', '0255_GeneralUserGS_sf2_file',
                '0260_Aspirin_sf2_file', '0260_Chaos_sf2_file', '0260_FluidR3_GM_sf2_file', '0260_GeneralUserGS_sf2_file', '0260_JCLive_sf2_file', '0260_SBLive_sf2',
                '0260_SoundBlasterOld_sf2', '0260_Stratocaster_sf2_file', '0261_GeneralUserGS_sf2_file', '0261_SoundBlasterOld_sf2', '0261_Stratocaster_sf2_file',
                '0262_Stratocaster_sf2_file', '0270_Aspirin_sf2_file', '0270_Chaos_sf2_file', '0270_FluidR3_GM_sf2_file', '0270_GeneralUserGS_sf2_file',
                '0270_Gibson_Les_Paul_sf2_file', '0270_JCLive_sf2_file', '0270_SBAWE32_sf2_file', '0270_SBLive_sf2', '0270_SoundBlasterOld_sf2', '0270_Stratocaster_sf2_file',
                '0271_GeneralUserGS_sf2_file', '0271_Stratocaster_sf2_file', '0272_Stratocaster_sf2_file', '0280_Aspirin_sf2_file', '0280_Chaos_sf2_file',
                '0280_FluidR3_GM_sf2_file', '0280_GeneralUserGS_sf2_file', '0280_JCLive_sf2_file', '0280_LesPaul_sf2', '0280_LesPaul_sf2_file', '0280_SBAWE32_sf2_file',
                '0280_SBLive_sf2', '0280_SoundBlasterOld_sf2', '0281_Aspirin_sf2_file', '0281_FluidR3_GM_sf2_file', '0281_GeneralUserGS_sf2_file', '0282_FluidR3_GM_sf2_file',
                '0282_GeneralUserGS_sf2_file', '0283_GeneralUserGS_sf2_file', '0290_Aspirin_sf2_file', '0290_Chaos_sf2_file', '0290_FluidR3_GM_sf2_file', '0290_GeneralUserGS_sf2_file', '0290_JCLive_sf2_file', '0290_LesPaul_sf2', '0290_LesPaul_sf2_file', '0290_SBAWE32_sf2_file', '0290_SBLive_sf2', '0290_SoundBlasterOld_sf2', '0291_Aspirin_sf2_file', '0291_LesPaul_sf2', '0291_LesPaul_sf2_file', '0291_SBAWE32_sf2_file', '0291_SoundBlasterOld_sf2', '0292_Aspirin_sf2_file', '0292_LesPaul_sf2', '0292_LesPaul_sf2_file', '0300_Aspirin_sf2_file', '0300_Chaos_sf2_file', '0300_FluidR3_GM_sf2_file', '0300_GeneralUserGS_sf2_file', '0300_JCLive_sf2_file', '0300_LesPaul_sf2', '0300_LesPaul_sf2_file', '0300_SBAWE32_sf2_file', '0300_SBLive_sf2', '0300_SoundBlasterOld_sf2', '0301_Aspirin_sf2_file', '0301_FluidR3_GM_sf2_file', '0301_GeneralUserGS_sf2_file', '0301_JCLive_sf2_file', '0301_LesPaul_sf2', '0301_LesPaul_sf2_file', '0302_Aspirin_sf2_file', '0302_GeneralUserGS_sf2_file', '0302_JCLive_sf2_file', '0303_Aspirin_sf2_file', '0304_Aspirin_sf2_file', '0310_Aspirin_sf2_file', '0310_Chaos_sf2_file', '0310_FluidR3_GM_sf2_file', '0310_GeneralUserGS_sf2_file', '0310_JCLive_sf2_file', '0310_LesPaul_sf2', '0310_LesPaul_sf2_file', '0310_SBAWE32_sf2_file', '0310_SBLive_sf2', '0310_SoundBlasterOld_sf2', '0311_FluidR3_GM_sf2_file', '0311_GeneralUserGS_sf2_file', '0320_Aspirin_sf2_file', '0320_Chaos_sf2_file', '0320_FluidR3_GM_sf2_file', '0320_GeneralUserGS_sf2_file', '0320_JCLive_sf2_file', '0320_SBLive_sf2', '0320_SoundBlasterOld_sf2', '0321_GeneralUserGS_sf2_file', '0322_GeneralUserGS_sf2_file', '0330_Aspirin_sf2_file', '0330_Chaos_sf2_file', '0330_FluidR3_GM_sf2_file', '0330_GeneralUserGS_sf2_file', '0330_JCLive_sf2_file', '0330_SBLive_sf2', '0330_SoundBlasterOld_sf2', '0331_GeneralUserGS_sf2_file', '0332_GeneralUserGS_sf2_file', '0340_Aspirin_sf2_file', '0340_Chaos_sf2_file', '0340_FluidR3_GM_sf2_file', '0340_GeneralUserGS_sf2_file', '0340_JCLive_sf2_file', '0340_SBLive_sf2', '0340_SoundBlasterOld_sf2', '0341_Aspirin_sf2_file', '0341_GeneralUserGS_sf2_file', '0350_Aspirin_sf2_file', '0350_Chaos_sf2_file', '0350_FluidR3_GM_sf2_file', '0350_GeneralUserGS_sf2_file', '0350_JCLive_sf2_file', '0350_SBLive_sf2', '0350_SoundBlasterOld_sf2', '0351_GeneralUserGS_sf2_file', '0360_Aspirin_sf2_file', '0360_Chaos_sf2_file', '0360_FluidR3_GM_sf2_file', '0360_GeneralUserGS_sf2_file', '0360_JCLive_sf2_file', '0360_SBLive_sf2', '0360_SoundBlasterOld_sf2', '0361_GeneralUserGS_sf2_file', '0370_Aspirin_sf2_file', '0370_Chaos_sf2_file', '0370_FluidR3_GM_sf2_file', '0370_GeneralUserGS_sf2_file', '0370_JCLive_sf2_file', '0370_SBLive_sf2', '0370_SoundBlasterOld_sf2', '0371_GeneralUserGS_sf2_file', '0372_GeneralUserGS_sf2_file', '0380_Aspirin_sf2_file', '0380_Chaos_sf2_file', '0380_FluidR3_GM_sf2_file', '0380_GeneralUserGS_sf2_file', '0380_JCLive_sf2_file', '0380_SBLive_sf2', '0380_SoundBlasterOld_sf2', '0381_FluidR3_GM_sf2_file', '0381_GeneralUserGS_sf2_file', '0382_FluidR3_GM_sf2_file', '0382_GeneralUserGS_sf2_file', '0383_GeneralUserGS_sf2_file', '0384_GeneralUserGS_sf2_file', '0385_GeneralUserGS_sf2_file', '0386_GeneralUserGS_sf2_file', '0387_GeneralUserGS_sf2_file', '0390_Aspirin_sf2_file', '0390_Chaos_sf2_file', '0390_FluidR3_GM_sf2_file', '0390_GeneralUserGS_sf2_file', '0390_JCLive_sf2_file', '0390_SBLive_sf2', '0390_SoundBlasterOld_sf2', '0391_FluidR3_GM_sf2_file', '0391_GeneralUserGS_sf2_file', '0391_SoundBlasterOld_sf2', '0392_FluidR3_GM_sf2_file', '0392_GeneralUserGS_sf2_file', '0393_GeneralUserGS_sf2_file', '0400_Aspirin_sf2_file', '0400_Chaos_sf2_file', '0400_FluidR3_GM_sf2_file', '0400_GeneralUserGS_sf2_file', '0400_JCLive_sf2_file', '0400_SBLive_sf2', '0400_SoundBlasterOld_sf2', '0401_Aspirin_sf2_file', '0401_FluidR3_GM_sf2_file', '0401_GeneralUserGS_sf2_file', '0402_GeneralUserGS_sf2_file', '0410_Aspirin_sf2_file', '0410_Chaos_sf2_file', '0410_FluidR3_GM_sf2_file', '0410_GeneralUserGS_sf2_file', '0410_JCLive_sf2_file', '0410_SBLive_sf2', '0410_SoundBlasterOld_sf2', '0411_FluidR3_GM_sf2_file', '0420_Aspirin_sf2_file', '0420_Chaos_sf2_file', '0420_FluidR3_GM_sf2_file', '0420_GeneralUserGS_sf2_file', '0420_JCLive_sf2_file', '0420_SBLive_sf2', '0420_SoundBlasterOld_sf2', '0421_FluidR3_GM_sf2_file', '0421_GeneralUserGS_sf2_file', '0430_Aspirin_sf2_file', '0430_Chaos_sf2_file', '0430_FluidR3_GM_sf2_file', '0430_GeneralUserGS_sf2_file', '0430_JCLive_sf2_file', '0430_SBLive_sf2', '0430_SoundBlasterOld_sf2', '0431_FluidR3_GM_sf2_file', '0440_Aspirin_sf2_file', '0440_Chaos_sf2_file', '0440_FluidR3_GM_sf2_file', '0440_GeneralUserGS_sf2_file', '0440_JCLive_sf2_file', '0440_SBLive_sf2', '0440_SoundBlasterOld_sf2', '0441_GeneralUserGS_sf2_file', '0442_GeneralUserGS_sf2_file', '0450_Aspirin_sf2_file', '0450_Chaos_sf2_file', '0450_FluidR3_GM_sf2_file', '0450_GeneralUserGS_sf2_file', '0450_JCLive_sf2_file', '0450_SBLive_sf2', '0450_SoundBlasterOld_sf2', '0451_FluidR3_GM_sf2_file', '0460_Aspirin_sf2_file', '0460_Chaos_sf2_file', '0460_FluidR3_GM_sf2_file', '0460_GeneralUserGS_sf2_file', '0460_JCLive_sf2_file', '0460_SBLive_sf2', '0460_SoundBlasterOld_sf2', '0461_FluidR3_GM_sf2_file', '0470_Aspirin_sf2_file', '0470_Chaos_sf2_file', '0470_FluidR3_GM_sf2_file', '0470_GeneralUserGS_sf2_file', '0470_JCLive_sf2_file', '0470_SBLive_sf2', '0470_SoundBlasterOld_sf2', '0471_FluidR3_GM_sf2_file', '0471_GeneralUserGS_sf2_file', '0480_Aspirin_sf2_file', '0480_Chaos_sf2_file', '0480_FluidR3_GM_sf2_file', '0480_GeneralUserGS_sf2_file', '0480_JCLive_sf2_file', '0480_SBLive_sf2', '0480_SoundBlasterOld_sf2', '04810_GeneralUserGS_sf2_file', '04811_GeneralUserGS_sf2_file', '04812_GeneralUserGS_sf2_file', '04813_GeneralUserGS_sf2_file', '04814_GeneralUserGS_sf2_file', '04815_GeneralUserGS_sf2_file', '04816_GeneralUserGS_sf2_file', '04817_GeneralUserGS_sf2_file', '0481_Aspirin_sf2_file', '0481_FluidR3_GM_sf2_file', '0481_GeneralUserGS_sf2_file', '0482_Aspirin_sf2_file', '0482_GeneralUserGS_sf2_file', '0483_GeneralUserGS_sf2_file', '0484_GeneralUserGS_sf2_file', '0485_GeneralUserGS_sf2_file', '0486_GeneralUserGS_sf2_file', '0487_GeneralUserGS_sf2_file', '0488_GeneralUserGS_sf2_file', '0489_GeneralUserGS_sf2_file', '0490_Aspirin_sf2_file', '0490_Chaos_sf2_file', '0490_FluidR3_GM_sf2_file', '0490_GeneralUserGS_sf2_file', '0490_JCLive_sf2_file', '0490_SBLive_sf2', '0490_SoundBlasterOld_sf2', '0491_GeneralUserGS_sf2_file', '0492_GeneralUserGS_sf2_file', '0500_Aspirin_sf2_file', '0500_Chaos_sf2_file', '0500_FluidR3_GM_sf2_file', '0500_GeneralUserGS_sf2_file', '0500_JCLive_sf2_file', '0500_SBLive_sf2', '0500_SoundBlasterOld_sf2', '0501_FluidR3_GM_sf2_file', '0501_GeneralUserGS_sf2_file', '0502_FluidR3_GM_sf2_file', '0502_GeneralUserGS_sf2_file', '0503_FluidR3_GM_sf2_file', '0504_FluidR3_GM_sf2_file', '0505_FluidR3_GM_sf2_file', '0510_Aspirin_sf2_file', '0510_Chaos_sf2_file', '0510_FluidR3_GM_sf2_file', '0510_GeneralUserGS_sf2_file', '0510_JCLive_sf2_file', '0510_SBLive_sf2', '0510_SoundBlasterOld_sf2', '0511_GeneralUserGS_sf2_file', '0511_SoundBlasterOld_sf2', '0520_Aspirin_sf2_file', '0520_Chaos_sf2_file', '0520_FluidR3_GM_sf2_file', '0520_GeneralUserGS_sf2_file', '0520_JCLive_sf2_file', '0520_SBLive_sf2', '0520_Soul_Ahhs_sf2_file', '0520_SoundBlasterOld_sf2', '0521_FluidR3_GM_sf2_file', '0521_Soul_Ahhs_sf2_file', '0521_SoundBlasterOld_sf2', '0522_Soul_Ahhs_sf2_file', '0530_Aspirin_sf2_file', '0530_Chaos_sf2_file', '0530_FluidR3_GM_sf2_file', '0530_GeneralUserGS_sf2_file', '0530_JCLive_sf2_file', '0530_SBLive_sf2', '0530_Soul_Ahhs_sf2_file', '0530_SoundBlasterOld_sf2', '0531_FluidR3_GM_sf2_file', '0531_GeneralUserGS_sf2_file', '0531_JCLive_sf2_file', '0531_SoundBlasterOld_sf2', '0540_Aspirin_sf2_file', '0540_Chaos_sf2_file', '0540_FluidR3_GM_sf2_file', '0540_GeneralUserGS_sf2_file', '0540_JCLive_sf2_file', '0540_SBLive_sf2', '0540_SoundBlasterOld_sf2', '0541_FluidR3_GM_sf2_file', '0550_Aspirin_sf2_file', '0550_Chaos_sf2_file', '0550_FluidR3_GM_sf2_file', '0550_GeneralUserGS_sf2_file', '0550_JCLive_sf2_file', '0550_SBLive_sf2', '0550_SoundBlasterOld_sf2', '0551_Aspirin_sf2_file', '0551_FluidR3_GM_sf2_file', '0560_Aspirin_sf2_file', '0560_Chaos_sf2_file', '0560_FluidR3_GM_sf2_file', '0560_GeneralUserGS_sf2_file', '0560_JCLive_sf2_file', '0560_SBLive_sf2', '0560_SoundBlasterOld_sf2', '0570_Aspirin_sf2_file', '0570_Chaos_sf2_file', '0570_FluidR3_GM_sf2_file', '0570_GeneralUserGS_sf2_file', '0570_JCLive_sf2_file', '0570_SBLive_sf2', '0570_SoundBlasterOld_sf2', '0571_GeneralUserGS_sf2_file', '0580_Aspirin_sf2_file', '0580_Chaos_sf2_file', '0580_FluidR3_GM_sf2_file', '0580_GeneralUserGS_sf2_file', '0580_JCLive_sf2_file', '0580_SBLive_sf2', '0580_SoundBlasterOld_sf2', '0581_GeneralUserGS_sf2_file', '0590_Aspirin_sf2_file', '0590_Chaos_sf2_file', '0590_FluidR3_GM_sf2_file', '0590_GeneralUserGS_sf2_file', '0590_JCLive_sf2_file', '0590_SBLive_sf2', '0590_SoundBlasterOld_sf2', '0591_GeneralUserGS_sf2_file', '0600_Aspirin_sf2_file', '0600_Chaos_sf2_file', '0600_FluidR3_GM_sf2_file', '0600_GeneralUserGS_sf2_file', '0600_JCLive_sf2_file', '0600_SBLive_sf2', '0600_SoundBlasterOld_sf2', '0601_FluidR3_GM_sf2_file', '0601_GeneralUserGS_sf2_file', '0602_GeneralUserGS_sf2_file', '0603_GeneralUserGS_sf2_file', '0610_Aspirin_sf2_file', '0610_Chaos_sf2_file', '0610_FluidR3_GM_sf2_file', '0610_GeneralUserGS_sf2_file', '0610_JCLive_sf2_file', '0610_SBLive_sf2', '0610_SoundBlasterOld_sf2', '0611_GeneralUserGS_sf2_file', '0612_GeneralUserGS_sf2_file', '0613_GeneralUserGS_sf2_file', '0614_GeneralUserGS_sf2_file', '0615_GeneralUserGS_sf2_file', '0620_Aspirin_sf2_file', '0620_Chaos_sf2_file', '0620_FluidR3_GM_sf2_file', '0620_GeneralUserGS_sf2_file', '0620_JCLive_sf2_file', '0620_SBLive_sf2', '0620_SoundBlasterOld_sf2', '0621_Aspirin_sf2_file', '0621_FluidR3_GM_sf2_file', '0621_GeneralUserGS_sf2_file', '0622_FluidR3_GM_sf2_file', '0622_GeneralUserGS_sf2_file', '0630_Aspirin_sf2_file', '0630_Chaos_sf2_file', '0630_FluidR3_GM_sf2_file', '0630_GeneralUserGS_sf2_file', '0630_JCLive_sf2_file', '0630_SBLive_sf2', '0630_SoundBlasterOld_sf2', '0631_Aspirin_sf2_file', '0631_FluidR3_GM_sf2_file', '0631_GeneralUserGS_sf2_file', '0632_FluidR3_GM_sf2_file', '0633_FluidR3_GM_sf2_file', '0640_Aspirin_sf2_file', '0640_Chaos_sf2_file', '0640_FluidR3_GM_sf2_file', '0640_GeneralUserGS_sf2_file', '0640_JCLive_sf2_file', '0640_SBLive_sf2', '0640_SoundBlasterOld_sf2', '0641_FluidR3_GM_sf2_file', '0650_Aspirin_sf2_file', '0650_Chaos_sf2_file', '0650_FluidR3_GM_sf2_file', '0650_GeneralUserGS_sf2_file', '0650_JCLive_sf2_file', '0650_SBLive_sf2', '0650_SoundBlasterOld_sf2', '0651_Aspirin_sf2_file', '0651_FluidR3_GM_sf2_file', '0660_Aspirin_sf2_file', '0660_Chaos_sf2_file', '0660_FluidR3_GM_sf2_file', '0660_GeneralUserGS_sf2_file', '0660_JCLive_sf2_file', '0660_SBLive_sf2', '0660_SoundBlasterOld_sf2', '0661_FluidR3_GM_sf2_file', '0661_GeneralUserGS_sf2_file', '0670_Aspirin_sf2_file', '0670_Chaos_sf2_file', '0670_FluidR3_GM_sf2_file', '0670_GeneralUserGS_sf2_file', '0670_JCLive_sf2_file', '0670_SBLive_sf2', '0670_SoundBlasterOld_sf2', '0671_FluidR3_GM_sf2_file', '0680_Aspirin_sf2_file', '0680_Chaos_sf2_file', '0680_FluidR3_GM_sf2_file', '0680_GeneralUserGS_sf2_file', '0680_JCLive_sf2_file', '0680_SBLive_sf2', '0680_SoundBlasterOld_sf2', '0681_FluidR3_GM_sf2_file', '0690_Aspirin_sf2_file', '0690_Chaos_sf2_file', '0690_FluidR3_GM_sf2_file', '0690_GeneralUserGS_sf2_file', '0690_JCLive_sf2_file', '0690_SBLive_sf2', '0690_SoundBlasterOld_sf2', '0691_FluidR3_GM_sf2_file', '0700_Aspirin_sf2_file', '0700_Chaos_sf2_file', '0700_FluidR3_GM_sf2_file', '0700_GeneralUserGS_sf2_file', '0700_JCLive_sf2_file', '0700_SBLive_sf2', '0700_SoundBlasterOld_sf2', '0701_FluidR3_GM_sf2_file', '0701_GeneralUserGS_sf2_file', '0710_Aspirin_sf2_file', '0710_Chaos_sf2_file', '0710_FluidR3_GM_sf2_file', '0710_GeneralUserGS_sf2_file', '0710_JCLive_sf2_file', '0710_SBLive_sf2', '0710_SoundBlasterOld_sf2', '0711_FluidR3_GM_sf2_file', '0720_Aspirin_sf2_file', '0720_Chaos_sf2_file', '0720_FluidR3_GM_sf2_file', '0720_GeneralUserGS_sf2_file', '0720_JCLive_sf2_file', '0720_SBLive_sf2', '0720_SoundBlasterOld_sf2', '0721_FluidR3_GM_sf2_file', '0721_SoundBlasterOld_sf2', '0730_Aspirin_sf2_file', '0730_Chaos_sf2_file', '0730_FluidR3_GM_sf2_file', '0730_GeneralUserGS_sf2_file', '0730_JCLive_sf2_file', '0730_SBLive_sf2', '0730_SoundBlasterOld_sf2', '0731_Aspirin_sf2_file', '0731_FluidR3_GM_sf2_file', '0731_SoundBlasterOld_sf2', '0740_Aspirin_sf2_file', '0740_Chaos_sf2_file', '0740_FluidR3_GM_sf2_file', '0740_GeneralUserGS_sf2_file', '0740_JCLive_sf2_file', '0740_SBLive_sf2', '0740_SoundBlasterOld_sf2', '0741_GeneralUserGS_sf2_file', '0750_Aspirin_sf2_file', '0750_Chaos_sf2_file', '0750_FluidR3_GM_sf2_file', '0750_GeneralUserGS_sf2_file', '0750_JCLive_sf2_file', '0750_SBLive_sf2', '0750_SoundBlasterOld_sf2', '0751_Aspirin_sf2_file', '0751_FluidR3_GM_sf2_file', '0751_GeneralUserGS_sf2_file', '0751_SoundBlasterOld_sf2', '0760_Aspirin_sf2_file', '0760_Chaos_sf2_file', '0760_FluidR3_GM_sf2_file', '0760_GeneralUserGS_sf2_file', '0760_JCLive_sf2_file', '0760_SBLive_sf2', '0760_SoundBlasterOld_sf2', '0761_FluidR3_GM_sf2_file', '0761_GeneralUserGS_sf2_file', '0761_SoundBlasterOld_sf2', '0762_GeneralUserGS_sf2_file', '0770_Aspirin_sf2_file', '0770_Chaos_sf2_file', '0770_FluidR3_GM_sf2_file', '0770_GeneralUserGS_sf2_file', '0770_JCLive_sf2_file', '0770_SBLive_sf2', '0770_SoundBlasterOld_sf2', '0771_FluidR3_GM_sf2_file', '0771_GeneralUserGS_sf2_file', '0772_GeneralUserGS_sf2_file', '0780_Aspirin_sf2_file', '0780_Chaos_sf2_file', '0780_FluidR3_GM_sf2_file', '0780_GeneralUserGS_sf2_file', '0780_JCLive_sf2_file', '0780_SBLive_sf2', '0780_SoundBlasterOld_sf2', '0781_GeneralUserGS_sf2_file', '0790_Aspirin_sf2_file', '0790_Chaos_sf2_file', '0790_FluidR3_GM_sf2_file', '0790_GeneralUserGS_sf2_file', '0790_JCLive_sf2_file', '0790_SBLive_sf2', '0790_SoundBlasterOld_sf2', '0791_GeneralUserGS_sf2_file', '0800_Aspirin_sf2_file', '0800_Chaos_sf2_file', '0800_FluidR3_GM_sf2_file', '0800_GeneralUserGS_sf2_file', '0800_JCLive_sf2_file', '0800_SBLive_sf2', '0800_SoundBlasterOld_sf2', '0801_FluidR3_GM_sf2_file', '0801_GeneralUserGS_sf2_file', '0810_Aspirin_sf2_file', '0810_Chaos_sf2_file', '0810_FluidR3_GM_sf2_file', '0810_GeneralUserGS_sf2_file', '0810_JCLive_sf2_file', '0810_SBLive_sf2', '0810_SoundBlasterOld_sf2', '0811_Aspirin_sf2_file', '0811_GeneralUserGS_sf2_file', '0811_SoundBlasterOld_sf2', '0820_Aspirin_sf2_file', '0820_Chaos_sf2_file', '0820_FluidR3_GM_sf2_file', '0820_GeneralUserGS_sf2_file', '0820_JCLive_sf2_file', '0820_SBLive_sf2', '0820_SoundBlasterOld_sf2', '0821_FluidR3_GM_sf2_file', '0821_GeneralUserGS_sf2_file', '0821_SoundBlasterOld_sf2', '0822_GeneralUserGS_sf2_file', '0823_GeneralUserGS_sf2_file', '0830_Aspirin_sf2_file', '0830_Chaos_sf2_file', '0830_FluidR3_GM_sf2_file', '0830_GeneralUserGS_sf2_file', '0830_JCLive_sf2_file', '0830_SBLive_sf2', '0830_SoundBlasterOld_sf2', '0831_FluidR3_GM_sf2_file', '0831_GeneralUserGS_sf2_file', '0831_SoundBlasterOld_sf2', '0840_Aspirin_sf2_file', '0840_Chaos_sf2_file', '0840_FluidR3_GM_sf2_file', '0840_GeneralUserGS_sf2_file', '0840_JCLive_sf2_file', '0840_SBLive_sf2', '0840_SoundBlasterOld_sf2', '0841_Aspirin_sf2_file', '0841_Chaos_sf2_file', '0841_FluidR3_GM_sf2_file', '0841_GeneralUserGS_sf2_file', '0841_JCLive_sf2_file', '0841_SoundBlasterOld_sf2', '0842_FluidR3_GM_sf2_file', '0850_Aspirin_sf2_file', '0850_Chaos_sf2_file', '0850_FluidR3_GM_sf2_file', '0850_GeneralUserGS_sf2_file', '0850_JCLive_sf2_file', '0850_SBLive_sf2', '0850_SoundBlasterOld_sf2', '0851_FluidR3_GM_sf2_file', '0851_GeneralUserGS_sf2_file', '0851_JCLive_sf2_file', '0851_SoundBlasterOld_sf2', '0860_Aspirin_sf2_file', '0860_Chaos_sf2_file', '0860_FluidR3_GM_sf2_file', '0860_GeneralUserGS_sf2_file', '0860_JCLive_sf2_file', '0860_SBLive_sf2', '0860_SoundBlasterOld_sf2', '0861_Aspirin_sf2_file', '0861_FluidR3_GM_sf2_file', '0861_SoundBlasterOld_sf2', '0870_Aspirin_sf2_file', '0870_Chaos_sf2_file', '0870_FluidR3_GM_sf2_file', '0870_GeneralUserGS_sf2_file', '0870_JCLive_sf2_file', '0870_SBLive_sf2', '0870_SoundBlasterOld_sf2', '0871_GeneralUserGS_sf2_file', '0872_GeneralUserGS_sf2_file', '0873_GeneralUserGS_sf2_file', '0880_Aspirin_sf2_file', '0880_Chaos_sf2_file', '0880_FluidR3_GM_sf2_file', '0880_GeneralUserGS_sf2_file', '0880_JCLive_sf2_file', '0880_SBLive_sf2', '0880_SoundBlasterOld_sf2', '0881_Aspirin_sf2_file', '0881_FluidR3_GM_sf2_file', '0881_GeneralUserGS_sf2_file', '0881_SoundBlasterOld_sf2', '0882_Aspirin_sf2_file', '0882_FluidR3_GM_sf2_file', '0882_GeneralUserGS_sf2_file', '0883_GeneralUserGS_sf2_file', '0884_GeneralUserGS_sf2_file', '0885_GeneralUserGS_sf2_file', '0886_GeneralUserGS_sf2_file', '0887_GeneralUserGS_sf2_file', '0888_GeneralUserGS_sf2_file', '0889_GeneralUserGS_sf2_file', '0890_Aspirin_sf2_file', '0890_Chaos_sf2_file', '0890_FluidR3_GM_sf2_file', '0890_GeneralUserGS_sf2_file', '0890_JCLive_sf2_file', '0890_SBLive_sf2', '0890_SoundBlasterOld_sf2', '0891_Aspirin_sf2_file', '0891_FluidR3_GM_sf2_file', '0891_GeneralUserGS_sf2_file', '0900_Aspirin_sf2_file', '0900_Chaos_sf2_file', '0900_FluidR3_GM_sf2_file', '0900_GeneralUserGS_sf2_file', '0900_JCLive_sf2_file', '0900_SBLive_sf2', '0900_SoundBlasterOld_sf2', '0901_Aspirin_sf2_file', '0901_FluidR3_GM_sf2_file', '0901_GeneralUserGS_sf2_file', '0901_SoundBlasterOld_sf2', '0910_Aspirin_sf2_file', '0910_Chaos_sf2_file', '0910_FluidR3_GM_sf2_file', '0910_GeneralUserGS_sf2_file', '0910_JCLive_sf2_file', '0910_SBLive_sf2', '0910_SoundBlasterOld_sf2', '0911_Aspirin_sf2_file', '0911_GeneralUserGS_sf2_file', '0911_JCLive_sf2_file', '0911_SoundBlasterOld_sf2', '0920_Aspirin_sf2_file', '0920_Chaos_sf2_file', '0920_FluidR3_GM_sf2_file', '0920_GeneralUserGS_sf2_file', '0920_JCLive_sf2_file', '0920_SBLive_sf2', '0920_SoundBlasterOld_sf2', '0921_Aspirin_sf2_file', '0921_GeneralUserGS_sf2_file', '0921_SoundBlasterOld_sf2', '0930_Aspirin_sf2_file', '0930_Chaos_sf2_file', '0930_FluidR3_GM_sf2_file', '0930_GeneralUserGS_sf2_file', '0930_JCLive_sf2_file', '0930_SBLive_sf2', '0930_SoundBlasterOld_sf2', '0931_Aspirin_sf2_file', '0931_FluidR3_GM_sf2_file', '0931_GeneralUserGS_sf2_file', '0931_SoundBlasterOld_sf2', '0940_Aspirin_sf2_file', '0940_Chaos_sf2_file', '0940_FluidR3_GM_sf2_file', '0940_GeneralUserGS_sf2_file', '0940_JCLive_sf2_file', '0940_SBLive_sf2', '0940_SoundBlasterOld_sf2', '0941_Aspirin_sf2_file', '0941_FluidR3_GM_sf2_file', '0941_GeneralUserGS_sf2_file', '0941_JCLive_sf2_file', '0950_Aspirin_sf2_file', '0950_Chaos_sf2_file', '0950_FluidR3_GM_sf2_file', '0950_GeneralUserGS_sf2_file', '0950_JCLive_sf2_file', '0950_SBLive_sf2', '0950_SoundBlasterOld_sf2', '0951_FluidR3_GM_sf2_file', '0951_GeneralUserGS_sf2_file', '0960_Aspirin_sf2_file', '0960_Chaos_sf2_file', '0960_FluidR3_GM_sf2_file', '0960_GeneralUserGS_sf2_file', '0960_JCLive_sf2_file', '0960_SBLive_sf2', '0960_SoundBlasterOld_sf2', '0961_Aspirin_sf2_file', '0961_FluidR3_GM_sf2_file', '0961_GeneralUserGS_sf2_file', '0961_SoundBlasterOld_sf2', '0962_GeneralUserGS_sf2_file', '0970_Aspirin_sf2_file', '0970_Chaos_sf2_file', '0970_FluidR3_GM_sf2_file', '0970_GeneralUserGS_sf2_file', '0970_JCLive_sf2_file', '0970_SBLive_sf2', '0970_SoundBlasterOld_sf2', '0971_FluidR3_GM_sf2_file', '0971_GeneralUserGS_sf2_file', '0971_SoundBlasterOld_sf2', '0980_Aspirin_sf2_file', '0980_Chaos_sf2_file', '0980_FluidR3_GM_sf2_file', '0980_GeneralUserGS_sf2_file', '0980_JCLive_sf2_file', '0980_SBLive_sf2', '0980_SoundBlasterOld_sf2', '0981_Aspirin_sf2_file', '0981_FluidR3_GM_sf2_file', '0981_GeneralUserGS_sf2_file', '0981_SoundBlasterOld_sf2', '0982_GeneralUserGS_sf2_file', '0983_GeneralUserGS_sf2_file', '0984_GeneralUserGS_sf2_file', '0990_Aspirin_sf2_file', '0990_Chaos_sf2_file', '0990_FluidR3_GM_sf2_file', '0990_GeneralUserGS_sf2_file', '0990_JCLive_sf2_file', '0990_SBLive_sf2', '0990_SoundBlasterOld_sf2', '0991_Aspirin_sf2_file', '0991_FluidR3_GM_sf2_file', '0991_GeneralUserGS_sf2_file', '0991_JCLive_sf2_file', '0991_SoundBlasterOld_sf2', '0992_FluidR3_GM_sf2_file', '0992_JCLive_sf2_file', '0993_JCLive_sf2_file', '0994_JCLive_sf2_file', '1000_Aspirin_sf2_file', '1000_Chaos_sf2_file', '1000_FluidR3_GM_sf2_file', '1000_GeneralUserGS_sf2_file', '1000_JCLive_sf2_file', '1000_SBLive_sf2', '1000_SoundBlasterOld_sf2', '1001_Aspirin_sf2_file', '1001_FluidR3_GM_sf2_file', '1001_GeneralUserGS_sf2_file', '1001_JCLive_sf2_file', '1001_SoundBlasterOld_sf2', '1002_Aspirin_sf2_file', '1002_FluidR3_GM_sf2_file', '1002_GeneralUserGS_sf2_file', '1010_Aspirin_sf2_file', '1010_Chaos_sf2_file', '1010_FluidR3_GM_sf2_file', '1010_GeneralUserGS_sf2_file', '1010_JCLive_sf2_file', '1010_SBLive_sf2', '1010_SoundBlasterOld_sf2', '1011_Aspirin_sf2_file', '1011_FluidR3_GM_sf2_file', '1011_JCLive_sf2_file', '1012_Aspirin_sf2_file', '1020_Aspirin_sf2_file', '1020_Chaos_sf2_file', '1020_FluidR3_GM_sf2_file', '1020_GeneralUserGS_sf2_file', '1020_JCLive_sf2_file', '1020_SBLive_sf2', '1020_SoundBlasterOld_sf2', '1021_Aspirin_sf2_file', '1021_FluidR3_GM_sf2_file', '1021_GeneralUserGS_sf2_file', '1021_JCLive_sf2_file', '1021_SoundBlasterOld_sf2', '1022_GeneralUserGS_sf2_file', '1030_Aspirin_sf2_file', '1030_Chaos_sf2_file', '1030_FluidR3_GM_sf2_file', '1030_GeneralUserGS_sf2_file', '1030_JCLive_sf2_file', '1030_SBLive_sf2', '1030_SoundBlasterOld_sf2', '1031_Aspirin_sf2_file', '1031_FluidR3_GM_sf2_file', '1031_GeneralUserGS_sf2_file', '1031_SoundBlasterOld_sf2', '1032_FluidR3_GM_sf2_file', '1040_Aspirin_sf2_file', '1040_Chaos_sf2_file', '1040_FluidR3_GM_sf2_file', '1040_GeneralUserGS_sf2_file', '1040_JCLive_sf2_file', '1040_SBLive_sf2', '1040_SoundBlasterOld_sf2', '1041_FluidR3_GM_sf2_file', '1041_GeneralUserGS_sf2_file', '1050_Aspirin_sf2_file', '1050_Chaos_sf2_file', '1050_FluidR3_GM_sf2_file', '1050_GeneralUserGS_sf2_file', '1050_JCLive_sf2_file', '1050_SBLive_sf2', '1050_SoundBlasterOld_sf2', '1051_GeneralUserGS_sf2_file', '1060_Aspirin_sf2_file', '1060_Chaos_sf2_file', '1060_FluidR3_GM_sf2_file', '1060_GeneralUserGS_sf2_file', '1060_JCLive_sf2_file', '1060_SBLive_sf2', '1060_SoundBlasterOld_sf2', '1061_FluidR3_GM_sf2_file', '1061_GeneralUserGS_sf2_file', '1061_SoundBlasterOld_sf2', '1070_Aspirin_sf2_file', '1070_Chaos_sf2_file', '1070_FluidR3_GM_sf2_file', '1070_GeneralUserGS_sf2_file', '1070_JCLive_sf2_file', '1070_SBLive_sf2', '1070_SoundBlasterOld_sf2', '1071_FluidR3_GM_sf2_file', '1071_GeneralUserGS_sf2_file', '1072_GeneralUserGS_sf2_file', '1073_GeneralUserGS_sf2_file', '1080_Aspirin_sf2_file', '1080_Chaos_sf2_file', '1080_FluidR3_GM_sf2_file', '1080_GeneralUserGS_sf2_file', '1080_JCLive_sf2_file', '1080_SBLive_sf2', '1080_SoundBlasterOld_sf2', '1081_SoundBlasterOld_sf2', '1090_Aspirin_sf2_file', '1090_Chaos_sf2_file', '1090_FluidR3_GM_sf2_file', '1090_GeneralUserGS_sf2_file', '1090_JCLive_sf2_file', '1090_SBLive_sf2', '1090_SoundBlasterOld_sf2', '1091_SoundBlasterOld_sf2', '1100_Aspirin_sf2_file', '1100_Chaos_sf2_file', '1100_FluidR3_GM_sf2_file', '1100_GeneralUserGS_sf2_file', '1100_JCLive_sf2_file', '1100_SBLive_sf2', '1100_SoundBlasterOld_sf2', '1101_Aspirin_sf2_file', '1101_FluidR3_GM_sf2_file', '1101_GeneralUserGS_sf2_file', '1102_GeneralUserGS_sf2_file', '1110_Aspirin_sf2_file', '1110_Chaos_sf2_file', '1110_FluidR3_GM_sf2_file', '1110_GeneralUserGS_sf2_file', '1110_JCLive_sf2_file', '1110_SBLive_sf2', '1110_SoundBlasterOld_sf2', '1120_Aspirin_sf2_file', '1120_Chaos_sf2_file', '1120_FluidR3_GM_sf2_file', '1120_GeneralUserGS_sf2_file', '1120_JCLive_sf2_file', '1120_SBLive_sf2', '1120_SoundBlasterOld_sf2', '1121_SoundBlasterOld_sf2', '1130_Aspirin_sf2_file', '1130_Chaos_sf2_file', '1130_FluidR3_GM_sf2_file', '1130_GeneralUserGS_sf2_file', '1130_JCLive_sf2_file', '1130_SBLive_sf2', '1130_SoundBlasterOld_sf2', '1131_FluidR3_GM_sf2_file', '1131_SoundBlasterOld_sf2', '1140_Aspirin_sf2_file', '1140_Chaos_sf2_file', '1140_FluidR3_GM_sf2_file', '1140_GeneralUserGS_sf2_file', '1140_JCLive_sf2_file', '1140_SBLive_sf2', '1140_SoundBlasterOld_sf2', '1141_FluidR3_GM_sf2_file', '1150_Aspirin_sf2_file', '1150_Chaos_sf2_file', '1150_FluidR3_GM_sf2_file', '1150_GeneralUserGS_sf2_file', '1150_JCLive_sf2_file', '1150_SBLive_sf2', '1150_SoundBlasterOld_sf2', '1151_FluidR3_GM_sf2_file', '1151_GeneralUserGS_sf2_file', '1152_FluidR3_GM_sf2_file', '1152_GeneralUserGS_sf2_file', '1160_Aspirin_sf2_file', '1160_Chaos_sf2_file', '1160_FluidR3_GM_sf2_file', '1160_GeneralUserGS_sf2_file', '1160_JCLive_sf2_file', '1160_SBLive_sf2', '1160_SoundBlasterOld_sf2', '1161_FluidR3_GM_sf2_file', '1161_GeneralUserGS_sf2_file', '1161_SoundBlasterOld_sf2', '1162_FluidR3_GM_sf2_file', '1162_GeneralUserGS_sf2_file', '1163_FluidR3_GM_sf2_file', '1170_Aspirin_sf2_file', '1170_Chaos_sf2_file', '1170_FluidR3_GM_sf2_file', '1170_GeneralUserGS_sf2_file', '1170_JCLive_sf2_file', '1170_SBLive_sf2', '1170_SoundBlasterOld_sf2', '1171_FluidR3_GM_sf2_file', '1171_GeneralUserGS_sf2_file', '1172_FluidR3_GM_sf2_file', '1173_FluidR3_GM_sf2_file', '1180_Aspirin_sf2_file', '1180_Chaos_sf2_file', '1180_FluidR3_GM_sf2_file', '1180_GeneralUserGS_sf2_file', '1180_JCLive_sf2_file', '1180_SBLive_sf2', '1180_SoundBlasterOld_sf2', '1181_FluidR3_GM_sf2_file', '1181_GeneralUserGS_sf2_file', '1181_SoundBlasterOld_sf2', '1190_Aspirin_sf2_file', '1190_Chaos_sf2_file', '1190_FluidR3_GM_sf2_file', '1190_GeneralUserGS_sf2_file', '1190_JCLive_sf2_file', '1190_SBLive_sf2', '1190_SoundBlasterOld_sf2', '1191_GeneralUserGS_sf2_file', '1192_GeneralUserGS_sf2_file', '1193_GeneralUserGS_sf2_file', '1194_GeneralUserGS_sf2_file', '1200_Aspirin_sf2_file', '1200_Chaos_sf2_file', '1200_FluidR3_GM_sf2_file', '1200_GeneralUserGS_sf2_file', '1200_JCLive_sf2_file', '1200_SBLive_sf2', '1200_SoundBlasterOld_sf2', '1201_Aspirin_sf2_file', '1201_GeneralUserGS_sf2_file', '1202_GeneralUserGS_sf2_file', '1210_Aspirin_sf2_file', '1210_Chaos_sf2_file', '1210_FluidR3_GM_sf2_file', '1210_GeneralUserGS_sf2_file', '1210_JCLive_sf2_file', '1210_SBLive_sf2', '1210_SoundBlasterOld_sf2', '1211_Aspirin_sf2_file', '1211_GeneralUserGS_sf2_file', '1212_GeneralUserGS_sf2_file', '1220_Aspirin_sf2_file', '1220_Chaos_sf2_file', '1220_FluidR3_GM_sf2_file', '1220_GeneralUserGS_sf2_file', '1220_JCLive_sf2_file', '1220_SBLive_sf2', '1220_SoundBlasterOld_sf2', '1221_Aspirin_sf2_file', '1221_GeneralUserGS_sf2_file', '1221_JCLive_sf2_file', '1222_Aspirin_sf2_file', '1222_GeneralUserGS_sf2_file', '1223_Aspirin_sf2_file', '1223_GeneralUserGS_sf2_file', '1224_Aspirin_sf2_file', '1224_GeneralUserGS_sf2_file', '1225_GeneralUserGS_sf2_file', '1226_GeneralUserGS_sf2_file', '1230_Aspirin_sf2_file', '1230_Chaos_sf2_file', '1230_FluidR3_GM_sf2_file', '1230_GeneralUserGS_sf2_file', '1230_JCLive_sf2_file', '1230_SBLive_sf2', '1230_SoundBlasterOld_sf2', '1231_Aspirin_sf2_file', '1231_GeneralUserGS_sf2_file', '1232_Aspirin_sf2_file', '1232_GeneralUserGS_sf2_file', '1233_GeneralUserGS_sf2_file', '1234_GeneralUserGS_sf2_file', '1240_Aspirin_sf2_file', '1240_Chaos_sf2_file', '1240_FluidR3_GM_sf2_file', '1240_GeneralUserGS_sf2_file', '1240_JCLive_sf2_file', '1240_SBLive_sf2', '1240_SoundBlasterOld_sf2', '1241_Aspirin_sf2_file', '1241_GeneralUserGS_sf2_file', '1242_Aspirin_sf2_file', '1242_GeneralUserGS_sf2_file', '1243_Aspirin_sf2_file', '1243_GeneralUserGS_sf2_file', '1244_Aspirin_sf2_file', '1244_GeneralUserGS_sf2_file', '1250_Aspirin_sf2_file', '1250_Chaos_sf2_file', '1250_FluidR3_GM_sf2_file', '1250_GeneralUserGS_sf2_file', '1250_JCLive_sf2_file', '1250_SBLive_sf2', '1250_SoundBlasterOld_sf2', '1251_Aspirin_sf2_file', '1251_FluidR3_GM_sf2_file', '1251_GeneralUserGS_sf2_file', '1252_Aspirin_sf2_file', '1252_FluidR3_GM_sf2_file', '1252_GeneralUserGS_sf2_file', '1253_Aspirin_sf2_file', '1253_GeneralUserGS_sf2_file', '1254_Aspirin_sf2_file', '1254_GeneralUserGS_sf2_file', '1255_Aspirin_sf2_file', '1255_GeneralUserGS_sf2_file', '1256_Aspirin_sf2_file', '1256_GeneralUserGS_sf2_file', '1257_Aspirin_sf2_file', '1257_GeneralUserGS_sf2_file', '1258_Aspirin_sf2_file', '1258_GeneralUserGS_sf2_file', '1259_GeneralUserGS_sf2_file', '1260_Aspirin_sf2_file', '1260_Chaos_sf2_file', '1260_FluidR3_GM_sf2_file', '1260_GeneralUserGS_sf2_file', '1260_JCLive_sf2_file', '1260_SBLive_sf2', '1260_SoundBlasterOld_sf2', '1261_Aspirin_sf2_file', '1261_GeneralUserGS_sf2_file', '1262_Aspirin_sf2_file', '1262_GeneralUserGS_sf2_file', '1263_Aspirin_sf2_file', '1263_GeneralUserGS_sf2_file', '1264_Aspirin_sf2_file', '1264_GeneralUserGS_sf2_file', '1265_Aspirin_sf2_file', '1265_GeneralUserGS_sf2_file', '1270_Aspirin_sf2_file', '1270_Chaos_sf2_file', '1270_FluidR3_GM_sf2_file', '1270_GeneralUserGS_sf2_file', '1270_JCLive_sf2_file', '1270_SBLive_sf2', '1270_SoundBlasterOld_sf2', '1271_Aspirin_sf2_file', '1271_GeneralUserGS_sf2_file', '1272_Aspirin_sf2_file', '1272_GeneralUserGS_sf2_file', '1273_GeneralUserGS_sf2_file', '1274_GeneralUserGS_sf2_file'
            ];
        }
        return this.instrumentKeyArray;
    };
    ;
    ZvoogPlayer.prototype.instrumentTitles = function () {
        if (this.instrumentNamesArray.length > 0) {
            //
        }
        else {
            var insNames = [];
            insNames[0] = "Acoustic Grand Piano: Piano";
            insNames[1] = "Bright Acoustic Piano: Piano";
            insNames[2] = "Electric Grand Piano: Piano";
            insNames[3] = "Honky-tonk Piano: Piano";
            insNames[4] = "Electric Piano 1: Piano";
            insNames[5] = "Electric Piano 2: Piano";
            insNames[6] = "Harpsichord: Piano";
            insNames[7] = "Clavinet: Piano";
            insNames[8] = "Celesta: Chromatic Percussion";
            insNames[9] = "Glockenspiel: Chromatic Percussion";
            insNames[10] = "Music Box: Chromatic Percussion";
            insNames[11] = "Vibraphone: Chromatic Percussion";
            insNames[12] = "Marimba: Chromatic Percussion";
            insNames[13] = "Xylophone: Chromatic Percussion";
            insNames[14] = "Tubular Bells: Chromatic Percussion";
            insNames[15] = "Dulcimer: Chromatic Percussion";
            insNames[16] = "Drawbar Organ: Organ";
            insNames[17] = "Percussive Organ: Organ";
            insNames[18] = "Rock Organ: Organ";
            insNames[19] = "Church Organ: Organ";
            insNames[20] = "Reed Organ: Organ";
            insNames[21] = "Accordion: Organ";
            insNames[22] = "Harmonica: Organ";
            insNames[23] = "Tango Accordion: Organ";
            insNames[24] = "Acoustic Guitar (nylon): Guitar";
            insNames[25] = "Acoustic Guitar (steel): Guitar";
            insNames[26] = "Electric Guitar (jazz): Guitar";
            insNames[27] = "Electric Guitar (clean): Guitar";
            insNames[28] = "Electric Guitar (muted): Guitar";
            insNames[29] = "Overdriven Guitar: Guitar";
            insNames[30] = "Distortion Guitar: Guitar";
            insNames[31] = "Guitar Harmonics: Guitar";
            insNames[32] = "Acoustic Bass: Bass";
            insNames[33] = "Electric Bass (finger): Bass";
            insNames[34] = "Electric Bass (pick): Bass";
            insNames[35] = "Fretless Bass: Bass";
            insNames[36] = "Slap Bass 1: Bass";
            insNames[37] = "Slap Bass 2: Bass";
            insNames[38] = "Synth Bass 1: Bass";
            insNames[39] = "Synth Bass 2: Bass";
            insNames[40] = "Violin: Strings";
            insNames[41] = "Viola: Strings";
            insNames[42] = "Cello: Strings";
            insNames[43] = "Contrabass: Strings";
            insNames[44] = "Tremolo Strings: Strings";
            insNames[45] = "Pizzicato Strings: Strings";
            insNames[46] = "Orchestral Harp: Strings";
            insNames[47] = "Timpani: Strings";
            insNames[48] = "String Ensemble 1: Ensemble";
            insNames[49] = "String Ensemble 2: Ensemble";
            insNames[50] = "Synth Strings 1: Ensemble";
            insNames[51] = "Synth Strings 2: Ensemble";
            insNames[52] = "Choir Aahs: Ensemble";
            insNames[53] = "Voice Oohs: Ensemble";
            insNames[54] = "Synth Choir: Ensemble";
            insNames[55] = "Orchestra Hit: Ensemble";
            insNames[56] = "Trumpet: Brass";
            insNames[57] = "Trombone: Brass";
            insNames[58] = "Tuba: Brass";
            insNames[59] = "Muted Trumpet: Brass";
            insNames[60] = "French Horn: Brass";
            insNames[61] = "Brass Section: Brass";
            insNames[62] = "Synth Brass 1: Brass";
            insNames[63] = "Synth Brass 2: Brass";
            insNames[64] = "Soprano Sax: Reed";
            insNames[65] = "Alto Sax: Reed";
            insNames[66] = "Tenor Sax: Reed";
            insNames[67] = "Baritone Sax: Reed";
            insNames[68] = "Oboe: Reed";
            insNames[69] = "English Horn: Reed";
            insNames[70] = "Bassoon: Reed";
            insNames[71] = "Clarinet: Reed";
            insNames[72] = "Piccolo: Pipe";
            insNames[73] = "Flute: Pipe";
            insNames[74] = "Recorder: Pipe";
            insNames[75] = "Pan Flute: Pipe";
            insNames[76] = "Blown bottle: Pipe";
            insNames[77] = "Shakuhachi: Pipe";
            insNames[78] = "Whistle: Pipe";
            insNames[79] = "Ocarina: Pipe";
            insNames[80] = "Lead 1 (square): Synth Lead";
            insNames[81] = "Lead 2 (sawtooth): Synth Lead";
            insNames[82] = "Lead 3 (calliope): Synth Lead";
            insNames[83] = "Lead 4 (chiff): Synth Lead";
            insNames[84] = "Lead 5 (charang): Synth Lead";
            insNames[85] = "Lead 6 (voice): Synth Lead";
            insNames[86] = "Lead 7 (fifths): Synth Lead";
            insNames[87] = "Lead 8 (bass + lead): Synth Lead";
            insNames[88] = "Pad 1 (new age): Synth Pad";
            insNames[89] = "Pad 2 (warm): Synth Pad";
            insNames[90] = "Pad 3 (polysynth): Synth Pad";
            insNames[91] = "Pad 4 (choir): Synth Pad";
            insNames[92] = "Pad 5 (bowed): Synth Pad";
            insNames[93] = "Pad 6 (metallic): Synth Pad";
            insNames[94] = "Pad 7 (halo): Synth Pad";
            insNames[95] = "Pad 8 (sweep): Synth Pad";
            insNames[96] = "FX 1 (rain): Synth Effects";
            insNames[97] = "FX 2 (soundtrack): Synth Effects";
            insNames[98] = "FX 3 (crystal): Synth Effects";
            insNames[99] = "FX 4 (atmosphere): Synth Effects";
            insNames[100] = "FX 5 (brightness): Synth Effects";
            insNames[101] = "FX 6 (goblins): Synth Effects";
            insNames[102] = "FX 7 (echoes): Synth Effects";
            insNames[103] = "FX 8 (sci-fi): Synth Effects";
            insNames[104] = "Sitar: Ethnic";
            insNames[105] = "Banjo: Ethnic";
            insNames[106] = "Shamisen: Ethnic";
            insNames[107] = "Koto: Ethnic";
            insNames[108] = "Kalimba: Ethnic";
            insNames[109] = "Bagpipe: Ethnic";
            insNames[110] = "Fiddle: Ethnic";
            insNames[111] = "Shanai: Ethnic";
            insNames[112] = "Tinkle Bell: Percussive";
            insNames[113] = "Agogo: Percussive";
            insNames[114] = "Steel Drums: Percussive";
            insNames[115] = "Woodblock: Percussive";
            insNames[116] = "Taiko Drum: Percussive";
            insNames[117] = "Melodic Tom: Percussive";
            insNames[118] = "Synth Drum: Percussive";
            insNames[119] = "Reverse Cymbal: Percussive";
            insNames[120] = "Guitar Fret Noise: Sound effects";
            insNames[121] = "Breath Noise: Sound effects";
            insNames[122] = "Seashore: Sound effects";
            insNames[123] = "Bird Tweet: Sound effects";
            insNames[124] = "Telephone Ring: Sound effects";
            insNames[125] = "Helicopter: Sound effects";
            insNames[126] = "Applause: Sound effects";
            insNames[127] = "Gunshot: Sound effects";
            this.instrumentNamesArray = insNames;
        }
        return this.instrumentNamesArray;
    };
    ;
    ZvoogPlayer.prototype.instrumentInfo = function (n) {
        var key = this.instrumentKeys()[n];
        var num = key.substring(0, 3);
        var p = parseInt(num);
        return {
            variable: '_tone_' + key,
            url: 'https://surikov.github.io/webaudiofontdata/sound/' + key + '.js',
            title: this.instrumentTitles()[p]
        };
    };
    ;
    ZvoogPlayer.prototype.drumTitles = function () {
        if (this.drumNamesArray.length < 1) {
            var drumNames = [];
            drumNames[35] = "Bass Drum 2";
            drumNames[36] = "Bass Drum 1";
            drumNames[37] = "Side Stick/Rimshot";
            drumNames[38] = "Snare Drum 1";
            drumNames[39] = "Hand Clap";
            drumNames[40] = "Snare Drum 2";
            drumNames[41] = "Low Tom 2";
            drumNames[42] = "Closed Hi-hat";
            drumNames[43] = "Low Tom 1";
            drumNames[44] = "Pedal Hi-hat";
            drumNames[45] = "Mid Tom 2";
            drumNames[46] = "Open Hi-hat";
            drumNames[47] = "Mid Tom 1";
            drumNames[48] = "High Tom 2";
            drumNames[49] = "Crash Cymbal 1";
            drumNames[50] = "High Tom 1";
            drumNames[51] = "Ride Cymbal 1";
            drumNames[52] = "Chinese Cymbal";
            drumNames[53] = "Ride Bell";
            drumNames[54] = "Tambourine";
            drumNames[55] = "Splash Cymbal";
            drumNames[56] = "Cowbell";
            drumNames[57] = "Crash Cymbal 2";
            drumNames[58] = "Vibra Slap";
            drumNames[59] = "Ride Cymbal 2";
            drumNames[60] = "High Bongo";
            drumNames[61] = "Low Bongo";
            drumNames[62] = "Mute High Conga";
            drumNames[63] = "Open High Conga";
            drumNames[64] = "Low Conga";
            drumNames[65] = "High Timbale";
            drumNames[66] = "Low Timbale";
            drumNames[67] = "High Agogo";
            drumNames[68] = "Low Agogo";
            drumNames[69] = "Cabasa";
            drumNames[70] = "Maracas";
            drumNames[71] = "Short Whistle";
            drumNames[72] = "Long Whistle";
            drumNames[73] = "Short Guiro";
            drumNames[74] = "Long Guiro";
            drumNames[75] = "Claves";
            drumNames[76] = "High Wood Block";
            drumNames[77] = "Low Wood Block";
            drumNames[78] = "Mute Cuica";
            drumNames[79] = "Open Cuica";
            drumNames[80] = "Mute Triangle";
            drumNames[81] = "Open Triangle";
            this.drumNamesArray = drumNames;
        }
        return this.drumNamesArray;
    };
    ;
    ZvoogPlayer.prototype.drumInfo = function (n) {
        var key = this.drumKeys()[n];
        var num = key.substring(0, 2);
        var p = parseInt(num);
        return {
            variable: '_drum_' + key,
            url: 'https://surikov.github.io/webaudiofontdata/sound/128' + key + '.js',
            pitch: p,
            title: this.drumTitles()[p]
        };
    };
    ;
    ZvoogPlayer.prototype.findInstrument = function (program) {
        for (var i = 0; i < this.instrumentKeys().length; i++) {
            var num = this.instrumentKeys()[i].substring(0, 3);
            if (program == parseInt(num) + 1) {
                return i;
            }
        }
        console.log('program', program, 'not found');
        return 0;
    };
    ;
    ZvoogPlayer.prototype.drumKeys = function () {
        if (this.drumKeyArray.length < 1) {
            this.drumKeyArray = [
                '35_0_SBLive_sf2', '35_12_JCLive_sf2_file', '35_16_JCLive_sf2_file', '35_18_JCLive_sf2_file', '35_4_Chaos_sf2_file', '36_0_SBLive_sf2', '36_12_JCLive_sf2_file', '36_16_JCLive_sf2_file', '36_18_JCLive_sf2_file', '36_4_Chaos_sf2_file', '37_0_SBLive_sf2', '37_12_JCLive_sf2_file', '37_16_JCLive_sf2_file', '37_18_JCLive_sf2_file', '37_4_Chaos_sf2_file', '38_0_SBLive_sf2', '38_12_JCLive_sf2_file', '38_16_JCLive_sf2_file', '38_18_JCLive_sf2_file', '38_4_Chaos_sf2_file', '39_0_SBLive_sf2', '39_12_JCLive_sf2_file', '39_16_JCLive_sf2_file', '39_18_JCLive_sf2_file', '39_4_Chaos_sf2_file', '40_0_SBLive_sf2', '40_12_JCLive_sf2_file', '40_16_JCLive_sf2_file', '40_18_JCLive_sf2_file', '40_4_Chaos_sf2_file', '41_0_SBLive_sf2', '41_12_JCLive_sf2_file', '41_16_JCLive_sf2_file', '41_18_JCLive_sf2_file', '41_4_Chaos_sf2_file', '42_0_SBLive_sf2', '42_12_JCLive_sf2_file', '42_16_JCLive_sf2_file', '42_18_JCLive_sf2_file', '42_4_Chaos_sf2_file', '43_0_SBLive_sf2', '43_12_JCLive_sf2_file', '43_16_JCLive_sf2_file', '43_18_JCLive_sf2_file', '43_4_Chaos_sf2_file', '44_0_SBLive_sf2', '44_12_JCLive_sf2_file', '44_16_JCLive_sf2_file', '44_18_JCLive_sf2_file', '44_4_Chaos_sf2_file', '45_0_SBLive_sf2', '45_12_JCLive_sf2_file', '45_16_JCLive_sf2_file', '45_18_JCLive_sf2_file', '45_4_Chaos_sf2_file', '46_0_SBLive_sf2', '46_12_JCLive_sf2_file', '46_16_JCLive_sf2_file', '46_18_JCLive_sf2_file', '46_4_Chaos_sf2_file', '47_0_SBLive_sf2', '47_12_JCLive_sf2_file', '47_16_JCLive_sf2_file', '47_18_JCLive_sf2_file', '47_4_Chaos_sf2_file', '48_0_SBLive_sf2', '48_12_JCLive_sf2_file', '48_16_JCLive_sf2_file', '48_18_JCLive_sf2_file', '48_4_Chaos_sf2_file', '49_0_SBLive_sf2', '49_12_JCLive_sf2_file', '49_16_JCLive_sf2_file', '49_18_JCLive_sf2_file', '49_4_Chaos_sf2_file', '50_0_SBLive_sf2', '50_12_JCLive_sf2_file', '50_16_JCLive_sf2_file', '50_18_JCLive_sf2_file', '50_4_Chaos_sf2_file', '51_0_SBLive_sf2', '51_12_JCLive_sf2_file', '51_16_JCLive_sf2_file', '51_18_JCLive_sf2_file', '51_4_Chaos_sf2_file', '52_0_SBLive_sf2', '52_12_JCLive_sf2_file', '52_16_JCLive_sf2_file', '52_18_JCLive_sf2_file', '52_4_Chaos_sf2_file', '53_0_SBLive_sf2', '53_12_JCLive_sf2_file', '53_16_JCLive_sf2_file', '53_18_JCLive_sf2_file', '53_4_Chaos_sf2_file', '54_0_SBLive_sf2', '54_12_JCLive_sf2_file', '54_16_JCLive_sf2_file', '54_18_JCLive_sf2_file', '54_4_Chaos_sf2_file', '55_0_SBLive_sf2', '55_12_JCLive_sf2_file', '55_16_JCLive_sf2_file', '55_18_JCLive_sf2_file', '55_4_Chaos_sf2_file', '56_0_SBLive_sf2', '56_12_JCLive_sf2_file', '56_16_JCLive_sf2_file', '56_18_JCLive_sf2_file', '56_4_Chaos_sf2_file', '57_0_SBLive_sf2', '57_12_JCLive_sf2_file', '57_16_JCLive_sf2_file', '57_18_JCLive_sf2_file', '57_4_Chaos_sf2_file', '58_0_SBLive_sf2', '58_12_JCLive_sf2_file', '58_16_JCLive_sf2_file', '58_18_JCLive_sf2_file', '58_4_Chaos_sf2_file', '59_0_SBLive_sf2', '59_12_JCLive_sf2_file', '59_16_JCLive_sf2_file', '59_18_JCLive_sf2_file', '59_4_Chaos_sf2_file', '60_0_SBLive_sf2', '60_12_JCLive_sf2_file', '60_16_JCLive_sf2_file', '60_18_JCLive_sf2_file', '60_4_Chaos_sf2_file', '61_0_SBLive_sf2', '61_12_JCLive_sf2_file', '61_16_JCLive_sf2_file', '61_18_JCLive_sf2_file', '61_4_Chaos_sf2_file', '62_0_SBLive_sf2', '62_12_JCLive_sf2_file', '62_16_JCLive_sf2_file', '62_18_JCLive_sf2_file', '62_4_Chaos_sf2_file', '63_0_SBLive_sf2', '63_12_JCLive_sf2_file', '63_16_JCLive_sf2_file', '63_18_JCLive_sf2_file', '63_4_Chaos_sf2_file', '64_0_SBLive_sf2', '64_12_JCLive_sf2_file', '64_16_JCLive_sf2_file', '64_18_JCLive_sf2_file', '64_4_Chaos_sf2_file', '65_0_SBLive_sf2', '65_12_JCLive_sf2_file', '65_16_JCLive_sf2_file', '65_18_JCLive_sf2_file', '65_4_Chaos_sf2_file', '66_0_SBLive_sf2', '66_12_JCLive_sf2_file', '66_16_JCLive_sf2_file', '66_18_JCLive_sf2_file', '66_4_Chaos_sf2_file', '67_0_SBLive_sf2', '67_12_JCLive_sf2_file', '67_16_JCLive_sf2_file', '67_18_JCLive_sf2_file', '67_4_Chaos_sf2_file', '68_0_SBLive_sf2', '68_12_JCLive_sf2_file', '68_16_JCLive_sf2_file', '68_18_JCLive_sf2_file', '68_4_Chaos_sf2_file', '69_0_SBLive_sf2', '69_12_JCLive_sf2_file', '69_16_JCLive_sf2_file', '69_18_JCLive_sf2_file', '69_4_Chaos_sf2_file', '70_0_SBLive_sf2', '70_12_JCLive_sf2_file', '70_16_JCLive_sf2_file', '70_18_JCLive_sf2_file', '70_4_Chaos_sf2_file', '71_0_SBLive_sf2', '71_12_JCLive_sf2_file', '71_16_JCLive_sf2_file', '71_18_JCLive_sf2_file', '71_4_Chaos_sf2_file', '72_0_SBLive_sf2', '72_12_JCLive_sf2_file', '72_16_JCLive_sf2_file', '72_18_JCLive_sf2_file', '72_4_Chaos_sf2_file', '73_0_SBLive_sf2', '73_12_JCLive_sf2_file', '73_16_JCLive_sf2_file', '73_18_JCLive_sf2_file', '73_4_Chaos_sf2_file', '74_0_SBLive_sf2', '74_12_JCLive_sf2_file', '74_16_JCLive_sf2_file', '74_18_JCLive_sf2_file', '74_4_Chaos_sf2_file', '75_0_SBLive_sf2', '75_12_JCLive_sf2_file', '75_16_JCLive_sf2_file', '75_18_JCLive_sf2_file', '75_4_Chaos_sf2_file', '76_0_SBLive_sf2', '76_12_JCLive_sf2_file', '76_16_JCLive_sf2_file', '76_18_JCLive_sf2_file', '76_4_Chaos_sf2_file', '77_0_SBLive_sf2', '77_12_JCLive_sf2_file', '77_16_JCLive_sf2_file', '77_18_JCLive_sf2_file', '77_4_Chaos_sf2_file', '78_0_SBLive_sf2', '78_12_JCLive_sf2_file', '78_16_JCLive_sf2_file', '78_18_JCLive_sf2_file', '78_4_Chaos_sf2_file', '79_0_SBLive_sf2', '79_12_JCLive_sf2_file', '79_16_JCLive_sf2_file', '79_18_JCLive_sf2_file', '79_4_Chaos_sf2_file', '80_0_SBLive_sf2', '80_12_JCLive_sf2_file', '80_16_JCLive_sf2_file', '80_18_JCLive_sf2_file', '80_4_Chaos_sf2_file', '81_0_SBLive_sf2', '81_12_JCLive_sf2_file', '81_16_JCLive_sf2_file', '81_18_JCLive_sf2_file', '81_4_Chaos_sf2_file'
            ];
        }
        return this.drumKeyArray;
    };
    ;
    ZvoogPlayer.prototype.findDrum = function (nn) {
        for (var i = 0; i < this.drumKeys().length; i++) {
            var num = this.drumKeys()[i].substring(0, 2);
            if (nn == parseInt(num)) {
                return i;
            }
        }
        return 0;
    };
    ZvoogPlayer.prototype.startLoad = function (audioContext, filePath, variableName) {
        if (window[variableName]) {
            this.adjustPreset(audioContext, window[variableName]);
        }
        else {
            var r = document.createElement('script');
            r.setAttribute("type", "text/javascript");
            r.setAttribute("src", filePath);
            document.getElementsByTagName("head")[0].appendChild(r);
            //this.decodeAfterLoading(audioContext, variableName);
            var me = this;
            this.waitOrFinish(variableName, function () {
                me.adjustPreset(audioContext, window[variableName]);
            });
        }
    };
    ;
    ZvoogPlayer.prototype.waitOrFinish = function (variableName, onFinish) {
        if (window[variableName]) {
            onFinish();
        }
        else {
            var me = this;
            setTimeout(function () {
                me.waitOrFinish(variableName, onFinish);
            }, 111);
        }
    };
    ;
    return ZvoogPlayer;
}());
;
var ZvoogFxGain = /** @class */ (function () {
    function ZvoogFxGain() {
        this.vals = [];
    }
    ZvoogFxGain.prototype.prepare = function (audioContext) {
        this.base = audioContext.createGain();
        var me = this;
        this.gainParam = {
            label: function () { return "level"; },
            cancelScheduledValues: function (cancelTime) { me.base.gain.cancelScheduledValues(cancelTime); },
            linearRampToValueAtTime: function (value, endTime) { me.base.gain.linearRampToValueAtTime(value, endTime); },
            setValueAtTime: function (value, startTime) { me.base.gain.setValueAtTime(value, startTime); }
        };
        this.params = [];
        this.params.push(this.gainParam);
        //this.props = [];
    };
    ZvoogFxGain.prototype.getInput = function () {
        return this.base;
    };
    ZvoogFxGain.prototype.getOutput = function () {
        return this.base;
    };
    ZvoogFxGain.prototype.getParams = function () {
        return this.params;
    };
    ZvoogFxGain.prototype.getValues = function () {
        return this.vals;
    };
    ZvoogFxGain.prototype.busy = function () {
        return 0;
    };
    ZvoogFxGain.prototype.label = function () {
        return 'Volume';
    };
    return ZvoogFxGain;
}());
var ZvoogWaveSource = /** @class */ (function () {
    function ZvoogWaveSource(url, rootPitch, startOffset) {
        this.vals = [];
        this.afterTime = 0.008;
        this.busyState = 1;
        this.offset = 0;
        this.path = url;
        this.root = rootPitch;
        this.offset = startOffset;
        this.busyState = 1;
        //this.properties = [];
    }
    ZvoogWaveSource.prototype.label = function () {
        return 'Audio Wave';
    };
    ZvoogWaveSource.prototype.getValues = function () {
        return this.vals;
    };
    ZvoogWaveSource.prototype.prepare = function (audioContext) {
        this.out = audioContext.createGain();
        this.params = [];
        this.waves = [];
        this.envelopes = [];
        this.audioContext = audioContext;
        var xmlHttpRequest = new XMLHttpRequest();
        xmlHttpRequest.open('GET', this.path, true);
        xmlHttpRequest.responseType = 'arraybuffer';
        var me = this;
        xmlHttpRequest.onload = function (progressEvent) {
            var arrayBuffer = xmlHttpRequest.response;
            if (arrayBuffer) {
                audioContext.decodeAudioData(arrayBuffer, function (audioBuffer) {
                    me.buffer = audioBuffer;
                    me.busyState = 0;
                });
            }
        };
        xmlHttpRequest.send(null);
    };
    ZvoogWaveSource.prototype.getOutput = function () {
        return this.out;
    };
    ZvoogWaveSource.prototype.getParams = function () {
        return this.params;
    };
    ZvoogWaveSource.prototype.cancelSchedule = function () {
        for (var i = 0; i < this.waves.length; i++) {
            this.waves[i].audio.stop();
        }
    };
    ZvoogWaveSource.prototype.schedule = function (when, tempo, chord) {
        for (var i = 0; i < chord.length; i++) {
            this.single(when, tempo, chord[i]);
        }
    };
    ZvoogWaveSource.prototype.single = function (when, tempo, pitches) {
        this.cleanup();
        var audioBufferSourceNode = this.audioContext.createBufferSource();
        audioBufferSourceNode.buffer = this.buffer;
        var currentPlaybackRate = this.freq(pitches[0].pitch) / this.freq(this.root);
        audioBufferSourceNode.playbackRate.setValueAtTime(currentPlaybackRate, 0);
        var at = when + duration2time(tempo, pitches[0].duration);
        for (var i = 1; i < pitches.length; i++) {
            audioBufferSourceNode.playbackRate.linearRampToValueAtTime(this.freq(pitches[i].pitch) / this.freq(this.root), at);
            at = at + duration2time(tempo, pitches[i].duration);
        }
        var time = 0;
        for (var i_1 = 0; i_1 < pitches.length; i_1++) {
            time = time + duration2time(tempo, pitches[i_1].duration);
        }
        var e = this.findEnvelope(when, time);
        audioBufferSourceNode.connect(e.base);
        audioBufferSourceNode.start(when, this.offset);
        audioBufferSourceNode.stop(when + time + this.afterTime);
        this.waves.push({ audio: audioBufferSourceNode, end: at });
    };
    ZvoogWaveSource.prototype.findEnvelope = function (when, duration) {
        var envelope = null;
        for (var i = 0; i < this.envelopes.length; i++) {
            var e = this.envelopes[i];
            if (this.audioContext.currentTime > e.when + e.duration + this.afterTime) {
                envelope = e;
                break;
            }
        }
        if (!(envelope)) {
            envelope = {
                base: this.audioContext.createGain(),
                when: 0,
                duration: 0
            };
            this.envelopes.push(envelope);
            envelope.base.connect(this.out);
        }
        envelope.when = when;
        envelope.duration = duration;
        envelope.base.gain.setValueAtTime(0, 0);
        envelope.base.gain.setValueAtTime(0, when);
        envelope.base.gain.linearRampToValueAtTime(1, when + this.afterTime);
        envelope.base.gain.setValueAtTime(1, when + duration);
        envelope.base.gain.linearRampToValueAtTime(0, when + duration + this.afterTime);
        return envelope;
    };
    ;
    ZvoogWaveSource.prototype.busy = function () {
        return this.busyState;
    };
    ZvoogWaveSource.prototype.freq = function (key) {
        var O4 = [261.63, 277.18, 293.66, 311.13, 329.63, 349.23, 369.99, 392.00, 415.30, 440.00, 466.16, 493.88];
        var half = Math.floor(key % 12);
        var octave = Math.floor(key / 12);
        var freq0 = O4[half] / (2 * 2 * 2 * 2);
        return freq0 * Math.pow(2, octave);
    };
    ZvoogWaveSource.prototype.nextClear = function () {
        for (var i = 0; i < this.waves.length; i++) {
            if (this.waves[i].end < this.audioContext.currentTime) {
                try {
                    this.waves[i].audio.stop();
                    this.waves[i].audio.disconnect();
                }
                catch (x) {
                    console.log(x);
                }
                this.waves.splice(i, 1);
                return true;
            }
        }
        return false;
    };
    ZvoogWaveSource.prototype.cleanup = function () {
        while (this.nextClear()) {
            //
        }
        ;
    };
    return ZvoogWaveSource;
}());
var ZvoogSimpleSource = /** @class */ (function () {
    function ZvoogSimpleSource() {
        this.afterTime = 0.008;
        this.vals = [];
    }
    ZvoogSimpleSource.prototype.prepare = function (audioContext) {
        this.out = audioContext.createGain();
        this.params = [];
        this.sines = [];
        this.envelopes = [];
        this.audioContext = audioContext;
        //this.properties = [];
    };
    ZvoogSimpleSource.prototype.label = function () {
        return 'Sine Wave';
    };
    ZvoogSimpleSource.prototype.getValues = function () {
        return this.vals;
    };
    ZvoogSimpleSource.prototype.getOutput = function () {
        return this.out;
    };
    ZvoogSimpleSource.prototype.getParams = function () {
        return this.params;
    };
    ZvoogSimpleSource.prototype.cancelSchedule = function () {
        for (var i = 0; i < this.sines.length; i++) {
            this.sines[i].node.stop();
        }
    };
    ZvoogSimpleSource.prototype.schedule = function (when, tempo, chord) {
        for (var i = 0; i < chord.length; i++) {
            this.single(when, tempo, chord[i]);
        }
    };
    ZvoogSimpleSource.prototype.single = function (when, tempo, pitches) {
        this.cleanup();
        var oscillator = this.audioContext.createOscillator();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(this.freq(pitches[0].pitch), when);
        var at = when + duration2time(tempo, pitches[0].duration);
        for (var i = 1; i < pitches.length; i++) {
            oscillator.frequency.linearRampToValueAtTime(this.freq(pitches[i].pitch), at);
            at = at + duration2time(tempo, pitches[i].duration);
        }
        var duration = 0;
        for (var i_2 = 0; i_2 < pitches.length; i_2++) {
            duration = duration + duration2time(tempo, pitches[i_2].duration);
        }
        var e = this.findEnvelope(when, duration);
        //console.log(this.audioContext.currentTime,when,when+duration,e);
        //oscillator.connect(this.out);
        oscillator.connect(e.base);
        oscillator.start(when);
        oscillator.stop(when + duration + this.afterTime);
        this.sines.push({ node: oscillator, end: at });
    };
    ZvoogSimpleSource.prototype.findEnvelope = function (when, duration) {
        var envelope = null;
        for (var i = 0; i < this.envelopes.length; i++) {
            var e = this.envelopes[i];
            if (this.audioContext.currentTime > e.when + e.duration + this.afterTime) {
                envelope = e;
                //console.log('found');
                break;
            }
        }
        if (!(envelope)) {
            envelope = {
                base: this.audioContext.createGain()
                //, target: target
                ,
                when: 0,
                duration: 0
                /*, cancel: function (): void {
                    if (envelope) if (envelope.when + envelope.duration > this.audioContext.currentTime) {
                        envelope.base.gain.cancelScheduledValues(0);
                        envelope.base.gain.setTargetAtTime(0.00001, this.audioContext.currentTime, 0.1);
                        envelope.when = this.audioContext.currentTime + 0.00001;
                        envelope.duration = 0;
                    }
                }*/
            };
            this.envelopes.push(envelope);
            envelope.base.connect(this.out);
            //envelope.base.gain.setValueAtTime(0.5,0);
            //console.log('created',this.envelopes.length);
        }
        envelope.when = when;
        envelope.duration = duration;
        envelope.base.gain.setValueAtTime(0, 0);
        envelope.base.gain.setValueAtTime(0, when);
        envelope.base.gain.linearRampToValueAtTime(1, when + this.afterTime);
        envelope.base.gain.setValueAtTime(1, when + duration);
        envelope.base.gain.linearRampToValueAtTime(0, when + duration + this.afterTime);
        //envelope.base.gain.setValueAtTime(0, when + duration + this.afterTime);
        //console.log(envelope);
        return envelope;
    };
    ;
    ZvoogSimpleSource.prototype.busy = function () {
        return 0;
    };
    ZvoogSimpleSource.prototype.freq = function (key) {
        var O4 = [261.63, 277.18, 293.66, 311.13, 329.63, 349.23, 369.99, 392.00, 415.30, 440.00, 466.16, 493.88];
        var half = Math.floor(key % 12);
        var octave = Math.floor(key / 12);
        var freq0 = O4[half] / (2 * 2 * 2 * 2);
        return freq0 * Math.pow(2, octave);
    };
    ZvoogSimpleSource.prototype.nextClear = function () {
        for (var i = 0; i < this.sines.length; i++) {
            if (this.sines[i].end < this.audioContext.currentTime) {
                try {
                    this.sines[i].node.stop();
                    this.sines[i].node.disconnect();
                }
                catch (x) {
                    console.log(x);
                }
                this.sines.splice(i, 1);
                return true;
            }
        }
        return false;
    };
    ZvoogSimpleSource.prototype.cleanup = function () {
        while (this.nextClear()) {
            //
        }
        ;
    };
    return ZvoogSimpleSource;
}());
var ZvoogInstrumentSource = /** @class */ (function () {
    function ZvoogInstrumentSource(midi) {
        this.midi = -1;
        this.vals = [];
        this.midi = midi;
        //this.properties=[];
    }
    ZvoogInstrumentSource.prototype.label = function () {
        return 'WAF instrument';
    };
    ZvoogInstrumentSource.prototype.getValues = function () {
        return this.vals;
    };
    ZvoogInstrumentSource.prototype.prepare = function (audioContext) {
        this.base = audioContext.createGain();
        //this.base.gain.setValueAtTime(0.5,0);
        this.params = [];
        this.audioContext = audioContext;
        this.player = new ZvoogPlayer();
        var nn = this.player.findInstrument(this.midi);
        var info = this.player.instrumentInfo(nn);
        this.player.startLoad(audioContext, info.url, info.variable);
    };
    ZvoogInstrumentSource.prototype.getOutput = function () {
        return this.base;
    };
    ZvoogInstrumentSource.prototype.getParams = function () {
        return this.params;
    };
    ZvoogInstrumentSource.prototype.cancelSchedule = function () {
        this.player.cancelQueue(this.audioContext);
    };
    ZvoogInstrumentSource.prototype.schedule = function (when, tempo, chord) {
        if (this.zones) {
            for (var i = 0; i < chord.length; i++) {
                this.player.queueWaveTable(this.audioContext, this.base, this.zones, when, tempo, chord[i]);
            }
        }
    };
    ZvoogInstrumentSource.prototype.busy = function () {
        if (this.zones) {
            return 0;
        }
        var nn = this.player.findInstrument(this.midi);
        var info = this.player.instrumentInfo(nn);
        var z = this.player.zones(info.variable);
        if (z) {
            this.zones = z;
            return 0;
        }
        else {
            return 1;
        }
    };
    return ZvoogInstrumentSource;
}());
var ZvoogDrumSource = /** @class */ (function () {
    function ZvoogDrumSource(midi) {
        this.midi = -1;
        this.midi = midi;
        //this.properties=[];
    }
    ZvoogDrumSource.prototype.label = function () {
        return 'WAF drum';
    };
    ZvoogDrumSource.prototype.getValues = function () {
        return this.vals;
    };
    ZvoogDrumSource.prototype.prepare = function (audioContext) {
        this.base = audioContext.createGain();
        //this.base.gain.setValueAtTime(0.5,0);
        this.params = [];
        this.audioContext = audioContext;
        this.player = new ZvoogPlayer();
        var nn = this.player.findDrum(this.midi);
        var info = this.player.drumInfo(nn);
        this.player.startLoad(audioContext, info.url, info.variable);
    };
    ZvoogDrumSource.prototype.getOutput = function () {
        return this.base;
    };
    ZvoogDrumSource.prototype.getParams = function () {
        return this.params;
    };
    ZvoogDrumSource.prototype.cancelSchedule = function () {
        this.player.cancelQueue(this.audioContext);
    };
    ZvoogDrumSource.prototype.schedule = function (when, tempo, chord) {
        if (this.zones) {
            for (var i = 0; i < chord.length; i++) {
                this.player.queueWaveTable(this.audioContext, this.base, this.zones, when, tempo, chord[i]);
            }
        }
    };
    ZvoogDrumSource.prototype.busy = function () {
        if (this.zones) {
            return 0;
        }
        var nn = this.player.findDrum(this.midi);
        var info = this.player.drumInfo(nn);
        var z = this.player.zones(info.variable);
        if (z) {
            this.zones = z;
            return 0;
        }
        else {
            return 1;
        }
    };
    return ZvoogDrumSource;
}());
console.log('tilelevel v2.15');
//let this: TileLevel = null;
/*
let layerModeLockX: string = 'lockX';
let layerModeNormal: string = 'normal';
let layerModeOverlay: string = 'overlay';
let layerModeLockY: string = 'lockY';
let layerModeStickBottom: string = 'stickBottom';
let layerModeStickRight: string = 'stickRight';
*/
var CannyDo = /** @class */ (function () {
    function CannyDo() {
        this.currentID = 0;
    }
    CannyDo.prototype.start = function (ms, action) {
        var startId = -1;
        this.currentID = setTimeout(function () {
            //console.log(startId,this.currentID,this);
            if (startId == this.currentID) {
                action();
            }
        }.bind(this), ms);
        startId = this.currentID;
    };
    return CannyDo;
}());
var TileLevel = /** @class */ (function () {
    function TileLevel(svgObject, inWidth, inHeight, minZoom, curZoom, maxZoom, layers) {
        this.tapSize = 50;
        this.twoZoom = false;
        this.clickLimit = this.tapSize / 6;
        this.svgns = "http://www.w3.org/2000/svg";
        this.viewWidth = 0;
        this.viewHeight = 0;
        this.innerWidth = 0;
        this.innerHeight = 0;
        this._translateX = 0;
        this._translateY = 0;
        this._translateZ = 1;
        this.startMouseScreenX = 0;
        this.startMouseScreenY = 0;
        this.clickX = 0;
        this.clickY = 0;
        this.dragZoom = 1;
        this.allTilesOK = false;
        this.clicked = false;
        this.mx = 100;
        this.mn = 1;
        this.startedTouch = false;
        this.twodistance = 0;
        this.model = [];
        this.slidingLockTo = 0;
        this.slidingID = 0;
        this.onResizeDo = new CannyDo();
        this.onZoom = new CannyDo();
        this.lastTickTime = 0;
        this.fastenUp = true;
        this.fastenDown = true;
        this.fastenLeft = true;
        this.fastenRight = true;
        this.lastMoveDx = 0;
        this.lastMoveDy = 0;
        this.lastMoveDt = 0;
        //onMoveStop: CannyDo = new CannyDo();
        this.mouseDownMode = false;
        //console.log('TileLevel');
        //this = this;
        this.svg = svgObject;
        this.setupTapSize();
        this.viewWidth = this.svg.clientWidth;
        this.viewHeight = this.svg.clientHeight;
        //this.innerWidth = this.viewWidth;
        //this.innerHeight = this.viewHeight;
        this.innerWidth = inWidth * this.tapSize;
        this.innerHeight = inHeight * this.tapSize;
        this.mx = maxZoom;
        this.mn = minZoom;
        this.translateZ = curZoom;
        this.svg.addEventListener("wheel", this.rakeMouseWheel.bind(this), { capture: false, passive: false });
        this.svg.addEventListener("touchstart", this.rakeTouchStart.bind(this), { capture: false, passive: false });
        this.svg.addEventListener("touchmove", this.rakeTouchMove.bind(this), { capture: false, passive: false });
        this.svg.addEventListener("touchend", this.rakeTouchEnd.bind(this), { capture: false, passive: false });
        this.svg.addEventListener('mousedown', this.rakeMouseDown.bind(this), { capture: false, passive: false });
        this.svg.addEventListener('mousemove', this.rakeMouseMove.bind(this), { capture: false, passive: false });
        this.svg.addEventListener('mouseup', this.rakeMouseUp.bind(this), { capture: false, passive: false });
        window.addEventListener('resize', this.onAfterResize.bind(this));
        this.setModel(layers);
        this.startLoop();
        this.applyZoomPosition();
        this.clearUselessDetails();
    }
    TileLevel.prototype.anchor = function (xx, yy, ww, hh, showZoom, hideZoom) {
        return { xx: xx, yy: yy, ww: ww, hh: hh, showZoom: showZoom, hideZoom: hideZoom, content: [] };
    };
    TileLevel.prototype.rectangle = function (x, y, w, h, rx, ry, css) {
        return { x: x, y: y, w: w, h: h, rx: rx, ry: ry, css: css };
    };
    TileLevel.prototype.actionRectangle = function (action, x, y, w, h, rx, ry, css) {
        return { x: x, y: y, w: w, h: h, rx: rx, ry: ry, css: css, action: action };
    };
    TileLevel.prototype.line = function (x1, y1, x2, y2, css) {
        return { x1: x1, y1: y1, x2: x2, y2: y2, css: css };
    };
    TileLevel.prototype.text = function (x, y, text, css) {
        return { x: x, y: y, text: text, css: css };
    };
    TileLevel.prototype.pathImage = function (x, y, scale, points, css) {
        return { x: x, y: y, scale: scale, points: points, css: css };
    };
    TileLevel.prototype.isLayerStickTop = function (t) {
        return t.stickTop !== undefined;
    };
    TileLevel.prototype.isLayerStickBottom = function (t) {
        return t.stickBottom !== undefined;
    };
    TileLevel.prototype.isLayerStickRight = function (t) {
        return t.stickRight !== undefined;
    };
    TileLevel.prototype.isLayerOverlay = function (t) {
        return t.overlay !== undefined;
    };
    TileLevel.prototype.isTilePath = function (t) {
        return t.points !== undefined;
    };
    TileLevel.prototype.isTileText = function (t) {
        return t.text !== undefined;
    };
    TileLevel.prototype.isTileLine = function (t) {
        return t.x1 !== undefined;
    };
    TileLevel.prototype.isTilePolygon = function (t) {
        return t.dots !== undefined;
    };
    TileLevel.prototype.isLayerStickLeft = function (t) {
        return t.stickLeft !== undefined;
    };
    TileLevel.prototype.isTileRectangle = function (t) {
        return t.h !== undefined;
    };
    TileLevel.prototype.isTileGroup = function (t) {
        return t.content !== undefined;
    };
    TileLevel.prototype.isLayerNormal = function (t) {
        return t.stickLeft === undefined
            && t.stickTop === undefined
            && t.stickBottom === undefined
            && t.stickRight === undefined
            && t.overlay === undefined;
    };
    TileLevel.prototype.rid = function () {
        return 'id' + Math.floor(Math.random() * 1000000000);
    };
    Object.defineProperty(TileLevel.prototype, "translateZ", {
        get: function () {
            return this._translateZ;
        },
        set: function (z) {
            if (z != this._translateZ) {
                //console.log('z',this._translateZ,'=>',z);
                this._translateZ = z;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TileLevel.prototype, "translateX", {
        get: function () {
            return this._translateX;
        },
        set: function (x) {
            if (x != this._translateX) {
                //console.log('x',this._translateX,'=>',x);
                this._translateX = x;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TileLevel.prototype, "translateY", {
        get: function () {
            return this._translateY;
        },
        set: function (y) {
            if (y != this._translateY) {
                //console.log('y',this._translateY,'=>',y);
                this._translateY = y;
            }
        },
        enumerable: true,
        configurable: true
    });
    TileLevel.prototype.dump = function () {
        console.log('dump', this);
    };
    /*
    start(layers: TileModelLayer[]){//layers: TileModelLayer[], innerWidth: number, innerHeight: number, minZoom: number, curZoom: number, maxZoom: number) {
        this.setModel(layers);
        this.startLoop();
        //this.innerWidth = innerWidth;
        //this.innerHeight = innerHeight;
        //this.mx = maxZoom;
        //this.mn = minZoom;
        //this.translateZ = curZoom;
        this.applyZoomPosition();
        this.clearUselessDetails();
        //console.log('start', this);
    }*/
    TileLevel.prototype.setupTapSize = function () {
        var rect = document.createElementNS(this.svgns, 'rect');
        rect.setAttributeNS(null, 'height', '1cm');
        rect.setAttributeNS(null, 'width', '1cm');
        this.svg.appendChild(rect);
        var tbb = rect.getBBox();
        this.tapSize = tbb.width;
        this.svg.removeChild(rect);
        this.clickLimit = this.tapSize / 6;
    };
    TileLevel.prototype.onAfterResize = function () {
        this.onResizeDo.start(333, function () {
            //console.log('resized', this);
            this.viewWidth = this.svg.clientWidth;
            this.viewHeight = this.svg.clientHeight;
            //this.resetModel();
            if (this.afterResizeCallback) {
                this.afterResizeCallback();
            }
            this.applyZoomPosition();
            this.adjustContentPosition();
            this.slideToContentPosition();
        }.bind(this));
    };
    TileLevel.prototype.onMove = function (dx, dy) {
        var d = new Date();
        //console.log('onMove speed', d, d.getMilliseconds(), dx, dy, Math.sqrt(dx * dx + dy * dy));
        this.lastMoveDx = dx;
        this.lastMoveDy = dy;
        this.lastMoveDt = Date.now();
        /*var me=this;
        this.onMoveStop.start(100, function () {
            me.moveTail();
        }.bind(this));*/
    };
    TileLevel.prototype.moveTail = function (speed) {
        //if(speed>1){
        //var speed = Math.sqrt(this.lastMoveDx * this.lastMoveDx + this.lastMoveDy * this.lastMoveDy) / (Date.now() - this.lastMoveDt)
        var dx = this.translateX + 2 * this.tapSize * speed * this.lastMoveDx;
        var dy = this.translateY + 2 * this.tapSize * speed * this.lastMoveDy;
        //console.log('moveTail', speed, 'from', this.translateX, this.translateY, 'to', dx, dy);//Math.sqrt(this.lastMoveDx * this.lastMoveDx + this.lastMoveDy * this.lastMoveDy) / (Date.now() - this.lastMoveDt));
        //this.cancelDragZoom();
        //this.slideToContentPosition();
        //this.allTilesOK = false;
        //var me=this;
        this.startSlideTo(dx, dy, this.translateZ, function () {
            //console.log('done',this.translateX,this.translateY,this.translateZ);
        }.bind(this));
        //}
    };
    TileLevel.prototype.rakeMouseWheel = function (e) {
        //console.log('rakeMouseWheel',e);
        this.slidingLockTo = -1;
        //console.log('rakeMouseWheel',e.wheelDelta,e.detail,e.deltaX,e.deltaY,e.deltaZ,e);
        e.preventDefault();
        //let wheelVal = e.wheelDelta || -e.detail;
        var wheelVal = e.deltaY;
        var min = Math.min(1, wheelVal);
        var delta = Math.max(-1, min);
        var zoom = this.translateZ - delta * (this.translateZ) * 0.077;
        if (zoom < this.minZoom()) {
            zoom = this.minZoom();
        }
        if (zoom > this.maxZoom()) {
            zoom = this.maxZoom();
        }
        this.translateX = this.translateX - (this.translateZ - zoom) * e.offsetX;
        this.translateY = this.translateY - (this.translateZ - zoom) * e.offsetY;
        this.translateZ = zoom;
        this.applyZoomPosition();
        this.adjustContentPosition();
        this.allTilesOK = false;
        return false;
    };
    TileLevel.prototype.rakeMouseDown = function (mouseEvent) {
        this.slidingLockTo = -1;
        //console.log('rakeMouseDown',mouseEvent);
        mouseEvent.preventDefault();
        //this.svg.addEventListener('mousemove', this.rakeMouseMove.bind(this), true);
        //this.svg.addEventListener('mouseup', this.rakeMouseUp.bind(this), false);
        this.mouseDownMode = true;
        this.startMouseScreenX = mouseEvent.offsetX;
        this.startMouseScreenY = mouseEvent.offsetY;
        this.clickX = this.startMouseScreenX;
        this.clickY = this.startMouseScreenY;
        this.clicked = false;
        this.startDragZoom();
    };
    TileLevel.prototype.rakeMouseMove = function (mouseEvent) {
        //console.log('rakeMouseMove',mouseEvent);
        if (this.mouseDownMode) {
            mouseEvent.preventDefault();
            var dX = mouseEvent.offsetX - this.startMouseScreenX;
            var dY = mouseEvent.offsetY - this.startMouseScreenY;
            this.translateX = this.translateX + dX * this.translateZ;
            this.translateY = this.translateY + dY * this.translateZ;
            this.startMouseScreenX = mouseEvent.offsetX;
            this.startMouseScreenY = mouseEvent.offsetY;
            this.applyZoomPosition();
            this.onMove(dX, dY);
        }
    };
    TileLevel.prototype.rakeMouseUp = function (mouseEvent) {
        //console.log('rakeMouseUp',mouseEvent);
        if (this.mouseDownMode) {
            this.mouseDownMode = false;
            mouseEvent.preventDefault();
            //this.svg.removeEventListener('mousemove', this.rakeMouseMove, true);
            //this.svg.removeEventListener('mousemove', this.rakeMouseMove.bind(this));
            this.cancelDragZoom();
            if (Math.abs(this.clickX - mouseEvent.offsetX) < this.clickLimit //
                &&
                    Math.abs(this.clickY - mouseEvent.offsetY) < this.clickLimit) {
                this.clicked = true;
                //this.cancelDragZoom();
                this.slideToContentPosition();
                this.allTilesOK = false;
            }
            else {
                //var speed = Math.sqrt(this.lastMoveDx * this.lastMoveDx + this.lastMoveDy * this.lastMoveDy) / (Date.now() - this.lastMoveDt);
                //if (speed > 1) {
                //this.moveTail(speed);
                //} else {
                //this.cancelDragZoom();
                this.slideToContentPosition();
                this.allTilesOK = false;
                //}
            }
        }
    };
    TileLevel.prototype.rakeTouchStart = function (touchEvent) {
        //console.log('rakeTouchStart',touchEvent.touches.length);
        this.slidingLockTo = -1;
        touchEvent.preventDefault();
        this.startedTouch = true;
        if (touchEvent.touches.length < 2) {
            this.twoZoom = false;
            this.startMouseScreenX = touchEvent.touches[0].clientX;
            this.startMouseScreenY = touchEvent.touches[0].clientY;
            this.clickX = this.startMouseScreenX;
            this.clickY = this.startMouseScreenY;
            this.twodistance = 0;
            this.startDragZoom();
            return;
        }
        else {
            this.startTouchZoom(touchEvent);
        }
        this.clicked = false;
    };
    TileLevel.prototype.rakeTouchMove = function (touchEvent) {
        //console.log('rakeTouchMove',touchEvent.touches.length);
        touchEvent.preventDefault();
        if (this.startedTouch) {
            if (touchEvent.touches.length < 2) {
                if (this.twoZoom) {
                    //
                }
                else {
                    var dX = touchEvent.touches[0].clientX - this.startMouseScreenX;
                    var dY = touchEvent.touches[0].clientY - this.startMouseScreenY;
                    this.translateX = this.translateX + dX * this.translateZ;
                    this.translateY = this.translateY + dY * this.translateZ;
                    this.startMouseScreenX = touchEvent.touches[0].clientX;
                    this.startMouseScreenY = touchEvent.touches[0].clientY;
                    this.applyZoomPosition();
                    this.onMove(dX, dY);
                    return;
                }
            }
            else {
                if (!this.twoZoom) {
                    this.startTouchZoom(touchEvent);
                }
                else {
                    var p1 = this.vectorFromTouch(touchEvent.touches[0]);
                    var p2 = this.vectorFromTouch(touchEvent.touches[1]);
                    var d = this.vectorDistance(p1, p2);
                    if (d <= 0) {
                        d = 1;
                    }
                    var ratio = d / this.twodistance;
                    this.twodistance = d;
                    var zoom = this.translateZ / ratio;
                    if (zoom < this.minZoom()) {
                        zoom = this.minZoom();
                    }
                    if (zoom > this.maxZoom()) {
                        zoom = this.maxZoom();
                    }
                    /*let cX:number = 0;
                    let cY:number = 0;
                    if (this.viewWidth * this.translateZ > this.innerWidth) {
                        cX = (this.viewWidth - this.innerWidth / this.translateZ) / 2;
                    }
                    if (this.viewHeight * this.translateZ > this.innerHeight) {
                        cY = (this.viewHeight - this.innerHeight / this.translateZ) / 2;
                    }*/
                    if (this.viewWidth * this.translateZ < this.innerWidth) {
                        this.translateX = this.translateX - (this.translateZ - zoom) * (this.twocenter.x);
                    }
                    if (this.viewHeight * this.translateZ < this.innerHeight) {
                        this.translateY = this.translateY - (this.translateZ - zoom) * (this.twocenter.y);
                    }
                    this.translateZ = zoom;
                    this.dragZoom = 1.0;
                    this.applyZoomPosition();
                }
            }
        }
    };
    TileLevel.prototype.rakeTouchEnd = function (touchEvent) {
        //console.log('rakeTouchEnd',touchEvent.touches.length);
        touchEvent.preventDefault();
        this.allTilesOK = false;
        if (!this.twoZoom) {
            if (touchEvent.touches.length < 2) {
                this.cancelDragZoom();
                if (this.startedTouch) {
                    if (Math.abs(this.clickX - this.startMouseScreenX) < this.translateZ * this.clickLimit //
                        &&
                            Math.abs(this.clickY - this.startMouseScreenY) < this.translateZ * this.clickLimit) {
                        this.clicked = true;
                        this.slideToContentPosition();
                    }
                    else {
                        //var speed = Math.sqrt(this.lastMoveDx * this.lastMoveDx + this.lastMoveDy * this.lastMoveDy) / (Date.now() - this.lastMoveDt);
                        //if (speed > 1) {
                        //	this.moveTail(speed);
                        //} else {
                        this.slideToContentPosition();
                        //}
                    }
                }
                else {
                    //console.log('touch ended already');
                }
                //this.cancelDragZoom();
                //this.slideToContentPosition();
                return;
            }
        }
        this.twoZoom = false;
        this.startedTouch = false;
        this.cancelDragZoom();
        this.slideToContentPosition();
    };
    TileLevel.prototype.startDragZoom = function () {
        this.dragZoom = 1.002;
        this.applyZoomPosition();
    };
    ;
    TileLevel.prototype.cancelDragZoom = function () {
        this.dragZoom = 1.0;
        this.applyZoomPosition();
    };
    ;
    TileLevel.prototype.applyZoomPosition = function () {
        var rx = -this.translateX - this.dragZoom * this.translateZ * (this.viewWidth - this.viewWidth / this.dragZoom) * (this.clickX / this.viewWidth);
        var ry = -this.translateY - this.dragZoom * this.translateZ * (this.viewHeight - this.viewHeight / this.dragZoom) * (this.clickY / this.viewHeight);
        var rw = this.viewWidth * this.translateZ * this.dragZoom;
        var rh = this.viewHeight * this.translateZ * this.dragZoom;
        this.svg.setAttribute('viewBox', rx + ' ' + ry + ' ' + rw + ' ' + rh);
        if (this.model) {
            for (var k = 0; k < this.model.length; k++) {
                var layer = this.model[k];
                var tx = 0;
                var ty = 0;
                var tz = 1;
                var cX = 0;
                var cY = 0;
                var sX = 0;
                var sY = 0;
                if (this.viewWidth * this.translateZ > this.innerWidth) {
                    cX = (this.viewWidth * this.translateZ - this.innerWidth) / 2;
                }
                if (this.viewHeight * this.translateZ > this.innerHeight) {
                    cY = (this.viewHeight * this.translateZ - this.innerHeight) / 2;
                }
                if (this.isLayerOverlay(layer)) {
                    tz = this.translateZ;
                    tx = -this.translateX;
                    ty = -this.translateY;
                    cX = 0;
                    cY = 0;
                }
                else {
                    if (this.isLayerStickLeft(layer)) {
                        tx = -this.translateX;
                        cX = 0;
                        if (layer.stickLeft) {
                            sX = layer.stickLeft * this.tapSize * this.translateZ;
                        }
                    }
                    else {
                        if (this.isLayerStickTop(layer)) {
                            ty = -this.translateY;
                            cY = 0;
                            if (layer.stickTop) {
                                sY = layer.stickTop * this.tapSize * this.translateZ;
                            }
                        }
                        else {
                            if (this.isLayerStickBottom(layer)) {
                                ty = -this.translateY;
                                cY = 0;
                                sY = this.viewHeight * this.translateZ;
                                if (layer.stickBottom) {
                                    sY = this.viewHeight * this.translateZ - layer.stickBottom * this.tapSize;
                                }
                            }
                            else {
                                if (this.isLayerStickRight(layer)) {
                                    tx = -this.translateX;
                                    cX = 0;
                                    sX = this.viewWidth * this.translateZ;
                                    if (layer.stickRight) {
                                        sX = this.viewWidth * this.translateZ - layer.stickRight * this.tapSize;
                                    }
                                }
                            }
                        }
                    }
                }
                layer.g.setAttribute('transform', 'translate(' + (tx + cX + sX) + ',' + (ty + cY + sY) + ') scale(' + tz + ',' + tz + ')');
            }
        }
        this.checkAfterZoom();
    };
    TileLevel.prototype.checkAfterZoom = function () {
        if (this.afterZoomCallback) {
            this.onZoom.start(555, function () {
                //console.log('afterZoom', this);
                this.afterZoomCallback();
            }.bind(this));
        }
    };
    TileLevel.prototype.slideToContentPosition = function () {
        var a = this.calculateValidContentPosition();
        //console.log(a,this.translateX,this.translateY,this.translateZ);
        if (a.x != this.translateX || a.y != this.translateY || a.z != this.translateZ) {
            this.startSlideTo(a.x, a.y, a.z, null);
        }
    };
    TileLevel.prototype.maxZoom = function () {
        return this.mx;
    };
    ;
    TileLevel.prototype.minZoom = function () {
        return this.mn;
    };
    ;
    TileLevel.prototype.adjustContentPosition = function () {
        var a = this.calculateValidContentPosition();
        if (a.x != this.translateX || a.y != this.translateY || a.z != this.translateZ) {
            this.translateX = a.x;
            this.translateY = a.y;
            this.translateZ = a.z;
            this.applyZoomPosition();
        }
    };
    TileLevel.prototype.calculateValidContentPosition = function () {
        var vX = this.translateX;
        var vY = this.translateY;
        var vZ = this.translateZ;
        if (this.translateX > 0) {
            vX = 0;
        }
        else {
            if (this.viewWidth - this.translateX / this.translateZ > this.innerWidth / this.translateZ) {
                if (this.viewWidth * this.translateZ - this.innerWidth <= 0) {
                    vX = this.viewWidth * this.translateZ - this.innerWidth;
                }
                else {
                    vX = 0;
                }
            }
        }
        var upLimit = this.viewHeight * this.translateZ;
        if (this.fastenUp) {
            upLimit = 0;
        }
        if (this.translateY > upLimit) {
            vY = upLimit;
        }
        else {
            if (this.viewHeight - this.translateY / this.translateZ > this.innerHeight / this.translateZ) {
                if (this.viewHeight * this.translateZ - this.innerHeight <= 0) {
                    vY = this.viewHeight * this.translateZ - this.innerHeight;
                    //console.log('to border');
                }
                else {
                    vY = 0;
                    //console.log('to 0');
                }
            }
        }
        if (this.translateZ < this.minZoom()) {
            vZ = this.minZoom();
        }
        else {
            if (this.translateZ > this.maxZoom()) {
                vZ = this.maxZoom();
            }
        }
        //console.log(this.translateX,this.translateY,this.translateZ,vX,vY,vZ);
        return {
            x: vX,
            y: vY,
            z: vZ
        };
    };
    TileLevel.prototype.startTouchZoom = function (touchEvent) {
        this.twoZoom = true;
        var p1 = this.vectorFromTouch(touchEvent.touches[0]);
        var p2 = this.vectorFromTouch(touchEvent.touches[1]);
        this.twocenter = this.vectorFindCenter(p1, p2);
        var d = this.vectorDistance(p1, p2);
        if (d <= 0) {
            d = 1;
        }
        this.twodistance = d;
    };
    TileLevel.prototype.vectorFromTouch = function (touch) {
        return {
            x: touch.clientX,
            y: touch.clientY
        };
    };
    TileLevel.prototype.vectorFindCenter = function (xy1, xy2) {
        var xy = this.vectorAdd(xy1, xy2);
        return this.vectorScale(xy, 0.5);
    };
    ;
    TileLevel.prototype.vectorAdd = function (xy1, xy2) {
        return {
            x: xy1.x + xy2.x,
            y: xy1.y + xy2.y
        };
    };
    ;
    TileLevel.prototype.vectorScale = function (xy, coef) {
        return {
            x: xy.x * coef,
            y: xy.y * coef
        };
    };
    ;
    TileLevel.prototype.vectorDistance = function (xy1, xy2) {
        var xy = this.vectorSubstract(xy1, xy2);
        var n = this.vectorNorm(xy);
        return n;
    };
    TileLevel.prototype.vectorNorm = function (xy) {
        return Math.sqrt(this.vectorNormSquared(xy));
    };
    TileLevel.prototype.vectorSubstract = function (xy1, xy2) {
        return {
            x: xy1.x - xy2.x,
            y: xy1.y - xy2.y
        };
    };
    TileLevel.prototype.vectorNormSquared = function (xy) {
        return xy.x * xy.x + xy.y * xy.y;
    };
    TileLevel.prototype.startSlideCenter = function (x, y, z, w, h, action) {
        var dx = (z * this.viewWidth / this.tapSize - w) / 2;
        var dy = (z * this.viewHeight / this.tapSize - h) / 2;
        this.startSlideTo((dx - x) * this.tapSize, (dy - y) * this.tapSize, z, action);
    };
    TileLevel.prototype.startSlideTo = function (x, y, z, action) {
        this.startStepSlideTo(20, x, y, z, action);
    };
    TileLevel.prototype.startStepSlideTo = function (s, x, y, z, action) {
        clearTimeout(this.slidingID);
        var stepCount = s;
        //let dx: number = (x - this.translateX) / stepCount;
        //let dy: number = (y - this.translateY) / stepCount;
        //let dz: number = (z - this.translateZ) / stepCount;
        var xyz = [];
        for (var i = 0; i < stepCount; i++) {
            /*xyz.push({
                x: this.translateX + dx * i,
                y: this.translateY + dy * i,
                z: this.translateZ + dz * i
            });*/
            xyz.push({
                x: this.translateX + (x - this.translateX) * Math.cos((Math.PI / 2) / (1 + i)),
                y: this.translateY + (y - this.translateY) * Math.cos((Math.PI / 2) / (1 + i)),
                z: this.translateZ + (z - this.translateZ) * Math.cos((Math.PI / 2) / (1 + i))
            });
            //console.log(i,xyz[xyz.length-1]);
        }
        xyz.push({
            x: x,
            y: y,
            z: z
        });
        this.slidingLockTo = Math.random();
        this.stepSlideTo(this.slidingLockTo, xyz, action);
        //console.log('start',new Date());
    };
    TileLevel.prototype.stepSlideTo = function (key, xyz, action) {
        var n = xyz.shift();
        if (n) {
            if (key == this.slidingLockTo) {
                this.translateX = n.x;
                this.translateY = n.y;
                this.translateZ = n.z;
                this.applyZoomPosition();
                var main_1 = this;
                this.slidingID = setTimeout(function () {
                    main_1.stepSlideTo(key, xyz, action);
                }, 30);
            }
            else {
                //console.log('cancel slide');
            }
        }
        else {
            if (action) {
                action();
            }
            this.adjustContentPosition();
            this.allTilesOK = true;
            this.queueTiles();
            //console.log('done',new Date());
        }
    };
    TileLevel.prototype.queueTiles = function () {
        this.clearUselessDetails();
        this.tileFromModel();
    };
    TileLevel.prototype.clearUselessDetails = function () {
        if (this.model) {
            for (var k = 0; k < this.model.length; k++) {
                var group = this.model[k].g;
                this.clearUselessGroups(group, this.model[k]);
            }
        }
    };
    TileLevel.prototype.clearUselessGroups = function (group, layer) {
        var x = -this.translateX;
        var y = -this.translateY;
        var w = this.svg.clientWidth * this.translateZ;
        var h = this.svg.clientHeight * this.translateZ;
        var cX = 0;
        var cY = 0;
        if (this.viewWidth * this.translateZ > this.innerWidth) {
            cX = (this.viewWidth * this.translateZ - this.innerWidth) / 2;
            x = x - cX;
        }
        if (this.viewHeight * this.translateZ > this.innerHeight) {
            cY = (this.viewHeight * this.translateZ - this.innerHeight) / 2;
            y = y - cY;
        }
        if (this.isLayerOverlay(layer)) {
            //if (kind == layerModeOverlay) {
            x = 0;
            y = 0;
        }
        else {
            if (this.isLayerStickLeft(layer)) {
                //if (kind == layerModeLockX) {
                x = 0;
            }
            else {
                if (this.isLayerStickTop(layer)) {
                    //if (kind == layerModeLockY) {
                    y = 0;
                }
                else {
                    if (this.isLayerStickRight(layer)) {
                        //if (kind == layerModeStickRight) {
                        x = 0;
                    }
                    else {
                        if (this.isLayerStickBottom(layer)) {
                            //if (kind == layerModeStickBottom) {
                            y = 0;
                        }
                    }
                }
            }
        }
        if (group)
            this.msEdgeHook(group);
        //console.log('this.translateZ',this.translateZ);
        for (var i = 0; i < group.children.length; i++) {
            var child = group.children[i];
            //console.log('check',child.minZoom,child.maxZoom,child);
            if (this.outOfWatch(child, x, y, w, h) || child.minZoom > this.translateZ || child.maxZoom <= this.translateZ) {
                group.removeChild(child);
                i--;
            }
            else {
                if (child.localName == 'g') {
                    this.clearUselessGroups(child, layer);
                }
            }
        }
    };
    TileLevel.prototype.msEdgeHook = function (g) {
        if (g.childNodes && (!(g.children))) {
            g.children = g.childNodes;
        }
    };
    TileLevel.prototype.outOfWatch = function (g, x, y, w, h) {
        var watchX = g.watchX;
        var watchY = g.watchY;
        var watchW = g.watchW;
        var watchH = g.watchH;
        return !(this.collision(watchX, watchY, watchW, watchH, x, y, w, h));
    };
    TileLevel.prototype.collision = function (x1, y1, w1, h1, x2, y2, w2, h2) {
        if (this.collision2(x1, w1, x2, w2) && this.collision2(y1, h1, y2, h2)) {
            return true;
        }
        else {
            return false;
        }
    };
    TileLevel.prototype.collision2 = function (x, w, left, width) {
        if (x + w <= left || x >= left + width) {
            return false;
        }
        else {
            return true;
        }
    };
    TileLevel.prototype.tileFromModel = function () {
        //console.log('tileFromModel',this.model);
        if (this.model) {
            for (var k = 0; k < this.model.length; k++) {
                var svggroup = this.model[k].g;
                var arr = this.model[k].anchors;
                for (var i = 0; i < arr.length; i++) {
                    var a = arr[i];
                    this.addGroupTile(svggroup, a, this.model[k]);
                }
            }
        }
        this.allTilesOK = true;
    };
    TileLevel.prototype.addGroupTile = function (parentSVGElement, anchor, layer) {
        //console.log('addGroupTile',this.translateZ,definitions);
        var x = -this.translateX;
        var y = -this.translateY;
        var w = this.svg.clientWidth * this.translateZ;
        var h = this.svg.clientHeight * this.translateZ;
        var cX = 0;
        var cY = 0;
        if (this.viewWidth * this.translateZ > this.innerWidth) {
            cX = (this.viewWidth * this.translateZ - this.innerWidth) / 2;
            x = x - cX;
        }
        if (this.viewHeight * this.translateZ > this.innerHeight) {
            cY = (this.viewHeight * this.translateZ - this.innerHeight) / 2;
            y = y - cY;
        }
        if (this.isLayerOverlay(layer)) {
            //if (layerKind == layerModeOverlay) {
            x = 0;
            y = 0;
        }
        else {
            if (this.isLayerStickLeft(layer)) {
                //if (layerKind == layerModeLockX) {
                x = 0;
            }
            else {
                if (this.isLayerStickTop(layer)) {
                    //if (layerKind == layerModeLockY) {
                    y = 0;
                }
                else {
                    if (this.isLayerStickRight(layer)) {
                        //if (layerKind == layerModeStickRight) {
                        x = 0;
                    }
                    else {
                        if (this.isLayerStickBottom(layer)) {
                            //if (layerKind == layerModeStickBottom) {
                            y = 0;
                        }
                    }
                }
            }
        }
        //if (definitions.z[0] <= this.translateZ && definitions.z[1] > this.translateZ) {
        if (anchor.showZoom <= this.translateZ && anchor.hideZoom > this.translateZ) {
            //console.log(this.collision(definitions.x * this.tapSize, definitions.y * this.tapSize, definitions.w * this.tapSize, definitions.h * this.tapSize, x, y, w, h));
            if (this.collision(anchor.xx * this.tapSize, anchor.yy * this.tapSize, anchor.ww * this.tapSize, anchor.hh * this.tapSize //
            , x, y, w, h)) {
                var gid = anchor.id ? anchor.id : '';
                //console.log('el',gid,tileGroup);
                var xg = this.childExists(parentSVGElement, gid);
                //console.log('exists',xg);
                if (xg) {
                    //if (isTileGroup(tileGroup)) {
                    //console.log('anchor',anchor);
                    for (var n = 0; n < anchor.content.length; n++) {
                        var d = anchor.content[n];
                        //if (d.draw == 'group') {
                        if (this.isTileGroup(d)) {
                            //console.log(n, d);
                            this.addElement(xg, d, layer);
                        }
                    }
                    //}
                }
                else {
                    var g = document.createElementNS(this.svgns, 'g');
                    //console.log(parentGroup,g);
                    g.id = gid; //tileGroup.id;
                    //let gg = g as any;
                    g.watchX = anchor.xx * this.tapSize;
                    g.watchY = anchor.yy * this.tapSize;
                    g.watchW = anchor.ww * this.tapSize;
                    g.watchH = anchor.hh * this.tapSize;
                    parentSVGElement.appendChild(g);
                    g.minZoom = anchor.showZoom;
                    g.maxZoom = anchor.hideZoom;
                    //if (isTileGroup(tileGroup)) {
                    for (var n = 0; n < anchor.content.length; n++) {
                        var d = anchor.content[n];
                        this.addElement(g, d, layer);
                    }
                    //}
                }
            }
        }
    };
    TileLevel.prototype.childExists = function (group, id) {
        //console.log('childExists',group, id);
        //console.dir(group);
        if (id) {
            if (group)
                this.msEdgeHook(group);
            for (var i = 0; i < group.children.length; i++) {
                var child = group.children[i];
                if (child.id == id) {
                    return child;
                }
            }
        }
        return null;
    };
    TileLevel.prototype.addElement = function (g, d, layer) {
        var element = null;
        //if (d.draw == 'rectangle') {
        if (this.isTileRectangle(d)) {
            //let r=d as TileRectangle;
            element = this.tileRectangle(g, d.x * this.tapSize, d.y * this.tapSize, d.w * this.tapSize, d.h * this.tapSize, (d.rx ? d.rx : 0) * this.tapSize, (d.ry ? d.ry : 0) * this.tapSize, (d.css ? d.css : ''));
        }
        //if (d.draw == 'text') {
        if (this.isTileText(d)) {
            element = this.tileText(g, d.x * this.tapSize, d.y * this.tapSize, d.text, d.css ? d.css : '');
        }
        //if (d.draw == 'path') {
        if (this.isTilePath(d)) {
            element = this.tilePath(g, (d.x ? d.x : 0) * this.tapSize, (d.y ? d.y : 0) * this.tapSize, (d.scale ? d.scale : 0), d.points, d.css ? d.css : '');
        }
        if (this.isTilePolygon(d)) {
            element = this.tilePolygon(g, (d.x ? d.x : 0) * this.tapSize, (d.y ? d.y : 0) * this.tapSize, d.scale, d.dots, d.css);
        }
        //if (d.draw == 'line') {
        if (this.isTileLine(d)) {
            element = this.tileLine(g, d.x1 * this.tapSize, d.y1 * this.tapSize, d.x2 * this.tapSize, d.y2 * this.tapSize, d.css);
        }
        //if (d.draw == 'group') {
        if (this.isTileGroup(d)) {
            this.addGroupTile(g, d, layer);
        }
        if (element) {
            //console.log('add',d.showZoom,d.hideZoom,d,element);
            //element.minZoom = d.showZoom;
            //element.maxZoom = d.hideZoom;
            //console.log('addElement',this.translateZ,d,element);
            if (d.action) {
                //let e:any = element as any;
                //let e:TileSVGElement = element;
                element.onClickFunction = d.action;
                var me_1 = this;
                var click = function () {
                    if (me_1.clicked) {
                        if (element) {
                            //console.log('click',element);
                            if (element.onClickFunction) {
                                var xx = element.getBoundingClientRect().left - me_1.svg.getBoundingClientRect().left;
                                var yy = element.getBoundingClientRect().top - me_1.svg.getBoundingClientRect().top;
                                element.onClickFunction(me_1.translateZ * (me_1.clickX - xx) / me_1.tapSize, me_1.translateZ * (me_1.clickY - yy) / me_1.tapSize);
                            }
                        }
                    }
                };
                element.onclick = click;
                element.ontouchend = click;
            }
        }
    };
    TileLevel.prototype.tilePolygon = function (g, x, y, z, dots, cssClass) {
        var polygon = document.createElementNS(this.svgns, 'polygon');
        var points = '';
        var dlmtr = '';
        for (var i = 0; i < dots.length; i = i + 2) {
            points = points + dlmtr + dots[i] * this.tapSize + ',' + dots[i + 1] * this.tapSize;
            dlmtr = ', ';
        }
        polygon.setAttributeNS(null, 'points', points);
        var t = "";
        if ((x) || (y)) {
            t = 'translate(' + x + ',' + y + ')';
        }
        if (z) {
            t = t + ' scale(' + z + ')';
        }
        if (t.length > 0) {
            polygon.setAttributeNS(null, 'transform', t);
        }
        if (cssClass) {
            polygon.classList.add(cssClass);
        }
        g.appendChild(polygon);
        return polygon;
    };
    TileLevel.prototype.tilePath = function (g, x, y, z, data, cssClass) {
        var path = document.createElementNS(this.svgns, 'path');
        path.setAttributeNS(null, 'd', data);
        var t = "";
        if ((x) || (y)) {
            t = 'translate(' + x + ',' + y + ')';
        }
        if (z) {
            t = t + ' scale(' + z + ')';
        }
        if (t.length > 0) {
            path.setAttributeNS(null, 'transform', t);
        }
        if (cssClass) {
            path.classList.add(cssClass);
        }
        g.appendChild(path);
        return path;
    };
    TileLevel.prototype.tileRectangle = function (g, x, y, w, h, rx, ry, cssClass) {
        var rect = document.createElementNS(this.svgns, 'rect');
        rect.setAttributeNS(null, 'x', '' + x);
        rect.setAttributeNS(null, 'y', '' + y);
        rect.setAttributeNS(null, 'height', '' + h);
        rect.setAttributeNS(null, 'width', '' + w);
        if (rx) {
            rect.setAttributeNS(null, 'rx', '' + rx);
        }
        if (ry) {
            rect.setAttributeNS(null, 'ry', '' + ry);
        }
        if (cssClass) {
            rect.classList.add(cssClass);
        }
        g.appendChild(rect);
        //console.log(cssClass,rect);
        return rect;
    };
    TileLevel.prototype.tileLine = function (g, x1, y1, x2, y2, cssClass) {
        var line = document.createElementNS(this.svgns, 'line');
        line.setAttributeNS(null, 'x1', '' + x1);
        line.setAttributeNS(null, 'y1', '' + y1);
        line.setAttributeNS(null, 'x2', '' + x2);
        line.setAttributeNS(null, 'y2', '' + y2);
        if (cssClass) {
            line.classList.add(cssClass);
        }
        g.appendChild(line);
        return line;
    };
    TileLevel.prototype.tileText = function (g, x, y, html, cssClass) {
        var txt = document.createElementNS(this.svgns, 'text');
        txt.setAttributeNS(null, 'x', '' + x);
        txt.setAttributeNS(null, 'y', '' + y);
        if (cssClass) {
            txt.setAttributeNS(null, 'class', cssClass);
        }
        txt.innerHTML = html;
        g.appendChild(txt);
        //console.log('tileText',g,txt);
        return txt;
    };
    TileLevel.prototype.clearAllDetails = function () {
        if (this.model) {
            for (var i = 0; i < this.model.length; i++) {
                this.clearGroupDetails(this.model[i].g);
            }
        }
    };
    TileLevel.prototype.clearGroupDetails = function (group) {
        if (group)
            this.msEdgeHook(group);
        //console.log(group);
        while (group.children.length) {
            group.removeChild(group.children[0]);
        }
    };
    TileLevel.prototype.autoID = function (definition) {
        if (definition) {
            if (definition.length) {
                for (var i = 0; i < definition.length; i++) {
                    if (!(definition[i].id)) {
                        //definition[i].id = 'id' + Math.floor(Math.random() * 1000000000);
                        definition[i].id = this.rid();
                        //console.log('/',definition[i]);
                    }
                    //let tt:TileGroup|TileDefinition=definition[i];
                    //this.autoID(tt.sub);
                    if (this.isTileGroup(definition[i])) {
                        var group = definition[i];
                        this.autoID(group.content);
                    }
                    //this.autoID(definition[i].sub);
                }
            }
        }
    };
    TileLevel.prototype.setModel = function (layers) {
        for (var i = 0; i < layers.length; i++) {
            this.autoID(layers[i].anchors);
        }
        //console.log(layers);
        this.model = layers;
        this.resetModel();
    };
    TileLevel.prototype.resetModel = function () {
        for (var i = 0; i < this.model.length; i++) {
            this.autoID(this.model[i].anchors);
        }
        this.clearAllDetails();
        this.applyZoomPosition();
        this.adjustContentPosition();
        this.slideToContentPosition();
        this.allTilesOK = false;
    };
    TileLevel.prototype.resetAnchor = function (anchor, svgGroup) {
        var gid = anchor.id ? anchor.id : '';
        var xg = this.childExists(svgGroup, gid);
        if (xg) {
            svgGroup.removeChild(xg);
        }
    };
    TileLevel.prototype.redrawAnchor = function (anchor) {
        //this.autoID([anchor]);
        if (anchor.id) {
            for (var i = 0; i < this.model.length; i++) {
                var layer = this.model[i];
                var svgEl = layer.g;
                if (this.removeFromTree(anchor, svgEl, layer)) {
                    return true;
                }
            }
        }
        return false;
    };
    TileLevel.prototype.removeFromTree = function (anchor, parentSVG, layer) {
        if (parentSVG)
            this.msEdgeHook(parentSVG);
        if (anchor.id) {
            for (var i = 0; i < parentSVG.children.length; i++) {
                var child = parentSVG.children[i];
                if (child.id == anchor.id) {
                    parentSVG.removeChild(child);
                    this.addGroupTile(parentSVG, anchor, layer);
                    return true;
                }
                else {
                    if (child.localName == 'g') {
                        if (this.removeFromTree(anchor, child, layer)) {
                            return true;
                        }
                    }
                }
            }
        }
        return false;
    };
    /*
    startLoop() {
        //console.log('startLoop', this.model);
        let last: number = new Date().getTime();
        let me: TileLevel = this;
        let step: () => void = function () {
            let now = new Date().getTime();
            if (last + 33 < now) {
                if (!(me.valid)) {
                    me.queueTiles();
                }
                last = new Date().getTime();
            }
            window.requestAnimationFrame(step);
        };
        step();
    }*/
    TileLevel.prototype.startLoop = function () {
        this.lastTickTime = new Date().getTime();
        this.tick();
    };
    TileLevel.prototype.tick = function () {
        var now = new Date().getTime();
        if (this.lastTickTime + 33 < now) {
            if (!(this.allTilesOK)) {
                this.queueTiles();
            }
            this.lastTickTime = new Date().getTime();
        }
        window.requestAnimationFrame(this.tick.bind(this));
    };
    return TileLevel;
}());
var DataViewStream = /** @class */ (function () {
    function DataViewStream(dv) {
        this.position = 0;
        this.buffer = dv;
    }
    DataViewStream.prototype.readUint8 = function () {
        var n = this.buffer.getUint8(this.position);
        this.position++;
        return n;
    };
    DataViewStream.prototype.readUint16 = function () {
        var v = this.buffer.getUint16(this.position);
        this.position = this.position + 2;
        return v;
    };
    DataViewStream.prototype.readVarInt = function () {
        var v = 0;
        var i = 0;
        var b;
        while (i < 4) {
            b = this.readUint8();
            if (b & 0x80) {
                v = v + (b & 0x7f);
                v = v << 7;
            }
            else {
                return v + b;
            }
            i++;
        }
        throw new Error('readVarInt ' + i);
    };
    DataViewStream.prototype.readBytes = function (length) {
        var bytes = [];
        for (var i = 0; i < length; i++) {
            bytes.push(this.readUint8());
        }
        return bytes;
    };
    /*pos(): string {
        return '0x' + (this.buffer.byteOffset + this.position).toString(16);
    }*/
    DataViewStream.prototype.offset = function () {
        return this.buffer.byteOffset + this.position;
    };
    DataViewStream.prototype.end = function () {
        return this.position == this.buffer.byteLength;
    };
    return DataViewStream;
}());
var MIDIFileHeader = /** @class */ (function () {
    function MIDIFileHeader(buffer) {
        this.HEADER_LENGTH = 14;
        //ticksPerBeat: number;
        //ticksPerFrame: number;
        this.tempoBPM = 120;
        this.meterCount = 4;
        this.meterDivision = 4;
        this.keyFlatSharp = 0;
        this.keyMajMin = 0;
        this.lastNonZeroQuarter = 0;
        this.datas = new DataView(buffer, 0, this.HEADER_LENGTH);
        this.format = this.datas.getUint16(8);
        this.trackCount = this.datas.getUint16(10);
        //this.ticksPerBeat = this.datas.getUint16(12);
        //this.ticksPerFrame = this.datas.getUint16(12);
    }
    MIDIFileHeader.prototype.getTickResolution = function (tempo) {
        //console.log('getTickResolution', tempo);
        if (tempo) {
            this.lastNonZeroQuarter = tempo;
        }
        else {
            if (this.lastNonZeroQuarter) {
                tempo = this.lastNonZeroQuarter;
            }
            else {
                tempo = 60000000 / this.tempoBPM;
            }
        }
        // Frames per seconds
        if (this.datas.getUint16(12) & 0x8000) {
            var r = 1000000 / (this.getSMPTEFrames() * this.getTicksPerFrame());
            // Ticks per beat
            //console.log('per frame', r);
            return r;
        }
        else {
            // Default MIDI tempo is 120bpm, 500ms per beat
            tempo = tempo || 500000;
            var r = tempo / this.getTicksPerBeat();
            //console.log('per beat', r);
            return r;
        }
    };
    /*getTimeDivision(): number {
        if (this.datas.getUint16(12) & 0x8000) {
            return this.FRAMES_PER_SECONDS;
        }
        return this.TICKS_PER_BEAT;
    }*/
    MIDIFileHeader.prototype.getTicksPerBeat = function () {
        var divisionWord = this.datas.getUint16(12);
        return divisionWord;
    };
    MIDIFileHeader.prototype.getTicksPerFrame = function () {
        var divisionWord = this.datas.getUint16(12);
        return divisionWord & 0x00ff;
    };
    MIDIFileHeader.prototype.getSMPTEFrames = function () {
        var divisionWord = this.datas.getUint16(12);
        var smpteFrames;
        smpteFrames = divisionWord & 0x7f00;
        if (smpteFrames == 29) {
            return 29.97;
        }
        else {
            return smpteFrames;
        }
    };
    return MIDIFileHeader;
}());
var MIDIFileTrack = /** @class */ (function () {
    function MIDIFileTrack(buffer, start) {
        this.HDR_LENGTH = 8;
        this.chords = [];
        this.datas = new DataView(buffer, start, this.HDR_LENGTH);
        this.trackLength = this.datas.getUint32(4);
        /*console.log(String.fromCharCode(this.datas.getUint8(0)));
        console.log(String.fromCharCode(this.datas.getUint8(1)));
        console.log(String.fromCharCode(this.datas.getUint8(2)));
        console.log(String.fromCharCode(this.datas.getUint8(3)));
        console.log(this.trackLength);*/
        this.datas = new DataView(buffer, start, this.HDR_LENGTH + this.trackLength);
        this.trackContent = new DataView(this.datas.buffer, this.datas.byteOffset + this.HDR_LENGTH, this.datas.byteLength - this.HDR_LENGTH);
        this.events = [];
    }
    return MIDIFileTrack;
}());
var MidiParser = /** @class */ (function () {
    function MidiParser(arrayBuffer) {
        this.EVENT_META = 0xff;
        this.EVENT_SYSEX = 0xf0;
        this.EVENT_DIVSYSEX = 0xf7;
        this.EVENT_MIDI = 0x8;
        // Meta event types
        this.EVENT_META_SEQUENCE_NUMBER = 0x00;
        this.EVENT_META_TEXT = 0x01;
        this.EVENT_META_COPYRIGHT_NOTICE = 0x02;
        this.EVENT_META_TRACK_NAME = 0x03;
        this.EVENT_META_INSTRUMENT_NAME = 0x04;
        this.EVENT_META_LYRICS = 0x05;
        this.EVENT_META_MARKER = 0x06;
        this.EVENT_META_CUE_POINT = 0x07;
        this.EVENT_META_MIDI_CHANNEL_PREFIX = 0x20;
        this.EVENT_META_END_OF_TRACK = 0x2f;
        this.EVENT_META_SET_TEMPO = 0x51;
        this.EVENT_META_SMTPE_OFFSET = 0x54;
        this.EVENT_META_TIME_SIGNATURE = 0x58;
        this.EVENT_META_KEY_SIGNATURE = 0x59;
        this.EVENT_META_SEQUENCER_SPECIFIC = 0x7f;
        // MIDI event types
        this.EVENT_MIDI_NOTE_OFF = 0x8;
        this.EVENT_MIDI_NOTE_ON = 0x9;
        this.EVENT_MIDI_NOTE_AFTERTOUCH = 0xa;
        this.EVENT_MIDI_CONTROLLER = 0xb;
        this.EVENT_MIDI_PROGRAM_CHANGE = 0xc;
        this.EVENT_MIDI_CHANNEL_AFTERTOUCH = 0xd;
        this.EVENT_MIDI_PITCH_BEND = 0xe;
        // MIDI event sizes
        //MIDI_1PARAM_EVENTS: number[];
        //MIDI_2PARAMS_EVENTS: number[];
        this.midiEventType = 0;
        this.midiEventChannel = 0;
        this.midiEventParam1 = 0;
        /*this.MIDI_1PARAM_EVENTS = [
            this.EVENT_MIDI_PROGRAM_CHANGE,
            this.EVENT_MIDI_CHANNEL_AFTERTOUCH,
        ];
        this.MIDI_2PARAMS_EVENTS = [
            this.EVENT_MIDI_NOTE_OFF,
            this.EVENT_MIDI_NOTE_ON,
            this.EVENT_MIDI_NOTE_AFTERTOUCH,
            this.EVENT_MIDI_CONTROLLER,
            this.EVENT_MIDI_PITCH_BEND,
        ];*/
        this.header = new MIDIFileHeader(arrayBuffer);
        this.parseTracks(arrayBuffer);
    }
    MidiParser.prototype.parseTracks = function (arrayBuffer) {
        var curIndex = this.header.HEADER_LENGTH;
        var trackCount = this.header.trackCount;
        this.tracks = [];
        for (var i = 0; i < trackCount; i++) {
            var track = new MIDIFileTrack(arrayBuffer, curIndex);
            this.tracks.push(track);
            // Updating index to the track end
            curIndex = curIndex + track.trackLength + 8;
        }
        for (var i = 0; i < this.tracks.length; i++) {
            this.parseEvents(this.tracks[i]);
        }
        this.parseNotes();
        this.simplify();
    };
    MidiParser.prototype.toText = function (arr) {
        var r = '';
        for (var i = 0; i < arr.length; i++) {
            r = r + String.fromCharCode(arr[i]);
        }
        return r;
    };
    MidiParser.prototype.findChordBefore = function (when, track, channel) {
        for (var i = 0; i < track.chords.length; i++) {
            var chord = track.chords[track.chords.length - i - 1];
            if (chord.when < when && chord.channel == channel) {
                return chord;
            }
        }
        return null;
    };
    MidiParser.prototype.findOpenedNoteBefore = function (firstPitch, when, track, channel) {
        var before = when;
        var chord = this.findChordBefore(before, track, channel);
        while (chord) {
            for (var i = 0; i < chord.notes.length; i++) {
                var note = chord.notes[i];
                if (!(note.closed)) {
                    if (firstPitch == note.points[0].pitch) {
                        return { chord: chord, note: note };
                    }
                }
            }
            before = chord.when;
            chord = this.findChordBefore(before, track, channel);
        }
        //console.log('no',first,'before',when,'at',trackNo);
        return null;
    };
    MidiParser.prototype.takeChord = function (when, track, channel) {
        for (var i = 0; i < track.chords.length; i++) {
            if (track.chords[i].when == when && track.chords[i].channel == channel) {
                return track.chords[i];
            }
        }
        var ch = {
            when: when,
            channel: channel,
            notes: []
        };
        track.chords.push(ch);
        return ch;
    };
    MidiParser.prototype.takeOpenedNote = function (first, when, track, channel) {
        var chord = this.takeChord(when, track, channel);
        for (var i = 0; i < chord.notes.length; i++) {
            if (!(chord.notes[i].closed)) {
                if (chord.notes[i].points[0].pitch == first) {
                    return chord.notes[i];
                }
            }
        }
        var pi = { closed: false, points: [] };
        pi.points.push({ pointDuration: -1, pitch: first });
        chord.notes.push(pi);
        return pi;
    };
    MidiParser.prototype.distanceToPoint = function (line, point) {
        var m = (line.p2.y - line.p1.y) / (line.p2.x - line.p1.x);
        var b = line.p1.y - (m * line.p1.x);
        var d = [];
        d.push(Math.abs(point.y - (m * point.x) - b) / Math.sqrt(Math.pow(m, 2) + 1));
        d.push(Math.sqrt(Math.pow((point.x - line.p1.x), 2) + Math.pow((point.y - line.p1.y), 2)));
        d.push(Math.sqrt(Math.pow((point.x - line.p2.x), 2) + Math.pow((point.y - line.p2.y), 2)));
        d.sort(function (a, b) {
            return (a - b);
        });
        return d[0];
    };
    ;
    MidiParser.prototype.douglasPeucker = function (points, tolerance) {
        if (points.length <= 2) {
            return [points[0]];
        }
        var returnPoints = [];
        var line = { p1: points[0], p2: points[points.length - 1] };
        var maxDistance = 0;
        var maxDistanceIndex = 0;
        var p;
        for (var i = 1; i <= points.length - 2; i++) {
            var distance = this.distanceToPoint(line, points[i]);
            if (distance > maxDistance) {
                maxDistance = distance;
                maxDistanceIndex = i;
            }
        }
        if (maxDistance >= tolerance) {
            p = points[maxDistanceIndex];
            this.distanceToPoint(line, p);
            returnPoints = returnPoints.concat(this.douglasPeucker(points.slice(0, maxDistanceIndex + 1), tolerance));
            returnPoints = returnPoints.concat(this.douglasPeucker(points.slice(maxDistanceIndex, points.length), tolerance));
        }
        else {
            p = points[maxDistanceIndex];
            this.distanceToPoint(line, p);
            returnPoints = [points[0]];
        }
        return returnPoints;
    };
    ;
    MidiParser.prototype.simplifyPath = function (points, tolerance) {
        var arr = this.douglasPeucker(points, tolerance);
        arr.push(points[points.length - 1]);
        return arr;
    };
    MidiParser.prototype.simplify = function () {
        for (var t = 0; t < this.tracks.length; t++) {
            var track = this.tracks[t];
            for (var ch = 0; ch < track.chords.length; ch++) {
                var chord = track.chords[ch];
                for (var n = 0; n < chord.notes.length; n++) {
                    var note = chord.notes[n];
                    if (note.points.length > 5) {
                        var xx = 0;
                        var pnts = [];
                        for (var p = 0; p < note.points.length; p++) {
                            note.points[p].pointDuration = Math.max(note.points[p].pointDuration, 0);
                            pnts.push({ x: xx, y: note.points[p].pitch });
                            xx = xx + note.points[p].pointDuration;
                        }
                        pnts.push({ x: xx, y: note.points[note.points.length - 1].pitch });
                        var lessPoints = this.simplifyPath(pnts, 1.5);
                        //console.log(note);
                        //console.log(pnts);
                        //console.log(lessPoints);
                        note.points = [];
                        for (var p = 0; p < lessPoints.length - 1; p++) {
                            var xypoint = lessPoints[p];
                            var xyduration = lessPoints[p + 1].x - xypoint.x;
                            note.points.push({ pointDuration: xyduration, pitch: xypoint.y });
                        }
                    }
                    else {
                        if (note.points.length == 1) {
                            if (note.points[0].pointDuration > 4321) {
                                //console.log(note.points[0].pointDuration,note);
                                note.points[0].pointDuration = 1234;
                            }
                        }
                    }
                }
            }
        }
    };
    MidiParser.prototype.parseNotes = function () {
        for (var t = 0; t < this.tracks.length; t++) {
            var track = this.tracks[t];
            var playTimeTicks = 0;
            var tickResolution = this.header.getTickResolution(0);
            for (var e = 0; e < track.events.length; e++) {
                var evnt = track.events[e];
                var curDelta = 0;
                if (evnt.delta)
                    curDelta = evnt.delta;
                //playTimeTicks = playTimeTicks + curDelta;
                playTimeTicks = playTimeTicks + curDelta * tickResolution / 1000;
                //console.log(playTimeTicks,curDelta,curDelta * tickResolution / 1000);
                if (evnt.basetype === this.EVENT_META) {
                    // tempo change events
                    if (evnt.subtype === this.EVENT_META_SET_TEMPO) {
                        if (evnt.tempo)
                            tickResolution = this.header.getTickResolution(evnt.tempo);
                    }
                }
                evnt.playTime = playTimeTicks;
                //console.log(tickResolution, evnt.playTime, evnt);
            }
            //console.log(t, playTime);
            for (var e = 0; e < track.events.length; e++) {
                var evnt = track.events[e];
                //console.log(t, evnt);
                if (evnt.basetype == this.EVENT_MIDI) {
                    evnt.param1 = evnt.param1 ? evnt.param1 : 0;
                    /*if (evnt.midiChannel == 9) {
                        if (evnt.param1 >= 35 && evnt.param1 <= 81) {
                            if (evnt.subtype == this.EVENT_MIDI_NOTE_ON) {
                                //this.startDrum(evnt);
                            } else {
                                if (evnt.subtype == this.EVENT_MIDI_NOTE_OFF) {
                                    //this.closeDrum(evnt);
                                }
                            }
                        }
                    } else {*/
                    //console.log(evnt.subtype);
                    if (evnt.subtype == this.EVENT_MIDI_NOTE_ON) {
                        if (evnt.param1 >= 0 && evnt.param1 <= 127) {
                            //this.startNote(evnt);
                            //console.log(evnt);
                            var pitch = evnt.param1 ? evnt.param1 : 0;
                            var when = 0;
                            if (evnt.playTime)
                                when = evnt.playTime;
                            this.takeOpenedNote(pitch, when, track, evnt.midiChannel ? evnt.midiChannel : 0);
                        }
                    }
                    else {
                        if (evnt.subtype == this.EVENT_MIDI_NOTE_OFF) {
                            if (evnt.param1 >= 0 && evnt.param1 <= 127) {
                                //this.closeNote(evnt);
                                var pitch = evnt.param1 ? evnt.param1 : 0;
                                var when = 0;
                                if (evnt.playTime)
                                    when = evnt.playTime;
                                var chpi = this.findOpenedNoteBefore(pitch, when, track, evnt.midiChannel ? evnt.midiChannel : 0);
                                if (chpi) {
                                    var duration = 0;
                                    for (var i = 0; i < chpi.note.points.length - 1; i++) {
                                        duration = duration + chpi.note.points[i].pointDuration;
                                    }
                                    chpi.note.points[chpi.note.points.length - 1].pointDuration = when - chpi.chord.when - duration;
                                    chpi.note.closed = true;
                                }
                            }
                        }
                        else {
                            if (evnt.subtype == this.EVENT_MIDI_PROGRAM_CHANGE) {
                                if (evnt.param1 >= 0 && evnt.param1 <= 127) {
                                    //this.setProgram(evnt);
                                    //console.log('setProgram', evnt.param1,evnt.param2,evnt);
                                    track.program = evnt.param1 ? evnt.param1 : 0;
                                    //track.volume = evnt.param2 ? evnt.param2 : 0.001;
                                }
                            }
                            else {
                                if (evnt.subtype == this.EVENT_MIDI_PITCH_BEND) {
                                    //this.bendNote(evnt);
                                    var pitch = evnt.param1 ? evnt.param1 : 0;
                                    var slide = ((evnt.param2 ? evnt.param2 : 0) - 64) / 6;
                                    var when = evnt.playTime ? evnt.playTime : 0;
                                    var chord = this.findChordBefore(when, track, evnt.midiChannel ? evnt.midiChannel : 0);
                                    if (chord) {
                                        for (var i = 0; i < chord.notes.length; i++) {
                                            var note = chord.notes[i];
                                            if (!(note.closed)) {
                                                var duration = 0;
                                                for (var k = 0; k < note.points.length - 1; k++) {
                                                    duration = duration + note.points[k].pointDuration;
                                                }
                                                note.points[note.points.length - 1].pointDuration = when - chord.when - duration;
                                                //console.log('bend',t,note.points[note.points.length - 1].pointDuration, when, chord.when, duration);
                                                var firstpitch = note.points[0].pitch + slide;
                                                var point = {
                                                    pointDuration: -1,
                                                    pitch: firstpitch
                                                };
                                                note.points.push(point);
                                            }
                                        }
                                    }
                                }
                                else {
                                    if (evnt.subtype == this.EVENT_MIDI_CONTROLLER && evnt.param1 == 7) {
                                        //console.log(evnt);
                                        track.volume = evnt.param2 ? evnt.param2 / 127 : 0;
                                    }
                                    else {
                                        //
                                    }
                                }
                            }
                        }
                    }
                    //}
                }
                else {
                    //console.log((evnt.subtype?evnt.subtype:0).toString(16), evnt);
                    if (evnt.subtype == this.EVENT_META_TEXT) {
                        //console.log('EVENT_META_TEXT', this.eventText(evnt), evnt);
                    }
                    if (evnt.subtype == this.EVENT_META_COPYRIGHT_NOTICE) {
                        //console.log('EVENT_META_COPYRIGHT_NOTICE', this.eventText(evnt), evnt);
                    }
                    if (evnt.subtype == this.EVENT_META_TRACK_NAME) {
                        //console.log('EVENT_META_TRACK_NAME', this.eventText(evnt), evnt);
                        //this.setTitle(evnt);
                        //console.log(t,this.toText(evnt.data?evnt.data:[]), evnt);
                        track.title = this.toText(evnt.data ? evnt.data : []);
                    }
                    if (evnt.subtype == this.EVENT_META_INSTRUMENT_NAME) {
                        //console.log('EVENT_META_INSTRUMENT_NAME', this.eventText(evnt), evnt);
                        //console.log(t,this.toText(evnt.data?evnt.data:[]), evnt);
                        track.instrument = this.toText(evnt.data ? evnt.data : []);
                    }
                    if (evnt.subtype == this.EVENT_META_LYRICS) {
                        //console.log('EVENT_META_LYRICS', this.eventText(evnt), evnt);
                        //console.log(t,this.toText(evnt.data?evnt.data:[]), evnt);
                    }
                    if (evnt.subtype == this.EVENT_META_LYRICS) {
                        //console.log('EVENT_META_LYRICS', this.eventText(evnt), evnt);
                        //console.log(t,this.toText(evnt.data?evnt.data:[]), evnt);
                    }
                    if (evnt.subtype == this.EVENT_META_KEY_SIGNATURE) {
                        //console.log(t,'EVENT_META_KEY_SIGNATURE',evnt.key,evnt.scale);
                        var key = evnt.key ? evnt.key : 0;
                        if (key > 127)
                            key = key - 256;
                        this.header.keyFlatSharp = key; //-sharp+flat
                        this.header.keyMajMin = evnt.scale ? evnt.scale : 0; //0-maj, 1 min
                    }
                    if (evnt.subtype == this.EVENT_META_SET_TEMPO) {
                        //console.log(t,'EVENT_META_SET_TEMPO',evnt.tempoBPM);
                        this.header.tempoBPM = evnt.tempoBPM ? evnt.tempoBPM : 120;
                    }
                    if (evnt.subtype == this.EVENT_META_TIME_SIGNATURE) {
                        //console.log(t,'EVENT_META_TIME_SIGNATURE',evnt);
                        this.header.meterCount = evnt.param1 ? evnt.param1 : 4;
                        var dvsn = evnt.param2 ? evnt.param2 : 2;
                        if (dvsn == 1)
                            this.header.meterDivision = 2;
                        else if (dvsn == 2)
                            this.header.meterDivision = 4;
                        else if (dvsn == 3)
                            this.header.meterDivision = 8;
                        else if (dvsn == 4)
                            this.header.meterDivision = 16;
                        else if (dvsn == 5)
                            this.header.meterDivision = 32;
                        //console.log(t,'EVENT_META_TIME_SIGNATURE',this.header.meterCount,this.header.meterDivision,evnt);
                    }
                }
            }
        }
    };
    MidiParser.prototype.nextEvent = function (stream) {
        var index = stream.offset();
        var delta = stream.readVarInt();
        var eventTypeByte = stream.readUint8();
        var event = { offset: index, delta: delta, eventTypeByte: eventTypeByte };
        //track.events.push(event);
        if (0xf0 === (eventTypeByte & 0xf0)) {
            // Meta events
            if (eventTypeByte === this.EVENT_META) {
                event.basetype = this.EVENT_META;
                event.subtype = stream.readUint8();
                event.length = stream.readVarInt();
                switch (event.subtype) {
                    case this.EVENT_META_SEQUENCE_NUMBER:
                        event.msb = stream.readUint8();
                        event.lsb = stream.readUint8();
                        console.log('EVENT_META_SEQUENCE_NUMBER', event);
                        return event;
                    case this.EVENT_META_TEXT:
                    case this.EVENT_META_COPYRIGHT_NOTICE:
                    case this.EVENT_META_TRACK_NAME:
                    case this.EVENT_META_INSTRUMENT_NAME:
                    case this.EVENT_META_LYRICS:
                    case this.EVENT_META_MARKER:
                    case this.EVENT_META_CUE_POINT:
                        event.data = stream.readBytes(event.length);
                        event.text = this.toText(event.data ? event.data : []);
                        //console.log('txt',event);
                        return event;
                    case this.EVENT_META_MIDI_CHANNEL_PREFIX:
                        event.prefix = stream.readUint8();
                        //console.log('EVENT_META_MIDI_CHANNEL_PREFIX',event);
                        return event;
                    case this.EVENT_META_END_OF_TRACK:
                        //console.log('EVENT_META_END_OF_TRACK',event);
                        return event;
                    case this.EVENT_META_SET_TEMPO:
                        event.tempo = (stream.readUint8() << 16) + (stream.readUint8() << 8) + stream.readUint8();
                        event.tempoBPM = 60000000 / event.tempo;
                        //console.log('EVENT_META_SET_TEMPO',event);
                        return event;
                    case this.EVENT_META_SMTPE_OFFSET:
                        event.hour = stream.readUint8();
                        event.minutes = stream.readUint8();
                        event.seconds = stream.readUint8();
                        event.frames = stream.readUint8();
                        event.subframes = stream.readUint8();
                        //console.log('EVENT_META_SMTPE_OFFSET',event);
                        return event;
                    case this.EVENT_META_KEY_SIGNATURE:
                        event.key = stream.readUint8();
                        event.scale = stream.readUint8();
                        //console.log('EVENT_META_KEY_SIGNATURE',event);
                        return event;
                    case this.EVENT_META_TIME_SIGNATURE:
                        event.data = stream.readBytes(event.length);
                        event.param1 = event.data[0];
                        event.param2 = event.data[1];
                        event.param3 = event.data[2];
                        event.param4 = event.data[3];
                        //console.log('EVENT_META_TIME_SIGNATURE',event);
                        return event;
                    case this.EVENT_META_SEQUENCER_SPECIFIC:
                        event.data = stream.readBytes(event.length);
                        //console.log('EVENT_META_SEQUENCER_SPECIFIC',event);
                        return event;
                    default:
                        event.data = stream.readBytes(event.length);
                        //console.log('unknown meta',event);
                        return event;
                }
                // System events
            }
            else {
                if (eventTypeByte === this.EVENT_SYSEX || eventTypeByte === this.EVENT_DIVSYSEX) {
                    event.basetype = eventTypeByte;
                    event.length = stream.readVarInt();
                    event.data = stream.readBytes(event.length);
                    return event;
                    // Unknown event, assuming it's system like event
                }
                else {
                    event.basetype = eventTypeByte;
                    event.badsubtype = stream.readVarInt();
                    event.length = stream.readUint8();
                    event.data = stream.readBytes(event.length);
                    return event;
                }
            }
        }
        else {
            // running status
            if (0 === (eventTypeByte & 0x80)) {
                if (!this.midiEventType) {
                    throw new Error('no pre event' + stream.offset());
                }
                this.midiEventParam1 = eventTypeByte;
            }
            else {
                this.midiEventType = eventTypeByte >> 4;
                this.midiEventChannel = eventTypeByte & 0x0f;
                this.midiEventParam1 = stream.readUint8();
            }
            event.basetype = this.EVENT_MIDI;
            event.subtype = this.midiEventType;
            event.midiChannel = this.midiEventChannel;
            event.param1 = this.midiEventParam1;
            switch (this.midiEventType) {
                case this.EVENT_MIDI_NOTE_OFF:
                    event.param2 = stream.readUint8();
                    return event;
                case this.EVENT_MIDI_NOTE_ON:
                    event.param2 = stream.readUint8();
                    // If velocity is 0, it's a note off event in fact
                    if (!event.param2) {
                        event.subtype = this.EVENT_MIDI_NOTE_OFF;
                        event.param2 = 127; // Find a standard telling what to do here
                    }
                    return event;
                case this.EVENT_MIDI_NOTE_AFTERTOUCH:
                    event.param2 = stream.readUint8();
                    return event;
                case this.EVENT_MIDI_CONTROLLER:
                    event.param2 = stream.readUint8();
                    if (event.param1 == 7) {
                        //console.log(event);
                    }
                    return event;
                case this.EVENT_MIDI_PROGRAM_CHANGE:
                    //event.param2 = stream.readUint8();
                    return event;
                case this.EVENT_MIDI_CHANNEL_AFTERTOUCH:
                    return event;
                case this.EVENT_MIDI_PITCH_BEND:
                    event.param2 = stream.readUint8();
                    return event;
                default:
                    //console.log('unknown note',event);
                    return event;
            }
        }
        //console.log(stream.position,stream.buffer.byteLength);
    };
    MidiParser.prototype.parseEvents = function (track) {
        var stream = new DataViewStream(track.trackContent);
        this.midiEventType = 0;
        this.midiEventChannel = 0;
        this.midiEventParam1 = 0;
        while (!stream.end()) {
            var e = this.nextEvent(stream);
            track.events.push(e);
        }
    };
    MidiParser.prototype.takeMeasure = function (track, when, bpm, meter) {
        var q = 60 / bpm;
        var duration = 1000 * q * meter * 4;
        var idx = Math.floor(when / duration);
        for (var i = 0; i <= idx; i++) {
            if (track.measures.length < 1 + idx) {
                var m = {
                    duration: duration,
                    chords: []
                };
                track.measures.push(m);
            }
        }
        //console.log(when,track.measures.length,idx);
        return track.measures[idx];
    };
    MidiParser.prototype.takeDrumVoice = function (drum, drumVoices) {
        for (var i = 0; i < drumVoices.length; i++) {
            if (drumVoices[i].drum == drum) {
                return drumVoices[i];
            }
        }
        var voice = {
            chunks: [],
            source: {
                plugin: new ZvoogDrumSource(drum),
                parameters: []
            },
            effects: [],
            title: 'Drum ' + drum
        };
        var drvc = { voice: voice, drum: drum };
        drumVoices.push(drvc);
        return drvc;
    };
    MidiParser.prototype.meter44 = function () {
        return [
            { duration: 384 / 16, power: 3 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 2 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 }
        ];
    };
    MidiParser.prototype.meter24 = function () {
        return [
            { duration: 384 / 16, power: 3 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 }
        ];
    };
    MidiParser.prototype.meter54 = function () {
        return [
            { duration: 384 / 16, power: 3 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 }
        ];
    };
    MidiParser.prototype.meter34 = function () {
        return [
            { duration: 384 / 16, power: 3 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 1 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 },
            { duration: 384 / 16, power: 0 }
        ];
    };
    MidiParser.prototype.convert = function () {
        var midisong = this.dump();
        var gridPat = this.meter44();
        if (midisong.meter.count == 2 && midisong.meter.division == 4) {
            gridPat = this.meter24();
        }
        if (midisong.meter.count == 3 && midisong.meter.division == 4) {
            gridPat = this.meter34();
        }
        if (midisong.meter.count == 5 && midisong.meter.division == 4) {
            gridPat = this.meter54();
        }
        var schedule = {
            title: 'import from *.mid',
            description: 'none'
            //, duration: duration
            ,
            timeline: [],
            tracks: [],
            effects: [],
            macros: [],
            macroPosition: 2,
            masterPosition: 1,
            gridPattern: gridPat,
            keyPattern: [],
            horizontal: true,
            locked: false,
            selectedLayer: { level1: 0, level2: 0, level3: 0, level4: 0 }
        };
        schedule.effects.push({ parameters: [{ points: [{ skipMeasures: 0, skip384: 0, velocity: 119 }] }], plugin: new ZvoogFxGain() });
        for (var o = 0; o < 10; o++) {
            schedule.keyPattern.push(3);
            schedule.keyPattern.push(2);
            schedule.keyPattern.push(1);
            schedule.keyPattern.push(2);
            schedule.keyPattern.push(1);
            schedule.keyPattern.push(1);
            schedule.keyPattern.push(2);
            schedule.keyPattern.push(1);
            schedule.keyPattern.push(2);
            schedule.keyPattern.push(1);
            schedule.keyPattern.push(2);
            schedule.keyPattern.push(1);
        }
        for (var i = 0; i < midisong.tracks[0].measures.length; i++) {
            schedule.timeline.push({
                meter: {
                    count: midisong.meter.count,
                    division: midisong.meter.division
                },
                tempo: Math.round(midisong.bpm)
            });
        }
        for (var i = 0; i < midisong.tracks.length; i++) {
            var miditrack = midisong.tracks[i];
            var track = {
                voices: [],
                effects: [{ parameters: [{ points: [{ skipMeasures: 0, skip384: 0, velocity: 119 }] }], plugin: new ZvoogFxGain() }],
                title: 'track ' + i + ' ' + miditrack.title,
                strings: []
            };
            var voice = {
                chunks: [],
                source: {
                    plugin: new ZvoogInstrumentSource(miditrack.program),
                    parameters: []
                },
                effects: [{ parameters: [{ points: [{ skipMeasures: 0, skip384: 0, velocity: 119 }] }], plugin: new ZvoogFxGain() }],
                title: 'MIDI ' + miditrack.program
            };
            var time = 0;
            for (var m = 0; m < miditrack.measures.length; m++) {
                var measure = miditrack.measures[m];
                var chunk = {
                    /*meter: {
                        count: midisong.meter.count
                        , division: midisong.meter.division
                    }
                    , tempo: Math.round(midisong.bpm)
                    ,*/ chords: [],
                    title: 'start at ' + time,
                    clefHint: 0,
                    keyHint: 0
                };
                for (var c = 0; c < measure.chords.length; c++) {
                    var midichord = measure.chords[c];
                    var chordtime = midichord.when - time;
                    //console.log(midichord.when - time,time2Duration(chordtime/1000, midisong.bpm))
                    var zvoogchord = {
                        //when: chordtime
                        when: time2Duration(chordtime / 1000, midisong.bpm),
                        values: [],
                        title: '',
                        fretHint: [],
                        text: ''
                    };
                    if (midichord.channel != 9) {
                        for (var n = 0; n < midichord.notes.length; n++) {
                            //console.log(m,n,midichord.when);
                            var midinote = midichord.notes[n];
                            var zvoogkey = {
                                envelope: [],
                                stepHint: 0,
                                shiftHint: 0,
                                octaveHint: 0
                            };
                            zvoogchord.values.push(zvoogkey);
                            //if(midinote.points.length>5)console.log(midichord,midinote);
                            for (var p = 0; p < midinote.points.length; p++) {
                                var point = midinote.points[p];
                                //if(midinote.points.length>5)console.log(p,point.pitch,point.duration);
                                var zvoogPitch = {
                                    duration: time2Duration(point.duration / 1000, midisong.bpm),
                                    pitch: point.pitch
                                };
                                zvoogkey.envelope.push(zvoogPitch);
                            }
                        }
                    }
                    chunk.chords.push(zvoogchord);
                }
                voice.chunks.push(chunk);
                time = time + measure.duration;
            }
            track.voices.push(voice);
            //for(var t=0;t<midisong.tracks.length;t++){
            //var miditrack:SongTrack=midisong.tracks[t];
            var fordrum = [];
            for (var m = 0; m < miditrack.measures.length; m++) {
                var measure = miditrack.measures[m];
                for (var c = 0; c < measure.chords.length; c++) {
                    var chord = measure.chords[c];
                    if (chord.channel == 9) {
                        //console.log(i, m, chord);
                        for (var n = 0; n < chord.notes.length; n++) {
                            var note = chord.notes[n];
                            for (var p = 0; p < note.points.length; p++) {
                                var point = note.points[p];
                                this.takeDrumVoice(point.pitch, fordrum);
                            }
                        }
                    }
                }
            }
            for (var d = 0; d < fordrum.length; d++) {
                var zvoice = fordrum[d].voice;
                track.voices.push(zvoice);
                //console.log(fordrum[d].voice);
                var time = 0;
                for (var m = 0; m < miditrack.measures.length; m++) {
                    var measure = miditrack.measures[m];
                    var chunk = {
                        /*meter: {
                            count: midisong.meter.count
                            , division: midisong.meter.division
                        }
                        , tempo: Math.round(midisong.bpm)
                        ,*/ chords: [],
                        title: 'start at ' + time,
                        clefHint: 0,
                        keyHint: 0
                    };
                    zvoice.chunks.push(chunk);
                    for (var c = 0; c < measure.chords.length; c++) {
                        var midichord_1 = measure.chords[c];
                        if (midichord_1.channel == 9) {
                            var chordtime = midichord_1.when - time;
                            var zvoogchord = {
                                when: time2Duration(chordtime / 1000, midisong.bpm),
                                values: [],
                                title: '',
                                fretHint: [],
                                text: ''
                            };
                            for (var n = 0; n < midichord_1.notes.length; n++) {
                                var midinote = midichord_1.notes[n];
                                var point = midinote.points[0];
                                if (point.pitch == fordrum[d].drum) {
                                    var zvoogkey = {
                                        envelope: [],
                                        stepHint: 0,
                                        shiftHint: 0,
                                        octaveHint: 0
                                    };
                                    var zvoogPitch = {
                                        duration: time2Duration(point.duration / 1000, midisong.bpm),
                                        pitch: point.pitch
                                    };
                                    zvoogkey.envelope.push(zvoogPitch);
                                    zvoogchord.values.push(zvoogkey);
                                }
                            }
                            if (zvoogchord.values.length) {
                                chunk.chords.push(zvoogchord);
                            }
                        }
                    }
                    time = time + measure.duration;
                }
            }
            //}
            schedule.tracks.push(track);
        }
        return schedule;
    };
    MidiParser.prototype.dump = function () {
        var a = {
            parser: '1.01',
            duration: 0,
            bpm: this.header.tempoBPM,
            key: this.header.keyFlatSharp,
            mode: this.header.keyMajMin,
            meter: { count: this.header.meterCount, division: this.header.meterDivision },
            tracks: [],
            speedMode: 0,
            lineMode: 0
        };
        for (var i = 0; i < this.tracks.length; i++) {
            var miditrack = this.tracks[i];
            var tr = { order: i, title: miditrack.title ? miditrack.title : '', volume: miditrack.volume ? miditrack.volume : 1, program: miditrack.program ? miditrack.program : 0, measures: [] };
            for (var ch = 0; ch < miditrack.chords.length; ch++) {
                var midichord = miditrack.chords[ch];
                var newchord = { when: midichord.when, notes: [], channel: midichord.channel };
                var measure = this.takeMeasure(tr, midichord.when, this.header.tempoBPM, this.header.meterCount / this.header.meterDivision);
                //tr.chords.push(newchord);
                measure.chords.push(newchord);
                for (var n = 0; n < midichord.notes.length; n++) {
                    var midinote = midichord.notes[n];
                    var newnote = { points: [] };
                    newchord.notes.push(newnote);
                    for (var v = 0; v < midinote.points.length; v++) {
                        var midipoint = midinote.points[v];
                        var newpoint = { pitch: midipoint.pitch, duration: midipoint.pointDuration };
                        newnote.points.push(newpoint);
                    }
                }
            }
            if (tr.measures.length > 0) {
                a.tracks.push(tr);
                var d = tr.measures.length * tr.measures[0].duration;
                if (a.duration < d)
                    a.duration = d;
            }
        }
        //console.log(this);
        //console.log(a);
        return a;
    };
    return MidiParser;
}());
console.log('ZvoogApp v1.01');
var ZvoogApp = /** @class */ (function () {
    function ZvoogApp() {
        this.minZoom = 1;
        this.maxZoom = 1024;
        this.menuStyleWidth = '7cm';
        this.gridIndentUp = 256;
        this.gridIndentDown = 10;
        this.gridIndentLeft = 10;
        this.gridIndentRight = 10;
        this.lengthOfSecond = 50;
        this.noteLineWidth = 3;
        this.undoRedo = new ZvoogUndoRedo(this);
        this.lang = new ZvoogLang();
        this.onAir = false;
        this.popup = new ZvoogPopup(this);
        console.log('ZvoogApp init');
    }
    ZvoogApp.prototype.prepareSchedule = function () {
        for (var e = 0; e < this.currentSong.effects.length; e++) {
            var fx = this.currentSong.effects[e];
            fx.plugin.prepare(this.audioContext);
        }
        for (var e = 0; e < this.currentSong.tracks.length; e++) {
            var track = this.currentSong.tracks[e];
            for (var n = 0; n < track.effects.length; n++) {
                var fx = track.effects[n];
                fx.plugin.prepare(this.audioContext);
            }
            for (var k = 0; k < track.voices.length; k++) {
                var voice = track.voices[k];
                voice.source.plugin.prepare(this.audioContext);
                for (var n = 0; n < voice.effects.length; n++) {
                    var fx = voice.effects[n];
                    fx.plugin.prepare(this.audioContext);
                }
            }
        }
    };
    ZvoogApp.prototype.start = function () {
        console.log('ZvoogApp start');
        var testSong = new TestSong();
        this.currentSong = testSong.createRandomSchedule();
        console.log(this.currentSong);
        this.audioContext = new AudioContext();
        this.prepareSchedule();
        var layers = this.createLayers();
        this.tileLevel = new TileLevel(document.getElementById('contentSVG'), 100, 100, this.minZoom, 20, this.maxZoom - 0.001, layers);
        this.tileLevel.afterResizeCallback = this.afterResizeCallback.bind(this);
        this.tileLevel.afterZoomCallback = this.afterZoomCallback.bind(this);
        //this.resetWholeProject();
        var filesinput = document.getElementById('filesinput');
        if (filesinput)
            filesinput.addEventListener('change', this.handleFileSelect.bind(this), false);
        this.afterResizeCallback();
    };
    ZvoogApp.prototype.preventTouch = function (touchEvent) {
        if (touchEvent.touches.length > 1) {
            touchEvent.preventDefault();
        }
    };
    ZvoogApp.prototype.handleFileSelect = function (event) {
        var file = event.target.files[0];
        var fileReader = new FileReader();
        var me = this;
        fileReader.onload = function (progressEvent) {
            if (progressEvent.target) {
                var arrayBuffer = progressEvent.target.result;
                me.parseMIDI(arrayBuffer);
            }
        };
        fileReader.readAsArrayBuffer(file);
    };
    ZvoogApp.prototype.parseMIDI = function (arrayBuffer) {
        var midiParser = new MidiParser(arrayBuffer);
        console.log('import', midiParser.dump());
        this.currentSong = midiParser.convert();
        console.log('song', this.currentSong);
        this.prepareSchedule();
        this.resetWholeProject();
    };
    ZvoogApp.prototype.afterResizeCallback = function () {
        var cm = Math.floor(this.tileLevel.viewWidth / this.tileLevel.tapSize);
        if (cm < 7) {
            this.menuStyleWidth = '5cm';
        }
        else {
            if (cm > 12) {
                this.menuStyleWidth = '12cm';
            }
            else {
                this.menuStyleWidth = '7cm';
            }
        }
        this.resetWholeProject();
    };
    ZvoogApp.prototype.afterZoomCallback = function () {
        console.log('xyz', this.tileLevel.translateX, this.tileLevel.translateY, this.tileLevel.translateZ);
    };
    ZvoogApp.prototype.addMainIconButton = function (iconX, iconY, iconScale, iconPath, x, y, size, text, sizecss, content, action) {
        content.push(this.tileLevel.actionRectangle(action.bind(this), x, y, size, size, 0.5 * size, 0.5 * size, 'fillButtonSpot'));
        content.push(this.tileLevel.pathImage(x + iconX, y + iconY, iconScale //, 0.05
        , iconPath, 'fillColorContent'));
        content.push({ x: x, y: y, w: size, h: size, css: 'fillButtonActionPoint', action: action.bind(this) });
    };
    ZvoogApp.prototype.addIcon128 = function (content, x, y, size, iconPath, iconCSS) {
        var iconSize = 128 / this.tileLevel.tapSize;
        var scale = 0.6 * size / iconSize;
        content.push(this.tileLevel.pathImage(x + 0.2 * size, y + 0.2 * size, scale, iconPath, iconCSS));
    };
    ZvoogApp.prototype.addButtonIcon128 = function (iconPath, x, y, size, content, action, iconCSS) {
        content.push(this.tileLevel.actionRectangle(action.bind(this), x, y, size, size, 0.5 * size, 0.5 * size, 'fillButtonSpot'));
        this.addIcon128(content, x, y, size, iconPath, iconCSS);
        content.push(this.tileLevel.actionRectangle(action.bind(this), x, y, size, size, 0, 0, 'fillButtonActionPoint'));
    };
    ZvoogApp.prototype.addMainTextButton = function (x, y, size, text, sizecss, content, action) {
        content.push({ x: x, y: y, w: size, h: size, rx: 0.5 * size, ry: 0.5 * size, css: 'fillButtonSpot', action: action.bind(this) });
        content.push({ x: x + 0.3 * size, y: y + 0.8 * size, css: sizecss + ' fillColorContent', text: text });
        content.push({ x: x, y: y, w: size, h: size, css: 'fillButtonActionPoint', action: action.bind(this) });
    };
    ZvoogApp.prototype.addBlockedTextButton = function (x, y, size, text, sizecss, content) {
        content.push({ x: x, y: y, w: size, h: size, rx: 0.5 * size, ry: 0.5 * size, css: 'fillButtonSpot' });
        content.push({ x: x + 0.3 * size, y: y + 0.8 * size, css: sizecss + ' fillColorSub', text: text });
    };
    ZvoogApp.prototype.resetButtons = function () {
        this.workButtonsGroup.content.length = 0;
        this.overButtonsAnchor.content.length = 0;
        this.addButtonIcon128(ZvoogIcons.iconPathGear128, 160, 5, 11, this.workButtonsGroup.content, this.importTestMIDI, 'fillColorContent');
        this.addMainTextButton(32, 32, 128, this.currentSong.title, 'fontSize128', this.workButtonsGroup.content, this.promptTitle);
        this.addMainTextButton(256, 224, 32, this.currentSong.description, 'fontSize16', this.workButtonsGroup.content, this.promptDescription);
        if (this.currentSong.macros.length > 0 && this.currentSong.macroPosition < this.currentSong.macros.length) {
            this.addButtonIcon128(ZvoogIcons.iconPathRedo128, 0.1 + 1 + 0.1, 0.1, 1, this.overButtonsAnchor.content, this.clickRedo, 'fillColorContent');
        }
        else {
            this.addButtonIcon128(ZvoogIcons.iconPathRedo128, 0.1 + 1 + 0.1, 0.1, 1, this.overButtonsAnchor.content, function () { }, 'fillColorSub');
        }
        if (this.currentSong.macros.length > 0 && this.currentSong.macroPosition > 0) {
            this.addButtonIcon128(ZvoogIcons.iconPathUndo128, 0.1 + 1 + 0.1 + 1 + 0.1, 0.1, 1, this.overButtonsAnchor.content, this.clickUndo, 'fillColorContent');
        }
        else {
            this.addButtonIcon128(ZvoogIcons.iconPathUndo128, 0.1 + 1 + 0.1 + 1 + 0.1, 0.1, 1, this.overButtonsAnchor.content, function () { }, 'fillColorSub');
        }
        this.addButtonIcon128(ZvoogIcons.iconPathLayers128, 0.1, 0.1, 1, this.overButtonsAnchor.content, this.openLayersPopup, 'fillColorContent');
        var playIcon = ZvoogIcons.iconPathPlay128;
        if (this.onAir) {
            playIcon = ZvoogIcons.iconPathPause128;
        }
        this.addButtonIcon128(playIcon, 0.1 + 1 + 0.1 + 1 + 0.1 + 1 + 0.1, 0.1, 1, this.overButtonsAnchor.content, this.togglePlay, 'fillColorContent');
    };
    ZvoogApp.prototype.togglePlay = function () {
        this.onAir = !this.onAir;
        this.resetWholeProject();
        console.log('play', this.onAir);
    };
    ZvoogApp.prototype.isTrackActive = function (track) {
        if (track + 1 == this.currentSong.selectedLayer.level1) {
            return true;
        }
        return false;
    };
    ZvoogApp.prototype.isTrackSelected = function (track) {
        if (this.isTrackActive(track)) {
            if (this.currentSong.selectedLayer.level2 == 0) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isFxActive = function (fx) {
        if (this.currentSong.tracks.length + fx + 1 == this.currentSong.selectedLayer.level1) {
            return true;
        }
        return false;
    };
    ZvoogApp.prototype.isFxSelected = function (fx) {
        if (this.isFxActive(fx)) {
            if (this.currentSong.selectedLayer.level2 == 0) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isFxParameterSelected = function (fx, par) {
        if (this.isFxActive(fx)) {
            if (par + 1 == this.currentSong.selectedLayer.level2) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isTrackFxActive = function (track, fx) {
        if (this.isTrackActive(track)) {
            if (this.currentSong.tracks[track].voices.length + fx + 1 == this.currentSong.selectedLayer.level2) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isTrackFxSelected = function (track, fx) {
        if (this.isTrackFxActive(track, fx)) {
            if (this.currentSong.selectedLayer.level3 == 0) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isTrackFxParameterSelected = function (track, fx, par) {
        if (this.isTrackFxActive(track, fx)) {
            if (par + 1 == this.currentSong.selectedLayer.level3) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceActive = function (track, voice) {
        if (this.isTrackActive(track)) {
            if (voice + 1 == this.currentSong.selectedLayer.level2) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceSubSelected = function (track, voice) {
        //this.currentSong.selectedLayer.level3 > 0 || this.currentSong.selectedLayer.level2 >= track.voices.length
        if (this.isTrackActive(track)) {
            if (!this.isVoiceSelected(track, voice)) {
                if (this.currentSong.tracks.length > track) {
                    if (this.currentSong.selectedLayer.level2 <= this.currentSong.tracks[track].voices.length) {
                        if (this.currentSong.selectedLayer.level3 == 0) {
                            return true;
                        }
                    }
                }
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceSelected = function (track, voice) {
        if (this.isVoiceActive(track, voice)) {
            if (this.currentSong.selectedLayer.level3 == 0) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceSourceActive = function (track, voice) {
        if (this.isVoiceActive(track, voice)) {
            if (this.currentSong.selectedLayer.level3 == 1) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceSourceSelected = function (track, voice) {
        if (this.isVoiceSourceActive(track, voice)) {
            if (this.currentSong.selectedLayer.level4 == 0) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceSourceParameterSelected = function (track, voice, par) {
        if (this.isVoiceSourceActive(track, voice)) {
            if (par + 1 == this.currentSong.selectedLayer.level4) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceFxActive = function (track, voice, fx) {
        if (this.isVoiceActive(track, voice)) {
            if (fx + 1 + 1 == this.currentSong.selectedLayer.level3) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceFxSelected = function (track, voice, fx) {
        if (this.isVoiceFxActive(track, voice, fx)) {
            if (this.currentSong.selectedLayer.level4 == 0) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.isVoiceFxParameterSelected = function (track, voice, fx, par) {
        if (this.isVoiceActive(track, voice)) {
            if (par + 1 == this.currentSong.selectedLayer.level4) {
                return true;
            }
        }
        return false;
    };
    ZvoogApp.prototype.fillLayersMenu = function () {
        var _this = this;
        var items = [];
        for (var k1 = 0; k1 < this.currentSong.tracks.length; k1++) {
            var track = this.currentSong.tracks[k1];
            var kk1 = k1 + 1;
            var kk2 = 0;
            if (!this.isFxActive(k1)) {
                if (this.currentSong.tracks[k1].voices.length) {
                    kk2 = 1;
                }
            }
            items.push({
                label: track.title, css: this.isTrackSelected(k1) ? 'fillColorContent' : 'fillColorOther',
                padding: 0, path128: ZvoogIcons.iconPathWave128, subMenu: [],
                action: this.createSelectLayerAction(kk1, kk2, 0, 0)
            });
            if (this.isTrackActive(k1)) {
                for (var k2 = 0; k2 < track.voices.length; k2++) {
                    var voice = track.voices[k2];
                    items.push({
                        label: voice.title, css: this.isVoiceSelected(k1, k2)
                            ? 'fillColorContent'
                            //: this.currentSong.selectedLayer.level3 > 0 || this.currentSong.selectedLayer.level2 >= track.voices.length 
                            : this.isVoiceSubSelected(k1, k2)
                                ? 'fillColorSub'
                                : 'fillColorOther',
                        padding: 1, path128: ZvoogIcons.iconPathNotes128, subMenu: [],
                        action: this.createSelectLayerAction(k1 + 1, k2 + 1, 0, 0)
                    });
                    if (this.isVoiceActive(k1, k2)) {
                        var kk1_1 = k1 + 1;
                        var kk2_1 = k2 + 1;
                        var kk3 = 1;
                        var kk4 = 0;
                        if (!this.isVoiceSourceActive(k1, k2)) {
                            if (voice.source.parameters.length) {
                                kk4 = 1;
                            }
                        }
                        items.push({
                            label: voice.source.plugin.label(), css: this.isVoiceSourceSelected(k1, k2) ? 'fillColorContent' : 'fillColorOther',
                            padding: 2, path128: ZvoogIcons.iconPathSound128, subMenu: [],
                            action: this.createSelectLayerAction(kk1_1, kk2_1, kk3, kk4)
                        });
                        if (this.isVoiceSourceActive(k1, k2)) {
                            var pars = voice.source.plugin.getParams();
                            if (pars) {
                                for (var k4 = 0; k4 < pars.length; k4++) {
                                    var zp = pars[k4];
                                    items.push({
                                        label: zp.label(), css: this.isVoiceSourceParameterSelected(k1, k2, k4) ? 'fillColorContent' : this.isVoiceSourceSelected(k1, k2) ? 'fillColorOther' : 'fillColorSub',
                                        padding: 3, path128: ZvoogIcons.iconPathGraph128, subMenu: [],
                                        action: this.createSelectLayerAction(k1 + 1, k2 + 1, 1, k4 + 1)
                                    });
                                }
                            }
                        }
                        for (var k3 = 0; k3 < voice.effects.length; k3++) {
                            var effect = voice.effects[k3];
                            var kk1_2 = k1 + 1;
                            var kk2_2 = k2 + 1;
                            var kk3_1 = k3 + 1 + 1;
                            var kk4_1 = 0;
                            if (!this.isVoiceFxActive(k1, k2, k3)) {
                                if (effect.parameters.length) {
                                    kk4_1 = 1;
                                }
                            }
                            items.push({
                                label: effect.plugin.label(), css: this.isVoiceFxSelected(k1, k2, k3) ? 'fillColorContent' : 'fillColorOther',
                                padding: 2, path128: ZvoogIcons.iconPathAdjust128, subMenu: [],
                                action: this.createSelectLayerAction(kk1_2, kk2_2, kk3_1, kk4_1)
                            });
                            if (this.isVoiceFxActive(k1, k2, k3)) {
                                var pars = effect.plugin.getParams();
                                if (pars) {
                                    for (var k4 = 0; k4 < pars.length; k4++) {
                                        var zp = pars[k4];
                                        items.push({
                                            label: zp.label(), css: this.isVoiceFxParameterSelected(k1, k2, k3, k4) ? 'fillColorContent' : this.isVoiceFxSelected(k1, k2, k3) ? 'fillColorOther' : 'fillColorSub',
                                            padding: 3, path128: ZvoogIcons.iconPathGraph128, subMenu: [],
                                            action: this.createSelectLayerAction(k1 + 1, k2 + 1, k3 + 1 + 1, k4 + 1)
                                        });
                                    }
                                }
                            }
                        }
                    }
                }
                for (var k2 = 0; k2 < track.effects.length; k2++) {
                    var plugin = track.effects[k2].plugin;
                    var kk1_3 = k1 + 1;
                    var kk2_3 = track.voices.length + k2 + 1;
                    var kk3 = 0;
                    if (!this.isTrackFxActive(k1, k2)) {
                        if (track.effects[k2].parameters.length) {
                            kk3 = 1;
                        }
                    }
                    items.push({
                        label: plugin.label(), css: this.isTrackFxSelected(k1, k2) ? 'fillColorContent' : 'fillColorOther',
                        padding: 1, path128: ZvoogIcons.iconPathAdjust128, subMenu: [],
                        action: this.createSelectLayerAction(kk1_3, kk2_3, kk3, 0)
                    });
                    if (this.isTrackFxActive(k1, k2)) {
                        var pars_1 = plugin.getParams();
                        if (pars_1) {
                            for (var k3 = 0; k3 < pars_1.length; k3++) {
                                var p = pars_1[k3];
                                items.push({
                                    label: p.label(), css: this.isTrackFxParameterSelected(k1, k2, k3) ? 'fillColorContent' : this.isTrackFxSelected(k1, k2) ? 'fillColorOther' : 'fillColorSub',
                                    padding: 2, path128: ZvoogIcons.iconPathGraph128,
                                    subMenu: [],
                                    action: this.createSelectLayerAction(k1 + 1, track.voices.length + k2 + 1, k3 + 1, 0)
                                });
                            }
                        }
                    }
                }
            }
        }
        for (var k1 = 0; k1 < this.currentSong.effects.length; k1++) {
            var effect = this.currentSong.effects[k1];
            var kk1 = k1 + this.currentSong.tracks.length + 1;
            var kk2 = 0;
            if (!this.isFxActive(k1)) {
                if (this.currentSong.effects[k1].parameters.length) {
                    kk2 = 1;
                }
            }
            items.push({
                label: effect.plugin.label(), css: this.isFxSelected(k1) ? 'fillColorContent' : 'fillColorOther',
                padding: 0, path128: ZvoogIcons.iconPathAdjust128, subMenu: [],
                action: this.createSelectLayerAction(kk1, kk2, 0, 0)
            });
            if (this.isFxActive(k1)) {
                var pars_2 = effect.plugin.getParams();
                if (pars_2) {
                    for (var k2 = 0; k2 < pars_2.length; k2++) {
                        var p = pars_2[k2];
                        items.push({
                            label: p.label(), css: this.isFxParameterSelected(k1, k2) ? 'fillColorContent' : this.isFxSelected(k1) ? 'fillColorOther' : 'fillColorSub',
                            padding: 1, path128: ZvoogIcons.iconPathGraph128,
                            subMenu: [],
                            action: this.createSelectLayerAction(k1 + this.currentSong.tracks.length + 1, k2 + 1, 0, 0)
                        });
                    }
                }
            }
        }
        items.push({
            label: 'theme', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, padding: 0, subMenu: [
                { label: '80th', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_80th.css'); } },
                { label: 'argon', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_argon.css'); } },
                { label: 'bumaga', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_bumaga.css'); } },
                { label: 'hohloma', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_hohloma.css'); } },
                { label: 'iskra', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_iskra.css'); } },
                { label: 'margarin', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_margarin.css'); } },
                { label: 'osen', css: 'fillColorOther', path128: ZvoogIcons.iconPathUndo128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_osen.css'); } },
                { label: 'tina', css: 'fillColorOther', path128: ZvoogIcons.iconPathGear128, subMenu: [], padding: 0, action: function () { _this.setCSS('./css/zvoogcolors_tina.css'); } }
            ]
        });
        return items;
    };
    ZvoogApp.prototype.openLayersPopup = function () {
        var popupX = -this.tileLevel.translateX / this.tileLevel.tapSize;
        var popupY = -this.tileLevel.translateY / this.tileLevel.tapSize;
        var popupZ = this.nearZoomFont(this.tileLevel.translateZ);
        if (this.tileLevel.viewWidth > this.tileLevel.innerWidth / popupZ) {
            var sW = (this.tileLevel.viewWidth - this.tileLevel.innerWidth / popupZ) / 2;
            popupX = -popupZ * sW / this.tileLevel.tapSize;
        }
        if (this.tileLevel.viewHeight > this.tileLevel.innerHeight / popupZ) {
            var sH = (this.tileLevel.viewHeight - this.tileLevel.innerHeight / popupZ) / 2;
            popupY = -popupZ * sH / this.tileLevel.tapSize;
        }
        this.popup.showPopupMenu(popupX, popupY, popupZ, popupZ / 2, this.fillLayersMenu());
    };
    ZvoogApp.prototype.setCSS = function (filepath) {
        console.log('setCSS');
        var head = document.getElementsByTagName('HEAD')[0];
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = filepath;
        head.appendChild(link);
    };
    ZvoogApp.prototype.nearZoomFont = function (n) {
        var k = 1;
        while (k * 1.7 <= n) {
            k = k * 2;
        }
        if (k > 256) {
            k = 256;
        }
        return k;
    };
    ZvoogApp.prototype.importTestMIDI = function () {
        console.log('importTestMIDI');
        var filesinput = document.getElementById('filesinput');
        if (filesinput)
            filesinput.click();
    };
    ZvoogApp.prototype.createSelectLayerAction = function (c1, c2, c3, c4) {
        var me = this;
        return function () {
            console.log('select', c1, c2, c3, c4);
            me.undoRedo.addRedo({
                key: UndoRedoKeys.undoRedoSelectLayer,
                point: me.uiTapPosition(),
                properties: {
                    oldSelection: {
                        level1: me.currentSong.selectedLayer.level1,
                        level2: me.currentSong.selectedLayer.level2,
                        level3: me.currentSong.selectedLayer.level3,
                        level4: me.currentSong.selectedLayer.level4
                    },
                    newSelection: {
                        level1: c1,
                        level2: c2,
                        level3: c3,
                        level4: c4
                    }
                }
            });
            me.popup.closePopupMenu1();
            me.openLayersPopup();
        };
    };
    /*popupMoveUpVoice(t: number, v: number): () => void {
        let me = this;
        return function (): void {
            //me.closeLayersMenu();
            //me.undoRedo.addRedo({ key: undoRedoMoveVoice, point: me.uiTapPosition(), properties: { oldTrackPosition: t, newTrackPosition: 0, oldVoicePosition: v, newVoicePosition: 0 } });
            me.undoRedo.addRedo({
                key: undoRedoMoveVoice, point: me.uiTapPosition(), properties: {
                    oldTrackPosition: me.currentSong.selectedLayer.level1
                    , newTrackPosition: t
                    , oldVoicePosition: me.currentSong.selectedLayer.level2
                    , newVoicePosition: v
                }
            });
            me.popup.closePopupMenu1();
            me.openLayersPopup();
        }
    }
    popupMoveUpTrack(t: number): () => void {
        let me = this;
        return function (): void {
            //console.log('popupMoveUpTrack', t);
            me.undoRedo.addRedo({
                key: undoRedoMoveTrack, point: me.uiTapPosition(), properties: {
                    oldTrackPosition: me.currentSong.selectedLayer.level1
                    , newTrackPosition: t
                    , oldVoicePosition: me.currentSong.selectedLayer.level2
                    , newVoicePosition: 0
                }
            });
            me.popup.closePopupMenu1();
            me.openLayersPopup();
        }
    }*/
    ZvoogApp.prototype.promptTitle = function () {
        var result = window.prompt('Title', this.currentSong.title);
        if ((result) && result != this.currentSong.title) {
            this.undoRedo.addRedo({ key: UndoRedoKeys.undoRedoChangeProjectTitle, point: this.uiTapPosition(), properties: { newTitle: result, oldTitle: this.currentSong.title } });
        }
    };
    ZvoogApp.prototype.promptDescription = function () {
        var result = window.prompt('Description', this.currentSong.title);
        if ((result) && result != this.currentSong.description) {
            this.undoRedo.addRedo({ key: UndoRedoKeys.undoRedoChangeProjectDescription, point: this.uiTapPosition(), properties: { newDescription: result, oldDescription: this.currentSong.description } });
        }
    };
    ZvoogApp.prototype.uiTapPosition = function () {
        return { x: -this.tileLevel.translateX / this.tileLevel.tapSize, y: -this.tileLevel.translateY / this.tileLevel.tapSize, z: this.tileLevel.translateZ };
    };
    ZvoogApp.prototype.clickRedo = function () {
        var xyz = this.undoRedo.doRedo();
        if (xyz) {
            this.tileLevel.startSlideTo(-xyz.x * this.tileLevel.tapSize, -xyz.y * this.tileLevel.tapSize, xyz.z, null);
        }
    };
    ZvoogApp.prototype.clickUndo = function () {
        var xyz = this.undoRedo.doUndo();
        if (xyz) {
            this.tileLevel.startSlideTo(-xyz.x * this.tileLevel.tapSize, -xyz.y * this.tileLevel.tapSize, xyz.z, null);
        }
    };
    ZvoogApp.prototype.addParameters = function () {
        for (var k1 = 0; k1 < this.currentSong.effects.length; k1++) {
            var effect = this.currentSong.effects[k1];
            var pars = effect.plugin.getParams();
            if (pars) {
                for (var k2 = 0; k2 < pars.length; k2++) {
                    if (effect.parameters.length > k2) {
                        var curve = effect.parameters[k2];
                        if (this.isFxActive(k1) && (!this.isFxSelected(k1))) {
                            if (this.isFxParameterSelected(k1, k2)) {
                                this.addParameterCurve(curve, this.firstAnchor, 'firstSegment', 'firstJoint', true);
                            }
                            else {
                                this.addParameterCurve(curve, this.secondAnchor, 'secondSegment', 'secondJoint', false);
                            }
                        }
                        else {
                            this.addParameterCurve(curve, this.otherAnchor, 'otherSegment', 'otherJoint', false);
                        }
                    }
                }
            }
        }
        for (var k1 = 0; k1 < this.currentSong.tracks.length; k1++) {
            var track = this.currentSong.tracks[k1];
            for (var k2 = 0; k2 < track.effects.length; k2++) {
                var effect = track.effects[k2];
                var pars = effect.plugin.getParams();
                if (pars) {
                    for (var k3 = 0; k3 < pars.length; k3++) {
                        if (effect.parameters.length > k3) {
                            var curve = effect.parameters[k3];
                            if (this.isTrackFxActive(k1, k2) && (!this.isTrackFxSelected(k1, k2))) {
                                if (this.isTrackFxParameterSelected(k1, k2, k3)) {
                                    this.addParameterCurve(curve, this.firstAnchor, 'firstSegment', 'firstJoint', true);
                                }
                                else {
                                    this.addParameterCurve(curve, this.secondAnchor, 'secondSegment', 'secondJoint', false);
                                }
                            }
                            else {
                                this.addParameterCurve(curve, this.otherAnchor, 'otherSegment', 'otherJoint', false);
                            }
                        }
                    }
                }
            }
            for (var k2 = 0; k2 < track.voices.length; k2++) {
                var voice = track.voices[k2];
                //console.log(k1,k2,track);
                var pars = voice.source.plugin.getParams();
                if (pars) {
                    for (var k4 = 0; k4 < pars.length; k4++) {
                        if (voice.source.parameters.length > k4) {
                            var curve = voice.source.parameters[k4];
                            if (this.isVoiceSourceActive(k1, k2) && (!this.isVoiceSourceSelected(k1, k2))) {
                                if (this.isVoiceSourceParameterSelected(k1, k2, k4)) {
                                    this.addParameterCurve(curve, this.firstAnchor, 'firstSegment', 'firstJoint', true);
                                }
                                else {
                                    this.addParameterCurve(curve, this.secondAnchor, 'secondSegment', 'secondJoint', false);
                                }
                            }
                            else {
                                this.addParameterCurve(curve, this.otherAnchor, 'otherSegment', 'otherJoint', false);
                            }
                        }
                    }
                }
                for (var k3 = 0; k3 < voice.effects.length; k3++) {
                    var effect = voice.effects[k3];
                    var pars_3 = effect.plugin.getParams();
                    if (pars_3) {
                        for (var k4 = 0; k4 < pars_3.length; k4++) {
                            if (effect.parameters.length > k4) {
                                var curve = effect.parameters[k4];
                                if (this.isVoiceFxActive(k1, k2, k3) && (!this.isVoiceFxSelected(k1, k2, k3))) {
                                    if (this.isVoiceFxParameterSelected(k1, k2, k3, k4)) {
                                        this.addParameterCurve(curve, this.firstAnchor, 'firstSegment', 'firstJoint', true);
                                    }
                                    else {
                                        this.addParameterCurve(curve, this.secondAnchor, 'secondSegment', 'secondJoint', false);
                                    }
                                }
                                else {
                                    this.addParameterCurve(curve, this.otherAnchor, 'otherSegment', 'otherJoint', false);
                                }
                            }
                        }
                    }
                }
            }
        }
    };
    ZvoogApp.prototype.addParameterCurve = function (curve, tile, cssSegment, cssJoint, joint) {
        var measureX = 0;
        var measureIndex = 0;
        var x384 = 0;
        var prex = 0;
        var prey = 0;
        for (var i = 0; i < curve.points.length; i++) {
            var point = curve.points[i];
            for (var m = 0; m < point.skipMeasures; m++) {
                measureX = measureX + this.patternDuration(this.currentSong.timeline[measureIndex]) * this.lengthOfSecond;
                measureIndex++;
                x384 = 0;
            }
            x384 = x384 + point.skip384;
            var x = this.gridIndentLeft + measureX;
            var y = this.gridIndentUp + (120 - 0.5 - point.velocity) * this.noteLineWidth - 2;
            if (joint) {
                tile.content.push(this.tileLevel.rectangle(x - 6 + 0.5, y - 4, 12, 12, 6, 6, 'fillFlatSpot'));
            }
            if (i) {
                tile.content.push(this.tileLevel.line(prex + 0.5, prey + 2, x + 0.5, y + 2, cssSegment));
            }
            prex = x;
            prey = y;
            //console.log(measureX, point);
        }
        //this.tileLevel.innerWidth
        var endX = this.gridIndentLeft + durations2time(this.currentSong.timeline) * this.lengthOfSecond;
        tile.content.push(this.tileLevel.line(prex + 0.5, prey + 2, endX + 0.5, prey + 2, cssSegment));
    };
    ZvoogApp.prototype.createNoteHeadClick = function (key) {
        return function (x, y) {
            console.log('click', key);
        };
    };
    ZvoogApp.prototype.resetNotes = function () {
        this.firstAnchor.content.length = 0;
        this.secondAnchor.content.length = 0;
        this.otherAnchor.content.length = 0;
        for (var t = 0; t < this.currentSong.tracks.length; t++) {
            var track = this.currentSong.tracks[t];
            for (var v = 0; v < track.voices.length; v++) {
                var voice = track.voices[v];
                var nextMeasureX = 0;
                //console.log(t,v,track);
                for (var i = 0; i < voice.chunks.length; i++) {
                    var chunk = voice.chunks[i];
                    var measure = this.currentSong.timeline[i];
                    if (measure) {
                        var chunkAnchor = this.tileLevel.anchor(this.gridIndentLeft + nextMeasureX, this.gridIndentUp, this.patternDuration(measure) * this.lengthOfSecond * 4, 120 * this.noteLineWidth, this.minZoom, this.maxZoom);
                        //if (t == this.currentSong.selectedLayer.level1 && v == this.currentSong.selectedLayer.level2) {
                        if (this.isVoiceSelected(t, v)) {
                            this.firstAnchor.content.push(chunkAnchor);
                            this.addChordNotes(chunkAnchor, nextMeasureX, measure, chunk, 'firstLine');
                            var spotAnchor = this.tileLevel.anchor(this.gridIndentLeft + nextMeasureX, this.gridIndentUp, this.patternDuration(measure) * this.lengthOfSecond * 4, 120 * this.noteLineWidth, this.minZoom, 16);
                            this.firstAnchor.content.push(spotAnchor);
                            for (var ch = 0; ch < chunk.chords.length; ch++) {
                                var chord = chunk.chords[ch];
                                for (var n = 0; n < chord.values.length; n++) {
                                    var key = chord.values[n];
                                    var chordX = this.gridIndentLeft + nextMeasureX + duration2time(measure.tempo, chord.when) * this.lengthOfSecond;
                                    var noteY = this.gridIndentUp + (120 - 0.5 - key.envelope[0].pitch) * this.noteLineWidth;
                                    spotAnchor.content.push(this.tileLevel.actionRectangle(this.createNoteHeadClick(key), chordX + 0.5, noteY - 1, 2, 2, 1, 1, 'fillFlatSpot'));
                                }
                            }
                        }
                        else {
                            //if (t == this.currentSong.selectedLayer.level1 && v != this.currentSong.selectedLayer.level2) {
                            if (this.isVoiceSubSelected(t, v)) {
                                this.secondAnchor.content.push(chunkAnchor);
                                this.addChordNotes(chunkAnchor, nextMeasureX, measure, chunk, 'secondLine');
                            }
                            else {
                                this.otherAnchor.content.push(chunkAnchor);
                                this.addChordNotes(chunkAnchor, nextMeasureX, measure, chunk, 'otherLine');
                            }
                        }
                        nextMeasureX = nextMeasureX + this.patternDuration(measure) * this.lengthOfSecond;
                    }
                    else {
                        break;
                    }
                }
            }
        }
        this.addParameters();
    };
    ZvoogApp.prototype.addChordNotes = function (chunkAnchor, nextMeasureX, measure, chunk, css) {
        for (var ch = 0; ch < chunk.chords.length; ch++) {
            var chord = chunk.chords[ch];
            for (var n = 0; n < chord.values.length; n++) {
                var key = chord.values[n];
                this.addNoteLine(chunkAnchor, nextMeasureX, measure, chunk, chord, key, css);
            }
        }
    };
    ZvoogApp.prototype.addNoteLine = function (anchor, nextMeasureX, measure, chunk, chord, key, css) {
        var chordX = this.gridIndentLeft + nextMeasureX + duration2time(measure.tempo, chord.when) * this.lengthOfSecond;
        var noteY = this.gridIndentUp + (120 - 0.5 - key.envelope[0].pitch) * this.noteLineWidth;
        var noteX = chordX;
        for (var i = 0; i < key.envelope.length; i++) {
            var iWidth = duration2time(measure.tempo, key.envelope[i].duration) * this.lengthOfSecond;
            var slide = 0;
            if (key.envelope.length > i + 1) {
                slide = key.envelope[i].pitch - key.envelope[i + 1].pitch;
            }
            var dx = 0;
            if (i > 0) {
                dx = this.noteLineWidth;
            }
            anchor.content.push(this.tileLevel.line(noteX + 0.5 * this.noteLineWidth - dx, noteY, noteX + iWidth - 0.5 * this.noteLineWidth, noteY + slide * this.noteLineWidth, css));
            noteY = noteY + slide * this.noteLineWidth;
            noteX = noteX + iWidth;
        }
    };
    ZvoogApp.prototype.resetGrid = function () {
        this.keyZoomAnchor.content.length = 0;
        this.keyWholeAnchor.content.length = 0;
        this.meterPatternAnchor.content.length = 0;
        this.labelsOctaveAnchor16.content.length = 0;
        this.labelsOctaveAnchor8.content.length = 0;
        this.labelsOctaveAnchor4.content.length = 0;
        this.labelsOctaveAnchor2.content.length = 0;
        this.labelsBottomAnchor256.content.length = 0;
        this.labelsBottomAnchor64.content.length = 0;
        this.labelsBottomAnchor16.content.length = 0;
        this.labelsBottomAnchor4.content.length = 0;
        var nextMeasureX = 0;
        /*if (this.currentSong.tracks.length > this.currentSong.selectedLayer.level1) {
            let track: ZvoogTrack = this.currentSong.tracks[this.currentSong.selectedLayer.level1];
            if (track.voices.length > this.currentSong.selectedLayer.level2) {
                let voice: ZvoogVoice = track.voices[this.currentSong.selectedLayer.level2];
*/
        for (var i = 0; i < this.currentSong.timeline.length; i++) {
            //for (let i = 0; i < voice.chunks.length; i++) {
            //let chunk: ZvoogPattern = voice.chunks[i];
            var measure = this.currentSong.timeline[i];
            var measureAnchor = {
                xx: this.gridIndentLeft + nextMeasureX,
                yy: this.gridIndentUp,
                ww: this.patternDuration(measure) * this.lengthOfSecond,
                hh: 120 * this.noteLineWidth,
                showZoom: this.minZoom,
                hideZoom: 16,
                content: []
            };
            this.meterPatternAnchor.content.push(measureAnchor);
            var farMeasureAnchor = {
                xx: this.gridIndentLeft + nextMeasureX,
                yy: this.gridIndentUp,
                ww: this.patternDuration(measure) * this.lengthOfSecond,
                hh: 120 * this.noteLineWidth,
                showZoom: 16,
                hideZoom: 256,
                content: []
            };
            this.meterPatternAnchor.content.push(farMeasureAnchor);
            var idx = 0;
            var gduration = 0;
            while (gduration < duration384(measure.meter) && idx < this.currentSong.gridPattern.length) {
                var step = this.currentSong.gridPattern[idx];
                var sx = duration2time(measure.tempo, gduration) * this.lengthOfSecond;
                var thick = 0.1;
                if (step.power > 0) {
                    thick = 0.25;
                }
                if (step.power > 1) {
                    thick = 0.5;
                }
                if (step.power > 2) {
                    thick = 1;
                }
                if (gduration > 0 || i > 0) {
                    measureAnchor.content.push({
                        x: this.gridIndentLeft + nextMeasureX + sx,
                        y: this.gridIndentUp, w: thick, h: 120 * this.noteLineWidth, css: 'meterLine'
                    });
                }
                gduration = gduration + step.duration;
                idx++;
                if (idx > this.currentSong.gridPattern.length) {
                    idx = 0;
                }
            }
            if (i) {
                farMeasureAnchor.content.push({
                    x: this.gridIndentLeft + nextMeasureX,
                    y: this.gridIndentUp, w: 3, h: 120 * this.noteLineWidth, css: 'meterFarLine'
                });
            }
            if ((i + 1) % 20 == 0 && i > 0)
                this.labelsBottomAnchor256.content.push(this.tileLevel.text(this.gridIndentLeft + nextMeasureX, 0, '' + (1 + i), 'barNum256'));
            if ((i + 1) % 5 == 0)
                this.labelsBottomAnchor64.content.push(this.tileLevel.text(this.gridIndentLeft + nextMeasureX, 0, '' + (1 + i), 'barNum64'));
            this.labelsBottomAnchor16.content.push(this.tileLevel.text(this.gridIndentLeft + nextMeasureX, 0, '' + (1 + i), 'barNum16'));
            this.labelsBottomAnchor4.content.push(this.tileLevel.text(this.gridIndentLeft + nextMeasureX, 0, '' + (1 + i), 'barNum4'));
            nextMeasureX = nextMeasureX + this.patternDuration(measure) * this.lengthOfSecond;
        }
        //}
        //}
        this.keyZoomAnchor.ww = nextMeasureX;
        this.keyWholeAnchor.ww = nextMeasureX;
        for (var k = 0; k < 120; k++) {
            if (this.currentSong.keyPattern[k]) {
                var css = 'keyFillWhite';
                if (this.currentSong.keyPattern[k] > 1) {
                    css = 'keyFillBlack';
                }
                if (this.currentSong.keyPattern[k] > 2) {
                    css = 'keyFillWhite';
                }
                this.keyZoomAnchor.content.push({
                    x: this.gridIndentLeft, y: this.gridIndentUp + (120 - k - 1) * this.noteLineWidth,
                    w: nextMeasureX, h: 0.9 * this.noteLineWidth, css: css
                });
                if (k > 0) {
                    if (this.currentSong.keyPattern[k] > 2) {
                        this.keyZoomAnchor.content.push({
                            x: this.gridIndentLeft, y: this.gridIndentUp + (120 - k - 0.05) * this.noteLineWidth,
                            w: nextMeasureX, h: 0.1 * this.noteLineWidth, css: 'meterLine'
                        });
                    }
                }
            }
        }
        for (var k = 0; k < 10; k++) {
            var css = 'keyFillWhite';
            if (k % 2) {
                css = 'keyFillBlack';
            }
            this.keyWholeAnchor.content.push({
                x: this.gridIndentLeft, y: this.gridIndentUp + (120 - k * 12 - 12) * this.noteLineWidth,
                w: nextMeasureX, h: 12 * this.noteLineWidth, css: css
            });
            this.labelsOctaveAnchor16.content.push(this.tileLevel.text(0, this.gridIndentUp + (120 - k * 12) * this.noteLineWidth, '' + (1 + k), 'octaveLabel16'));
            this.labelsOctaveAnchor8.content.push(this.tileLevel.text(0, this.gridIndentUp + (120 - k * 12 - 0.25) * this.noteLineWidth, '' + (1 + k), 'octaveLabel8'));
            this.labelsOctaveAnchor4.content.push(this.tileLevel.text(0, this.gridIndentUp + (120 - k * 12 - 0.5) * this.noteLineWidth, '' + (1 + k), 'octaveLabel4'));
            this.labelsOctaveAnchor2.content.push(this.tileLevel.text(0, this.gridIndentUp + (120 - k * 12 - 0.75) * this.noteLineWidth, '' + (1 + k), 'octaveLabel2'));
        }
    };
    ZvoogApp.prototype.resetTrackVoiceName = function () {
        var label1 = '';
        var label2 = '';
        var label3 = '';
        var label4 = '';
        for (var k1 = 0; k1 < this.currentSong.tracks.length; k1++) {
            if (this.isTrackActive(k1)) {
                var track = this.currentSong.tracks[k1];
                label1 = track.title;
                if (!this.isTrackSelected(k1)) {
                    for (var k2 = 0; k2 < track.voices.length; k2++) {
                        if (this.isVoiceActive(k1, k2)) {
                            var voice = track.voices[k2];
                            label2 = voice.title;
                            if (!this.isVoiceSelected(k1, k2)) {
                                if (this.isVoiceSourceActive(k1, k2)) {
                                    var plugin = voice.source.plugin;
                                    label3 = plugin.label();
                                    if (!this.isVoiceSourceSelected(k1, k2)) {
                                        var pars = plugin.getParams();
                                        if (pars) {
                                            for (var k4 = 0; k4 < pars.length; k4++) {
                                                if (this.isVoiceSourceParameterSelected(k1, k2, k4)) {
                                                    label4 = pars[k4].label();
                                                }
                                            }
                                        }
                                    }
                                }
                                for (var k3 = 0; k3 < voice.effects.length; k3++) {
                                    if (this.isVoiceFxActive(k1, k2, k3)) {
                                        var plugin = voice.effects[k3].plugin;
                                        label3 = plugin.label();
                                        if (!this.isVoiceFxSelected(k1, k2, k3)) {
                                            var pars = plugin.getParams();
                                            if (pars) {
                                                for (var k4 = 0; k4 < pars.length; k4++) {
                                                    if (this.isVoiceFxParameterSelected(k1, k2, k3, k4)) {
                                                        label4 = pars[k4].label();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    for (var k2 = 0; k2 < track.effects.length; k2++) {
                        if (this.isTrackFxActive(k1, k2)) {
                            var plugin = track.effects[k2].plugin;
                            label2 = plugin.label();
                            if (!this.isTrackFxSelected(k1, k2)) {
                                var pars = plugin.getParams();
                                if (pars) {
                                    for (var k3 = 0; k3 < pars.length; k3++) {
                                        if (this.isTrackFxParameterSelected(k1, k2, k3)) {
                                            label3 = pars[k3].label();
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        for (var k1 = 0; k1 < this.currentSong.effects.length; k1++) {
            if (this.isFxActive(k1)) {
                var plugin = this.currentSong.effects[k1].plugin;
                label1 = plugin.label();
                if (!this.isFxSelected(k1)) {
                    var pars = plugin.getParams();
                    if (pars) {
                        for (var k2 = 0; k2 < pars.length; k2++) {
                            if (this.isFxParameterSelected(k1, k2)) {
                                label2 = pars[k2].label();
                            }
                        }
                    }
                }
            }
        }
        this.labelsStaticAnchor.content.length = 0;
        this.labelsStaticAnchor.content.push(this.tileLevel.text(0, -this.tileLevel.viewWidth / this.tileLevel.tapSize + 1.0, label1, 'overLabelTrack'));
        this.labelsStaticAnchor.content.push(this.tileLevel.text(0.25, -this.tileLevel.viewWidth / this.tileLevel.tapSize + 1.5, label2, 'overLabelVoice'));
        this.labelsStaticAnchor.content.push(this.tileLevel.text(0.5, -this.tileLevel.viewWidth / this.tileLevel.tapSize + 2.0, label3, 'overLabelVoice'));
        this.labelsStaticAnchor.content.push(this.tileLevel.text(0.75, -this.tileLevel.viewWidth / this.tileLevel.tapSize + 2.5, label4, 'overLabelVoice'));
        /*
        this.labelsStaticAnchor.content.length = 0;
        let trackName = '';
        let voiceName = '';
        if (this.currentSong.selectedLayer.level1 < this.currentSong.tracks.length) {
            let track = this.currentSong.tracks[this.currentSong.selectedLayer.level1];
            trackName = track.title;
            if (this.currentSong.selectedLayer.level2 < track.voices.length) {
                let voice = track.voices[this.currentSong.selectedLayer.level2];
                let voiceName = voice.title;

            }
        }
        this.labelsStaticAnchor.content.push(this.tileLevel.text(2
            , -this.tileLevel.viewWidth / this.tileLevel.tapSize + 1.0
            , trackName, 'overLabelTrack'));
        this.labelsStaticAnchor.content.push(this.tileLevel.text(2.5
            , -this.tileLevel.viewWidth / this.tileLevel.tapSize + 1.5
            , voiceName, 'overLabelVoice'));
            */
    };
    ZvoogApp.prototype.createLayers = function () {
        var layers = [];
        this.overButtonsAnchor = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: this.maxZoom, content: [] };
        this.labelsStaticAnchor = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: 300, content: [] };
        this.labelsOctaveAnchor16 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: 8, hideZoom: 16, content: [] };
        this.labelsOctaveAnchor8 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: 4, hideZoom: 8, content: [] };
        this.labelsOctaveAnchor4 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: 2, hideZoom: 4, content: [] };
        this.labelsOctaveAnchor2 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: 2, content: [] };
        this.labelsBottomAnchor4 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: 4, content: [] };
        this.labelsBottomAnchor16 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: 4, hideZoom: 16, content: [] };
        this.labelsBottomAnchor64 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: 16, hideZoom: 64, content: [] };
        this.labelsBottomAnchor256 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: 64, hideZoom: this.maxZoom, content: [] };
        this.keyZoomAnchor = { xx: 0, yy: this.gridIndentUp, ww: 1, hh: 120 * this.noteLineWidth, showZoom: this.minZoom, hideZoom: 25, content: [] };
        this.keyWholeAnchor = { xx: 0, yy: this.gridIndentUp, ww: 1, hh: 120 * this.noteLineWidth, showZoom: 25, hideZoom: this.maxZoom, content: [] };
        this.meterPatternAnchor = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: this.maxZoom, content: [] };
        this.firstAnchor = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: 300, content: [] };
        this.secondAnchor = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: 100, content: [] };
        this.otherAnchor = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: 25, content: [] };
        this.workButtonsGroup = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: this.maxZoom, content: [] };
        this.popupMenuGroup1 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: this.maxZoom, content: [] };
        this.popupMenuGroup2 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: this.maxZoom, content: [] };
        this.popupMenuGroup3 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: this.maxZoom, content: [] };
        //this.popupMenuGroup4 = { xx: 0, yy: 0, ww: 1, hh: 1, showZoom: this.minZoom, hideZoom: this.maxZoom, content: [] };
        layers.push({ g: document.getElementById('overButtonsGroup'), anchors: [this.overButtonsAnchor], overlay: 1 });
        layers.push({ g: document.getElementById('labelsStaticGroup'), anchors: [this.labelsStaticAnchor], overlay: 1 });
        layers.push({
            g: document.getElementById('labelsBottomGroup'), anchors: [
                this.labelsBottomAnchor4,
                this.labelsBottomAnchor16,
                this.labelsBottomAnchor64,
                this.labelsBottomAnchor256
            ], stickBottom: 1
        });
        layers.push({
            g: document.getElementById('labelsLeftGroup'), anchors: [
                this.labelsOctaveAnchor16,
                this.labelsOctaveAnchor8,
                this.labelsOctaveAnchor4,
                this.labelsOctaveAnchor2
            ], stickLeft: 0
        });
        layers.push({ g: document.getElementById('keyPatternGroup'), anchors: [this.keyZoomAnchor, this.keyWholeAnchor] });
        layers.push({ g: document.getElementById('meterPatternGroup'), anchors: [this.meterPatternAnchor] });
        layers.push({ g: document.getElementById('otherVoicesGroup'), anchors: [this.otherAnchor] });
        layers.push({ g: document.getElementById('secondaryVoicesGroup'), anchors: [this.secondAnchor] });
        layers.push({ g: document.getElementById('mainVoiceGroup'), anchors: [this.firstAnchor] });
        layers.push({ g: document.getElementById('workButtonsGroup'), anchors: [this.workButtonsGroup] });
        this.popupLayer = {
            g: document.getElementById('popupGroup'), anchors: [this.popupMenuGroup1,
                this.popupMenuGroup2, this.popupMenuGroup3 //, this.popupMenuGroup4
            ]
        };
        layers.push(this.popupLayer);
        return layers;
    };
    ZvoogApp.prototype.resetWholeProject = function () {
        this.resetFieldSize();
        this.resetButtons();
        this.resetGrid();
        this.resetNotes();
        this.resetTrackVoiceName();
        this.tileLevel.resetModel();
    };
    /*patternDuration(pattern: ZvoogPattern): number {
        return duration2time(pattern.tempo, duration384(pattern.meter));
    }*/
    ZvoogApp.prototype.patternDuration = function (measure) {
        return duration2time(measure.tempo, duration384(measure.meter));
    };
    /*voiceDuration(voice: ZvoogVoice): number {
        let ms: number = 0;
        for (let i = 0; i < voice.chunks.length; i++) {
            ms = ms + this.patternDuration(voice.chunks[i]);
        }
        return ms;
    }*/
    /*trackDuration(track: ZvoogTrack): number {
        let ms: number = 0;
        for (let i = 0; i < track.voices.length; i++) {
            let t = this.voiceDuration(track.voices[i]);
            if (t > ms) {
                ms = t;
            }
        }
        return ms;
    }*/
    /*wholeDuration(schedule: ZvoogSchedule): number {
        let ms: number = 0;
        for (let i = 0; i < schedule.tracks.length; i++) {
            let t = this.trackDuration(schedule.tracks[i]);
            if (t > ms) {
                ms = t;
            }
        }
        return ms;
    }*/
    ZvoogApp.prototype.resetFieldSize = function () {
        //this.tileLevel.innerWidth = this.tileLevel.tapSize * (this.gridIndentLeft + this.wholeDuration(this.currentSong) * this.lengthOfSecond + this.gridIndentRight);
        this.tileLevel.innerWidth = this.tileLevel.tapSize * (this.gridIndentLeft + durations2time(this.currentSong.timeline) * this.lengthOfSecond + this.gridIndentRight);
        this.tileLevel.innerHeight = this.tileLevel.tapSize * (this.gridIndentUp + 120 * this.noteLineWidth + this.gridIndentDown);
        this.firstAnchor.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.firstAnchor.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.secondAnchor.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.secondAnchor.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.otherAnchor.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.otherAnchor.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.keyZoomAnchor.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.keyZoomAnchor.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.keyWholeAnchor.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.keyWholeAnchor.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsStaticAnchor.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsStaticAnchor.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsOctaveAnchor16.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsOctaveAnchor16.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsOctaveAnchor8.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsOctaveAnchor8.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsOctaveAnchor4.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsOctaveAnchor4.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsOctaveAnchor2.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsOctaveAnchor2.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsBottomAnchor4.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsBottomAnchor4.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsBottomAnchor16.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsBottomAnchor16.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsBottomAnchor64.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsBottomAnchor64.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.labelsBottomAnchor256.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.labelsBottomAnchor256.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.meterPatternAnchor.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.meterPatternAnchor.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
        this.workButtonsGroup.ww = this.tileLevel.innerWidth / this.tileLevel.tapSize;
        this.workButtonsGroup.hh = this.tileLevel.innerHeight / this.tileLevel.tapSize;
    };
    return ZvoogApp;
}());
