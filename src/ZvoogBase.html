<html>
	<head>
		<script src='ZvoogBase.js'></script>
	</head>
	<body>
		<div>
			<p><button onclick='start()'>start</button></p>
			<p><input id="vlmcntrl" type="range" min=0.0 max=1.0 value=1.0 step=0.01 ></input></p>
			<p><input id="vlmtgl" type="checkbox">&nbsp;&nbsp;&nbsp;</input></p>
		</div>
		<script>
			function start() {
				console.log('start test');
				var AudioContextFunc = window.AudioContext || window.webkitAudioContext;
				var audioContext = new AudioContextFunc();
				var ticker = new ZvoogBase(audioContext, 'ticker');
				var volumeFx = new ZvoogBase(audioContext, 'volumeFx');
				var control = new ZvoogBase(audioContext, 'control');
				var toggle = new ZvoogBase(audioContext, 'toggle');
				ticker.loadFromObject(new ZvoogImplementationTicker(audioContext, ticker));
				volumeFx.loadFromObject(new ZvoogImplementationGain(audioContext, volumeFx));
				control.loadFromObject(new ZvoogImplementationRange(audioContext, control));
				toggle.loadFromObject(new ZvoogImplementationRange(audioContext, toggle));
				ticker.routeTo(volumeFx).connectTo(audioContext.destination);
				control.channel('value').bind(toggle.channel('state')).bind(volumeFx.channel('volume'));
				//var loud = new ZvoogMessage();
				//loud.value = 0.15;
				document.getElementById('vlmcntrl').onchange = function (e) {
					var zm = new ZvoogMessage();
					zm.value = e.target.value * 1;
					control.channel('value').schedule(zm);
				};
				control.implementation.onMessage = function (channelName, zvoogMessage) {
					if (channelName == 'value') {
						document.getElementById('vlmcntrl').value = zvoogMessage.value;
					}
				};
				document.getElementById("vlmtgl").onchange = function (e) {
					var zm = new ZvoogMessage();
					zm.value = e.target.checked ? 1 : 0;
					toggle.channel('state').schedule(zm);
				};
				toggle.implementation.onMessage = function (channelName, zvoogMessage) {
					if (channelName == 'state') {
						if (zvoogMessage.value > 0) {
							document.getElementById('vlmtgl').checked = true;
						} else {
							document.getElementById('vlmtgl').checked = false;
						}
					}
				};
			}
		</script>
	</body>
</html>